<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Plato - app.js</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link href="../../assets/css/vendor/morris.css" rel="stylesheet">
  <link href="../../assets/css/vendor/bootstrap.css" rel="stylesheet">
  <link href="../../assets/css/vendor/font-awesome.css" rel="stylesheet">
  <link href="../../assets/css/vendor/codemirror.css" rel="stylesheet">
  <link href="../../assets/css/plato.css" rel="stylesheet">
  <link href="../../assets/css/plato-file.css" rel="stylesheet">

</head>

<body>

<div class="navbar navbar-fixed-top">
  <div class="container">
    <a class="navbar-brand" href="http://github.com/es-analysis/plato">Plato on Github</a>
    <ul class="nav navbar-nav">
      <li>
        <a href="../../index.html">Report Home</a>
      </li>
    </ul>
  </div>
</div>

<div class="jumbotron">
  <div class="container">
    <h1>app.js</h1>
  </div>
</div>

<div class="container aggregate-stats">
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Maintainability <a href="http://blogs.msdn.com/b/codeanalysis/archive/2007/11/20/maintainability-index-range-and-meaning.aspx"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="A value between 0 and 100 that represents the relative ease of maintaining the code. A high value means better maintainability." data-original-title="Maintainability Index"  data-container="body"></i></a></h2>
      <p class="stat">71.04</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Lines of code <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h2>
      <p class="stat">430</p>
    </div>
  </div>
  <div class="row historical">
    <div class="col-md-6">
      <p id="chart_historical_maint" class="chart"></p>
    </div>
    <div class="col-md-6">
      <p id="chart_historical_sloc" class="chart"></p>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Difficulty  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="The difficulty measure is related to the difficulty of the program to write or understand." data-original-title="Difficulty" data-container="body"></i></a></h2>
      <p class="stat">26.03</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Estimated Errors  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Halstead's delivered bugs is an estimate for the number of errors in the implementation." data-original-title="Delivered Bugs" data-container="body"></i></a></h2>
      <p class="stat">2.75</p>
    </div>
  </div>
</div>

<div class="container charts">
  <div class="row">
    <h2 class="header">Function weight</h2>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h3 class="chart-header">By Complexity <a href="http://en.wikipedia.org/wiki/Cyclomatic_complexity"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="This metric counts the number of distinct paths through a block of code. Lower values are better." data-original-title="Cyclomatic Complexity" data-container="body"></i></a></h3>
      <div id="fn-by-complexity" class="stat"></div>
    </div>
    <div class="col-md-6">
      <h3 class="chart-header">By SLOC  <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h3>
      <div id="fn-by-sloc" class="stat"></div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <textarea id="file-source" class="col-md-12">// try{
//     require(&#039;newrelic&#039;);
//     console.log(&#039;Starting newrelic module: logging to ./newrelic_agent.log&#039;)
// }
// catch (e) {
//   console.log(e);
// }

// anna&#039;s
// try{
//   require(&#039;nodetime&#039;).profile({
//     accountKey: &#039;13bf15a356e62b822df4395f183fe0a83af757f4&#039;, 
//     appName: &#039;Node.js VAMPS Application&#039;
//   });
// }
// catch(err){
//   console.log(err.toString())
// }


// //var H5Type = require(&#039;hdf5/lib/globals&#039;).H5Type;
// //console.log(H5Type)

// var group = file.createGroup(&#039;VAMPS-ds&#039;);
// var buffer=new Buffer(8*10*8, &quot;binary&quot;);
// buffer.rank=2;
// buffer.rows=8;
// buffer.columns=10;
// buffer.type = h5g.H5Type.H5T_NATIVE_DOUBLE;
// //console.log(buffer.type)
// for (j = 0; j &lt; buffer.columns; j++) {
//   for (i = 0; i &lt; buffer.rows; i++){
//     if (j&lt; (buffer.columns/2)) {
//       buffer.writeDoubleLE(1.0, 8*(i*buffer.columns+j));
//     }
//     else {
//       buffer.writeDoubleLE(2.0, 8*(i*buffer.columns+j));
//     }
//   }
// }

// h5lt.makeDataset(group.id, &#039;Waldo&#039;, buffer);
// group.close()
// file.close();
// module.exports.Access = {
//   ACC_RDONLY : 0, /*absence of rdwr =&gt; rd-only */
//   ACC_RDWR   : 1, /*open for read and write    */
//   ACC_TRUNC  : 2, overwrite existing files   
//   ACC_EXCL   : 4, /*fail if file already exists*/
//   ACC_DEBUG  : 8, /*print debug info      */
//   ACC_CREAT  : 10 /*create non-existing files  */
// };

var compression = require(&#039;compression&#039;);
var express = require(&#039;express&#039;);
//var expose = require(&#039;express-expose&#039;);
var router = express.Router();
var session = require(&#039;express-session&#039;);
var path = require(&#039;path&#039;);
global.app_root = path.resolve(__dirname);
//var hdf5 = require(&#039;hdf5&#039;);
var logger = require(&#039;morgan&#039;);
var cookieParser = require(&#039;cookie-parser&#039;);
var bodyParser = require(&#039;body-parser&#039;);
var flash = require(&#039;express-flash&#039;);
var passport = require(&#039;passport&#039;);
var favicon = require(&#039;serve-favicon&#039;);
var fs = require(&#039;fs-extra&#039;);
var zlib = require(&#039;zlib&#039;);

//var db = require(&#039;mysql2&#039;);
// without var declaration connection is global
// needed for DATASETS initialization

connection = require(&#039;./config/database&#039;).pool;



var routes    = require(&#039;./routes/index&#039;);  // This grabs ALL_DATASETS from routes/load_all_datasets.js
var users     = require(&#039;./routes/routes_users&#039;);
var tmp       = require(&#039;./routes/routes_tmp&#039;);
var user_data = require(&#039;./routes/routes_user_data&#039;);
var search    = require(&#039;./routes/routes_search&#039;);
var projects  = require(&#039;./routes/routes_projects&#039;);
var datasets  = require(&#039;./routes/routes_datasets&#039;);
var help      = require(&#039;./routes/routes_help&#039;);
var resources = require(&#039;./routes/routes_resources&#039;);
var admin     = require(&#039;./routes/routes_admin&#039;);

var portals   = require(&#039;./routes/routes_portals&#039;);
var metadata   = require(&#039;./routes/routes_metadata&#039;);
//console.log(&#039;test&#039;)
var visuals = require(&#039;./routes/visuals/routes_visualization&#039;);
//console.log(&#039;test2&#039;)
var consts = require(&#039;./public/constants&#039;);
var config = require(&#039;./config/config&#039;);
var app = express();
app.set(&#039;appName&#039;, &#039;VAMPS&#039;);
require(&#039;./config/passport&#039;)(passport, connection); // pass passport for configuration

// view engine setup
app.set(&#039;views&#039;, path.join(__dirname, &#039;views&#039;));
app.engine(&#039;html&#039;, require(&#039;ejs&#039;).renderFile);
app.set(&#039;view engine&#039;, &#039;html&#039;);

app.set(express.static(__dirname + &#039;tmp&#039;));
// MIDDLEWARE  &lt;-- must be in correct order:
app.use(favicon( path.join(__dirname, &#039;public&#039;, &#039;favicon.ico&#039;)));
app.use(logger(&#039;dev&#039;));
//app.use(bodyParser({limit: 1024000000 })); // 1024MB
app.use(bodyParser.json());
app.use(bodyParser.urlencoded({
	extended: true
}));


//upload.single(&#039;singleInputFileName&#039;)
//app.use(upload.single(&#039;singleInputFileName&#039;));  // for multipart uploads: files

app.use(cookieParser());

app.use(compression());
/**
 * maxAge used to cache the content, # msec
 * to &quot;uncache&quot; some pages: http://stackoverflow.com/questions/17407770/express-setting-different-maxage-for-certain-files
 */
app.use(express.static( &#039;public&#039;, {maxAge: &#039;24h&#039; }));
app.use(express.static(&#039;tmp&#039;));
// app.use(express.static(__dirname + &#039;/public&#039;, {maxAge: 900000 }));
// app.use(express.static(path.join(__dirname, &#039;/public&#039;)));

app.use(&#039;public/javascripts&#039;, express.static(path.join(__dirname, &#039;public&#039;, &#039;javascripts&#039;)));
app.use(&#039;public/stylesheets&#039;, express.static(path.join(__dirname, &#039;public&#039;, &#039;stylesheets&#039;)));

// app.use(&#039;views/add_ins&#039;, express.static(path.join(__dirname, &#039;/views/add_ins&#039;)));
// required for passport
// app.use(session({ secret: &#039;keyboard cat&#039;,  cookie: {maxAge: 900000}})); // session secret
app.use(session({ 
	secret: &#039;keyboard cat&#039;,
    resave: false,
    saveUninitialized: true
})); // session secret

app.use(passport.initialize());
app.use(passport.session()); // persistent login sessions
app.use(flash()); // use connect-flash for flash messages stored in session


app.use(function(req, res, next){
	if (connection == null) {
	   this.send(&#039;We cannot reach the database right now, please try again later.&#039;);
	   return;
	 }else{
	    req.db = connection;
	    req.CONSTS = consts;
        req.CONFIG = config;
	    return next();
	}
});
//var hdf5 = require(&#039;hdf5&#039;).hdf5;
// example of roll-your-own middleware:
// GET: localhost:3000/?id=324
// app.use(function (req, res,next) {
//     console.log(&#039;START &#039;);
//     if (req.query.id){
//         console.log(&#039;got id &#039;+req.query.id);
//         next();
//     }else if (req.query.name){
//         console.log(&#039;got name &#039;+req.query.name);
//         next();
//     }else{
//         next();
//     }
// });

// ROUTES:
app.use(&#039;/&#039;, routes);
app.use(&#039;/help&#039;, help);
app.use(&#039;/resources&#039;, resources);
app.use(&#039;/tmp&#039;, tmp);
app.use(&#039;/admin&#039;, admin);
app.use(&#039;/users&#039;, users);
app.use(&#039;/projects&#039;, projects);
app.use(&#039;/datasets&#039;, datasets);
app.use(&#039;/visuals&#039;, visuals);
app.use(&#039;/search&#039;, search);
app.use(&#039;/user_data&#039;, user_data);
app.use(&#039;/portals&#039;, portals);
app.use(&#039;/metadata&#039;, metadata);

// for non-routing pages such as heatmap, counts and bar_charts
app.get(&#039;/*&#039;, function(req, res, next){
    console.warn(req.params);
    console.warn(req.uri);
    var url = req.params[0];
    // I want to create a page like: counts_table_2014080_13452.html
    // for each link
    if (url === &#039;visuals/user_viz_data/ctable.html&#039;) { // 
        // Yay this is the File A... 
        console.warn(&quot;The user file  has been requested&quot;);
        router.get(&#039;/visuals/user_viz_data/ctable.html&#039;,  function(req, res) {
            console.warn(&#039;trying to open ctable.html&#039;);
        });
    } else {
        // we don&#039;t care about any other file, let it download too        
        console.warn(&quot;No Route Found&quot;);
        next();
    }
});

/// catch 404 and forward to error handler
app.use(function(req, res, next) {
    var err = new Error(&#039;Not Found&#039;);
    err.status = 404;
    next(err);
});

/// error handlers &lt;-- these middleware go after routes
app.set(&#039;env&#039;, process.env.NODE_ENV);
// development error handler
// will print stacktrace
console.log(&#039;DATABASE: &#039;+NODE_DATABASE);
console.log(&#039;Database set in config/db-connection.js&#039;);
console.log(&#039;ENV:&#039;,app.get(&#039;env&#039;));
console.log(&#039;Environment set in bin/www&#039;);
if (app.get(&#039;env&#039;) === &#039;development&#039;) {
    app.use(function(err, req, res, next) {
        res.status(err.status || 500);
        res.render(&#039;error.ejs&#039;, {
            message: err.message,
            error: err
        });
    });
}

// production error handler
// no stacktraces leaked to user
app.use(function(err, req, res, next) {
    res.status(err.status || 500);
    res.render(&#039;error.ejs&#039;, {
        message: err.message,
        error: {}
    });
});

var os = require(&quot;os&quot;);
console.log(&#039;HOSTNAME: &#039;+os.hostname())

fs.ensureDir(config.USER_FILES_BASE, function (err) {
    if(err) {console.log(err);} // =&gt; null
    else{
        if(config.site != &#039;vamps&#039; &amp;&amp; config.site != &#039;vampsdev&#039;){
            fs.chmod(config.USER_FILES_BASE, 0775, function (err) {
                if(err) {console.log(err);} // ug+rwx       
            });
        }
        console.log(&#039;Ensured USER FILES dir is present: &#039;+config.USER_FILES_BASE)
        
    }        // dir has now been created, including the directory it is to be placed in

});

/**
* Create global objects once upon server startup
*/

var silvaTaxonomy = require(&#039;./models/silva_taxonomy&#039;);
var all_silva_taxonomy = new silvaTaxonomy();

var rdpTaxonomy = require(&#039;./models/rdp_taxonomy&#039;);
var all_rdp_taxonomy = new rdpTaxonomy();

var CustomTaxa  = require(&#039;./routes/helpers/custom_taxa_class&#039;);
//var CustomTaxa  = require(&#039;./routes/helpers/custom_taxa_class_json&#039;);   // for fancytree:  https://github.com/mar10/fancytree
//var CustomTaxa  = require(&#039;./routes/helpers/custom_taxa_class_dhtmlx&#039;);   // for dhtmlx:  http://dhtmlx.com/docs/products/dhtmlxTree/
//var TreeModel = require(&#039;tree-model&#039;);;

// GLOBAL if leave off &#039;var&#039;:
// FORMAT: TaxaCounts[ds_id][rank_name][tax_id] = count
// script: /public/scripts/create_taxcounts_lookup.py


// these files are manually created before server startup using the scripts in public/scripts
// var rstream = fs.createReadStream(&#039;./public/json/tax_counts--&#039;+NODE_DATABASE+&#039;.json.gz&#039;);
// var unzip = zlib.createGunzip();
// var taxcounts =&#039;&#039;
// var chunk;
// rstream.pipe(unzip)
// 	.on(&#039;data&#039;, function (chunk) {
// 		taxcounts += chunk;
//   	})
// 	.on(&#039;end&#039;, function() {
// 		    console.log(&#039;Finished reading TAXCOUNTS&#039;);
// 	});

////////////////////////////////////////////////////////
/////// hdf5 Code //////////////
AllMetadata = {}

try{
    //var h5 = require(&#039;hdf5&#039;)
    var hdf5 = require(&#039;hdf5&#039;).hdf5; // File; Filters
    // var h5lt = require(&#039;hdf5&#039;).h5lt; // dataset
    // var h5tb = require(&#039;hdf5&#039;).h5tb; // table
    // var h5pt = require(&#039;hdf5&#039;).h5pt; // table
    // var h5im = require(&#039;hdf5&#039;).h5im; // image
    // var h5ds = require(&#039;hdf5&#039;).h5ds; // scale
    var h5g  = require(&#039;hdf5/lib/globals&#039;);
    // GLOBAL:
    HDF5_MDATA  = new hdf5.File(path.join( config.JSON_FILES_BASE, NODE_DATABASE+&#039;--metadata.h5XX&#039; ),  h5g.Access.ACC_RDONLY);
    HDF5_TAXDATA = new hdf5.File(path.join( config.JSON_FILES_BASE, NODE_DATABASE+&#039;--taxcounts.h5XX&#039; ), h5g.Access.ACC_RDONLY);
    //var groupTest = HDF5test_data.openGroup(&#039;test&#039;);
    //var group51 = HDF5_data.openGroup(&quot;86&quot;);
    var did_list = HDF5_MDATA.getMemberNamesByCreationOrder(); // retreives all the &#039;groups&#039; ie dids
    //console.log(mdgroup86[&#039;temp&#039;])
    //console.log(&#039;group56&#039;,group56.id)
    // var groupTargets=THE_TEST_FILE.createGroup(&#039;test/sodium-icosanoate&#039;);
    // groupTargets[&#039;Computed Heat of Formation&#039; ] = -221.78436098572274;
    // groupTargets[&#039;Computed Ionization Potential&#039; ] = 9.57689311885752;
    // groupTargets[&#039;Computed Total Energy&#039; ] = -3573.674399276322;
    // groupTargets.Status = 256;
    // groupTargets.Information = &quot;\&quot;There are no solutions; there are only trade-offs.\&quot; -- Thomas Sowell&quot;;
    // group56.flush();
    // var group = THE_TEST_FILE.openGroup(&#039;test/sodium-icosanoate&#039;)
    // var metadata = group56.getDatasetAttributes(&quot;metadata&quot;);
    // console.log(metadata)
    // var taxcounts = group56.getDatasetAttributes(&quot;taxcounts&quot;);
    // console.log(HDF5_DATA.getMemberNamesByCreationOrder())
    // att = testattr[&#039;temp&#039;]
    // for(i in did_list){
    //     var did = did_list[i]
    //     AllMetadata[did] = {}
    //     var mdgroup = HDF5_MDATA.openGroup(did+&quot;/metadata&quot;);
    //     mdgroup.refresh()
    //     Object.getOwnPropertyNames(mdgroup).forEach(function(mdname, idx, array) {
    //         if(mdname != &#039;id&#039;){
    //           //console.log(mdname, group[mdname])
    //           //AllMetadata[did][mdname] = mdgroup[mdname]
    //         }         
    //     });
    // }
    //console.log(&#039;aux_corrected_sample_depth&#039;,metadata[&#039;aux_corrected_sample_depth&#039;])
    //console.log(h5g)
    // group.close()
    // THE_TEST_FILE.close()
    // var group88 = THE_FILE.openGroup(&#039;53&#039;)
    // group88.refresh();
    // for(n in hdf5){
    //     console.log(n)
    // }

    // var tax_attrs = group88.getDatasetAttributes(&quot;taxcounts&quot;);
    // var meta_attrs = group88.getDatasetAttributes(&quot;metadata&quot;);
    // group88.refresh();
    // attrText = &#039;&#039;;
    // console.log(group88[&#039;longitude&#039;])
    // Object.getOwnPropertyNames(tax_attrs).forEach(function(val, idx, array) {
    //    console.log(val,tax_attrs[val])
    //   if (val !=  &#039;id&#039;) {
    //     if (meta_attrs[val].constructor.name === Array) {
    //       attrText += val + &#039; :  &#039;;
    //       for (var mIndex = 0; mIndex &lt; attrs[val].Length(); mIndex++) {
    //         attrText += meta_attrs[val][mIndex];
    //         if (mIndex &lt; meta_attrs[val].Length() - 1) {
    //           attrText += &#039;,&#039;;
    //         }
    //       }
    //     }
    //     else{
    //       attrText += val + &#039; :  &#039; + meta_attrs[val] + &#039;\n&#039;;
    //     }
    //   }
    //   console.log(attrText)
    // });
    // var readAsBuffer = h5lt.readDatasetAsBuffer(  group88.id, &#039;metadata&#039;, {});

    // console.log(readAsBuffer)
    // for(n in tax_attrs){
    //     console.log(tax_attrs[n])
    // }
    // for(n in meta_attrs){
    //     console.log(&quot;\n&quot;,n)
    //     console.log(meta_attrs[n].toString())
    // }
    // console.log(&#039;g88&#039;,h5lt.get_num_attrs(group88.id))
    // console.log(&#039;group88&#039;,group88[&#039;latitude&#039;] )
    ////////// END hdf5 Code ///////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////
}catch(err){
    // If we&#039;re here we don&#039;t have HDF5
    console.log(err)
    HDF5_MDATA  = &#039;&#039;
    HDF5_TAXDATA = &#039;&#039;
    //var taxcounts_file = path.join( config.JSON_FILES_BASE, NODE_DATABASE+&#039;--taxcounts.json&#039; );
    var meta_file      = path.join( config.JSON_FILES_BASE, NODE_DATABASE+&#039;--metadata.json&#039; );
    AllTaxCounts = {}
    
    try {
        AllTaxCounts   = require(taxcounts_file);
        console.log(&#039;Loading TAXCOUNTS as AllTaxCounts from: &#039;+taxcounts_file);
    }
    catch (e) {
      console.log(e);      
    }
    
    try {
        AllMetadata        = require(meta_file);
    }
    catch (e) {
      console.log(e);
      AllMetadata = {}
    }
    console.log(&#039;Loading METADATA as AllMetadata from: &#039;+meta_file);
}
try{
    var sizeof = require(&#039;object-sizeof&#039;);
}catch(e){
    console.log(e);
}
//see file models/silva_taxonomy.js
all_silva_taxonomy.get_all_taxa(function(err, results) {
  if (err)
    throw err; // or return an error message, or something
  else
  {
    //console.log(&quot;AAA all_silva_taxonomy from app = &quot; + JSON.stringify(results));

    //TAXCOUNTS = JSON.parse(taxcounts);
    //console.log(&#039;TAXCOUNTS2 &#039;+JSON.stringify(TAXCOUNTS));
    // var small_rows = [ {&quot;domain&quot;:&quot;Archaea&quot;,&quot;phylum&quot;:&quot;&quot;,&quot;klass&quot;:&quot;&quot;,&quot;order&quot;:&quot;&quot;,&quot;family&quot;:&quot;&quot;,&quot;genus&quot;:&quot;&quot;,&quot;species&quot;:&quot;&quot;,&quot;strain&quot;:&quot;&quot;,&quot;domain_id&quot;:1,&quot;phylum_id&quot;:1,&quot;klass_id&quot;:1,&quot;order_id&quot;:1,&quot;family_id&quot;:1,&quot;genus_id&quot;:1,&quot;species_id&quot;:1,&quot;strain_id&quot;:1},{&quot;domain&quot;:&quot;Archaea&quot;,&quot;phylum&quot;:&quot;Crenarchaeota&quot;,&quot;klass&quot;:&quot;&quot;,&quot;order&quot;:&quot;&quot;,&quot;family&quot;:&quot;&quot;,&quot;genus&quot;:&quot;&quot;,&quot;species&quot;:&quot;&quot;,&quot;strain&quot;:&quot;&quot;,&quot;domain_id&quot;:1,&quot;phylum_id&quot;:13,&quot;klass_id&quot;:1,&quot;order_id&quot;:1,&quot;family_id&quot;:1,&quot;genus_id&quot;:1,&quot;species_id&quot;:1,&quot;strain_id&quot;:1},{&quot;domain&quot;:&quot;Archaea&quot;,&quot;phylum&quot;:&quot;Crenarchaeota&quot;,&quot;klass&quot;:&quot;D-F10&quot;,&quot;order&quot;:&quot;&quot;,&quot;family&quot;:&quot;&quot;,&quot;genus&quot;:&quot;&quot;,&quot;species&quot;:&quot;&quot;,&quot;strain&quot;:&quot;&quot;,&quot;domain_id&quot;:1,&quot;phylum_id&quot;:13,&quot;klass_id&quot;:33,&quot;order_id&quot;:1,&quot;family_id&quot;:1,&quot;genus_id&quot;:1,&quot;species_id&quot;:1,&quot;strain_id&quot;:1},{&quot;domain&quot;:&quot;Archaea&quot;,&quot;phylum&quot;:&quot;Crenarchaeota&quot;,&quot;klass&quot;:&quot;Group_C3&quot;,&quot;order&quot;:&quot;&quot;,&quot;family&quot;:&quot;&quot;,&quot;genus&quot;:&quot;&quot;,&quot;species&quot;:&quot;&quot;,&quot;strain&quot;:&quot;&quot;,&quot;domain_id&quot;:1,&quot;phylum_id&quot;:13,&quot;klass_id&quot;:52,&quot;order_id&quot;:1,&quot;family_id&quot;:1,&quot;genus_id&quot;:1,&quot;species_id&quot;:1,&quot;strain_id&quot;:1},{&quot;domain&quot;:&quot;Archaea&quot;,&quot;phylum&quot;:&quot;Crenarchaeota&quot;,&quot;klass&quot;:&quot;Marine_Benthic_Group_A&quot;,&quot;order&quot;:&quot;&quot;,&quot;family&quot;:&quot;&quot;,&quot;genus&quot;:&quot;&quot;,&quot;species&quot;:&quot;&quot;,&quot;strain&quot;:&quot;&quot;,&quot;domain_id&quot;:1,&quot;phylum_id&quot;:13,&quot;klass_id&quot;:58,&quot;order_id&quot;:1,&quot;family_id&quot;:1,&quot;genus_id&quot;:1,&quot;species_id&quot;:1,&quot;strain_id&quot;:1},{&quot;domain&quot;:&quot;Bacteria&quot;,&quot;phylum&quot;:&quot;&quot;,&quot;klass&quot;:&quot;&quot;,&quot;order&quot;:&quot;&quot;,&quot;family&quot;:&quot;&quot;,&quot;genus&quot;:&quot;&quot;,&quot;species&quot;:&quot;&quot;,&quot;strain&quot;:&quot;&quot;,&quot;domain_id&quot;:2,&quot;phylum_id&quot;:1,&quot;klass_id&quot;:1,&quot;order_id&quot;:1,&quot;family_id&quot;:1,&quot;genus_id&quot;:1,&quot;species_id&quot;:1,&quot;strain_id&quot;:1},{&quot;domain&quot;:&quot;Bacteria&quot;,&quot;phylum&quot;:&quot;&quot;,&quot;klass&quot;:&quot;&quot;,&quot;order&quot;:&quot;&quot;,&quot;family&quot;:&quot;&quot;,&quot;genus&quot;:&quot;&quot;,&quot;species&quot;:&quot;&quot;,&quot;strain&quot;:&quot;&quot;,&quot;domain_id&quot;:2,&quot;phylum_id&quot;:1,&quot;klass_id&quot;:1,&quot;order_id&quot;:1,&quot;family_id&quot;:1,&quot;genus_id&quot;:1,&quot;species_id&quot;:1,&quot;strain_id&quot;:1},{&quot;domain&quot;:&quot;Bacteria&quot;,&quot;phylum&quot;:&quot;Acidobacteria&quot;,&quot;klass&quot;:&quot;&quot;,&quot;order&quot;:&quot;&quot;,&quot;family&quot;:&quot;&quot;,&quot;genus&quot;:&quot;&quot;,&quot;species&quot;:&quot;&quot;,&quot;strain&quot;:&quot;&quot;,&quot;domain_id&quot;:2,&quot;phylum_id&quot;:2,&quot;klass_id&quot;:1,&quot;order_id&quot;:1,&quot;family_id&quot;:1,&quot;genus_id&quot;:1,&quot;species_id&quot;:1,&quot;strain_id&quot;:1},{&quot;domain&quot;:&quot;Bacteria&quot;,&quot;phylum&quot;:&quot;Acidobacteria&quot;,&quot;klass&quot;:&quot;Acidobacteria&quot;,&quot;order&quot;:&quot;Acidobacteriales&quot;,&quot;family&quot;:&quot;Acidobacteriaceae&quot;,&quot;genus&quot;:&quot;&quot;,&quot;species&quot;:&quot;&quot;,&quot;strain&quot;:&quot;&quot;,&quot;domain_id&quot;:2,&quot;phylum_id&quot;:2,&quot;klass_id&quot;:2,&quot;order_id&quot;:7,&quot;family_id&quot;:8,&quot;genus_id&quot;:1,&quot;species_id&quot;:1,&quot;strain_id&quot;:1},{&quot;domain&quot;:&quot;Bacteria&quot;,&quot;phylum&quot;:&quot;Acidobacteria&quot;,&quot;klass&quot;:&quot;Holophagae&quot;,&quot;order&quot;:&quot;&quot;,&quot;family&quot;:&quot;&quot;,&quot;genus&quot;:&quot;&quot;,&quot;species&quot;:&quot;&quot;,&quot;strain&quot;:&quot;&quot;,&quot;domain_id&quot;:2,&quot;phylum_id&quot;:2,&quot;klass_id&quot;:55,&quot;order_id&quot;:1,&quot;family_id&quot;:1,&quot;genus_id&quot;:1,&quot;species_id&quot;:1,&quot;strain_id&quot;:1},{&quot;domain&quot;:&quot;Bacteria&quot;,&quot;phylum&quot;:&quot;Acidobacteria&quot;,&quot;klass&quot;:&quot;Holophagae&quot;,&quot;order&quot;:&quot;Holophagales&quot;,&quot;family&quot;:&quot;Holophagaceae&quot;,&quot;genus&quot;:&quot;&quot;,&quot;species&quot;:&quot;&quot;,&quot;strain&quot;:&quot;&quot;,&quot;domain_id&quot;:2,&quot;phylum_id&quot;:2,&quot;klass_id&quot;:55,&quot;order_id&quot;:73,&quot;family_id&quot;:138,&quot;genus_id&quot;:1,&quot;species_id&quot;:1,&quot;strain_id&quot;:1},{&quot;domain&quot;:&quot;Bacteria&quot;,&quot;phylum&quot;:&quot;Actinobacteria&quot;,&quot;klass&quot;:&quot;Actinobacteria&quot;,&quot;order&quot;:&quot;&quot;,&quot;family&quot;:&quot;&quot;,&quot;genus&quot;:&quot;&quot;,&quot;species&quot;:&quot;&quot;,&quot;strain&quot;:&quot;&quot;,&quot;domain_id&quot;:2,&quot;phylum_id&quot;:3,&quot;klass_id&quot;:5,&quot;order_id&quot;:1,&quot;family_id&quot;:1,&quot;genus_id&quot;:1,&quot;species_id&quot;:1,&quot;strain_id&quot;:1},{&quot;domain&quot;:&quot;Bacteria&quot;,&quot;phylum&quot;:&quot;Actinobacteria&quot;,&quot;klass&quot;:&quot;Actinobacteria&quot;,&quot;order&quot;:&quot;Acidimicrobiales&quot;,&quot;family&quot;:&quot;&quot;,&quot;genus&quot;:&quot;&quot;,&quot;species&quot;:&quot;&quot;,&quot;strain&quot;:&quot;&quot;,&quot;domain_id&quot;:2,&quot;phylum_id&quot;:3,&quot;klass_id&quot;:5,&quot;order_id&quot;:5,&quot;family_id&quot;:1,&quot;genus_id&quot;:1,&quot;species_id&quot;:1,&quot;strain_id&quot;:1},{&quot;domain&quot;:&quot;Bacteria&quot;,&quot;phylum&quot;:&quot;Actinobacteria&quot;,&quot;klass&quot;:&quot;Actinobacteria&quot;,&quot;order&quot;:&quot;Acidimicrobiales&quot;,&quot;family&quot;:&quot;Acidimicrobiaceae&quot;,&quot;genus&quot;:&quot;&quot;,&quot;species&quot;:&quot;&quot;,&quot;strain&quot;:&quot;&quot;,&quot;domain_id&quot;:2,&quot;phylum_id&quot;:3,&quot;klass_id&quot;:5,&quot;order_id&quot;:5,&quot;family_id&quot;:6,&quot;genus_id&quot;:1,&quot;species_id&quot;:1,&quot;strain_id&quot;:1}];
    // var new_taxonomy = new CustomTaxa(small_rows);
    // uncomment when we want all data:
    //SEE require(&#039;./routes/helpers/custom_taxa_class&#039;);
    new_taxonomy = new CustomTaxa(results);
    try{
        console.log(&#039;SIZE (silva-taxonomy object):&#039;,sizeof(new_taxonomy));
    }catch(e){}
    // uncomment to print out the object:
    //console.log(&#039;000 new_taxonomy = &#039; + JSON.stringify(new_taxonomy));
    //
    /// CREATE CUSTOM TAXONOMY TREE:  NOT NEEDED if using dhtmlx tree
    //new_taxonomy.make_html_tree_file(new_taxonomy.taxa_tree_dict_map_by_id, new_taxonomy.taxa_tree_dict_map_by_rank[&quot;domain&quot;]); 
    //new_taxonomy.make_fancytree_file(new_taxonomy.taxa_tree_dict_map_by_id, new_taxonomy.taxa_tree_dict_map_by_rank[&quot;domain&quot;]); 
    //new_taxonomy.make_dhtmlx_tree_file(new_taxonomy.taxa_tree_dict_map_by_id, new_taxonomy.taxa_tree_dict_map_by_rank[&quot;domain&quot;]);    
    //
    //console.log(&quot;\nnew_taxonomy.taxa_tree_dict = &quot; + JSON.stringify(new_taxonomy.taxa_tree_dict));
    //for(n in new_taxonomy.taxa_tree_dict){
    //	console.log(JSON.stringify(new_taxonomy.taxa_tree_dict[n]))
    //}
    //console.log(&quot;\ntaxa_tree_dict_map_by_id = &quot; + JSON.stringify(new_taxonomy.taxa_tree_dict_map_by_id[2266]));
//console.log(new_taxonomy.taxa_tree_dict_map_by_rank[&quot;domain&quot;])
//console.log(&#039;taxa_tree_dict_map_by_db_id_n_rank[&quot;3_domain&quot;] = &#039;+JSON.stringify(new_taxonomy.taxa_tree_dict_map_by_db_id_n_rank[&quot;3_domain&quot;]));

    console.log(&#039;1(silva)-taxa_tree_dict_map_by_db_id_n_rank[&quot;140108_domain&quot;] = &#039; + JSON.stringify(new_taxonomy.taxa_tree_dict_map_by_db_id_n_rank[&quot;140108_domain&quot;]));
    //console.log(&#039;taxa_tree_dict_map_by_rank[&quot;phylum&quot;] = &#039; + JSON.stringify(new_taxonomy.taxa_tree_dict_map_by_rank[&#039;phylum&#039;]));
    //console.log(&#039;taxa_tree_dict_map_by_name_n_rank = &#039; + JSON.stringify(new_taxonomy.taxa_tree_dict_map_by_name_n_rank));
    //console.log(&#039;taxa_tree_dict_map_by_name_n_rank[&quot;Acidobacteria_phylum&quot;] = &#039; + JSON.stringify(new_taxonomy.taxa_tree_dict_map_by_name_n_rank[&quot;Acidobacteria_phylum&quot;]));
    //console.log(&#039;taxa_tree_dict_map_by_name_n_rank[&quot;Bacteria_domain&quot;] = &#039; + JSON.stringify(new_taxonomy.taxa_tree_dict_map_by_name_n_rank[&quot;Bacteria_domain&quot;]));
    //console.log(&#039;taxa_tree_dict_map_by_db_id_n_rank[&quot;3927_domain&quot;] = &#039; + JSON.stringify(new_taxonomy.taxa_tree_dict_map_by_db_id_n_rank[&quot;3927_domain&quot;]));

    //console.log(&#039;RRR333 taxa_tree_dict_map_by_db_id_n_rank = &#039;+JSON.stringify(new_taxonomy.taxa_tree_dict_map_by_db_id_n_rank));
    
  }
});

all_rdp_taxonomy.get_all_taxa(function(err, results) {
  if (err)
    throw err; // or return an error message, or something
  else
  {
    new_rdp_taxonomy = new CustomTaxa(results);
    try{
        console.log(&#039;SIZE (rdp-taxonomy object):&#039;,sizeof(new_rdp_taxonomy));
    }catch(e){}
    console.log(&#039;2(rdp)-taxa_tree_dict_map_by_db_id_n_rank[&quot;3446_domain&quot;] = &#039; + JSON.stringify(new_rdp_taxonomy.taxa_tree_dict_map_by_db_id_n_rank[&quot;140108_domain&quot;]));
  }
});

//var taxCounts = require(&#039;./routes/helpers/create_taxcounts_class&#039;);
//new taxCounts();


module.exports = app;

// if (!module.parent) {
//   http.createServer(app).listen(process.env.PORT, function(){
//     console.log(&quot;Server listening on port &quot; + app.get(&#039;port&#039;));
//   });
// }</textarea>
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p>.</p>
  </div>
</footer>

<script type="text/html" id="complexity-popover-template">
  <div class="complexity-notice">
    Complexity : {{ complexity.cyclomatic }} <br>
    Length : {{ complexity.halstead.length }} <br>
    Difficulty : {{ complexity.halstead.difficulty.toFixed(2) }} <br>
    Est # bugs : {{ complexity.halstead.bugs.toFixed(2) }}<br>
  </div>
</script>

<script type="text/javascript" src="../../assets/scripts/bundles/core-bundle.js"></script>
<script type="text/javascript" src="../../assets/scripts/bundles/codemirror.js"></script>
<script type="text/javascript" src="../../assets/scripts/codemirror.markpopovertext.js"></script>
<script type="text/javascript" src="report.js"></script>
<script type="text/javascript" src="report.history.js"></script>
<script type="text/javascript" src="../../assets/scripts/plato-file.js"></script>
</body>
</html>
