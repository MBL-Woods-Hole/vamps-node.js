<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Plato - public/javascripts/unit_selection.js</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link href="../../assets/css/vendor/morris.css" rel="stylesheet">
  <link href="../../assets/css/vendor/bootstrap.css" rel="stylesheet">
  <link href="../../assets/css/vendor/font-awesome.css" rel="stylesheet">
  <link href="../../assets/css/vendor/codemirror.css" rel="stylesheet">
  <link href="../../assets/css/plato.css" rel="stylesheet">
  <link href="../../assets/css/plato-file.css" rel="stylesheet">

</head>

<body>

<div class="navbar navbar-fixed-top">
  <div class="container">
    <a class="navbar-brand" href="http://github.com/es-analysis/plato">Plato on Github</a>
    <ul class="nav navbar-nav">
      <li>
        <a href="../../index.html">Report Home</a>
      </li>
    </ul>
  </div>
</div>

<div class="jumbotron">
  <div class="container">
    <h1>public/javascripts/unit_selection.js</h1>
  </div>
</div>

<div class="container aggregate-stats">
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Maintainability <a href="http://blogs.msdn.com/b/codeanalysis/archive/2007/11/20/maintainability-index-range-and-meaning.aspx"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="A value between 0 and 100 that represents the relative ease of maintaining the code. A high value means better maintainability." data-original-title="Maintainability Index"  data-container="body"></i></a></h2>
      <p class="stat">66.63</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Lines of code <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h2>
      <p class="stat">1047</p>
    </div>
  </div>
  <div class="row historical">
    <div class="col-md-6">
      <p id="chart_historical_maint" class="chart"></p>
    </div>
    <div class="col-md-6">
      <p id="chart_historical_sloc" class="chart"></p>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Difficulty  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="The difficulty measure is related to the difficulty of the program to write or understand." data-original-title="Difficulty" data-container="body"></i></a></h2>
      <p class="stat">52.80</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Estimated Errors  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Halstead's delivered bugs is an estimate for the number of errors in the implementation." data-original-title="Delivered Bugs" data-container="body"></i></a></h2>
      <p class="stat">4.93</p>
    </div>
  </div>
</div>

<div class="container charts">
  <div class="row">
    <h2 class="header">Function weight</h2>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h3 class="chart-header">By Complexity <a href="http://en.wikipedia.org/wiki/Cyclomatic_complexity"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="This metric counts the number of distinct paths through a block of code. Lower values are better." data-original-title="Cyclomatic Complexity" data-container="body"></i></a></h3>
      <div id="fn-by-complexity" class="stat"></div>
    </div>
    <div class="col-md-6">
      <h3 class="chart-header">By SLOC  <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h3>
      <div id="fn-by-sloc" class="stat"></div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <textarea id="file-source" class="col-md-12">// visualization: unit_selection.js
var get_graphics_form = document.getElementById(&#039;get_graphics_form&#039;);
var get_graphics_btn = document.getElementById(&#039;get_graphics_btn&#039;) || null;
//custom_selection = &#039;html&#039;
//custom_selection = &#039;fancytree&#039;
custom_selection = &#039;dhtmlx&#039;
var simple_loaded, custom_loaded, rdp_loaded;
mode=&#039;clade&#039;  // or individual
document.getElementById(&#039;select_type_clade&#039;).checked = true;

$(document).ready(function(){

    $(&#039;.selectpicker&#039;).selectpicker({showSubtext:true, tickIcon: &#039;&#039;,});
    //unit_selection_id
    //$(&quot;#unit_selection_id&quot;).on(&quot;change&quot;, get_requested_units_selection_box);
    $(&quot;#unit_choice_id&quot;).on(&quot;change&quot;, show_tax_selection_box);

    toggle_meta_r_btn = document.getElementById(&#039;toggle_meta_r_btn&#039;) || null;
    if (toggle_meta_r_btn !== null) {
      toggle_meta_r_btn.addEventListener(&#039;click&#039;, function () {
          toggle_required_metadata();
      });
    }

    toggle_meta_c_btn = document.getElementById(&#039;toggle_meta_c_btn&#039;) || null;
    if (toggle_meta_c_btn !== null) {
      toggle_meta_c_btn.addEventListener(&#039;click&#039;, function () {
          toggle_custom_metadata();
      });
    }

    //get_requested_units_selection_box(unit_choice);

    load_initial_taxa_tree(unit_choice);
    //load_custom_tree();
    

});

if (get_graphics_btn !== null)
{

  get_graphics_btn.addEventListener(&#039;click&#039;, function () {
    //var unit_choice = get_graphics_form[&quot;unit_choice&quot;].value;
    // alert(unit_choice)
    msg = &#039;You must select some taxa&#039;;
    var selected_unit_choice = document.getElementById(&#039;unit_choice_id&#039;).value
    //alert(selected_unit_choice+&#039; &#039;+custom_selection)
    if (selected_unit_choice === &#039;tax_silva119_simple&#039;)
    {
      var taxa_checked = check_form(get_graphics_form, msg, &quot;silva119_domains[]&quot;);
    }else if (selected_unit_choice === &#039;tax_rdp_simple&#039;){
      var taxa_checked = check_form(get_graphics_form, msg, &quot;rdp_domains[]&quot;);
    }else if (selected_unit_choice === &#039;tax_silva119_custom&#039;)
    {
      if(custom_selection == &#039;html&#039;){
        var taxa_checked = check_form(get_graphics_form, msg, &quot;custom_taxa&quot;);
        //var taxa_checked = check_form(get_graphics_form, msg, &quot;ft_1&quot;);
      }else if(custom_selection == &#039;fancytree&#039;){
        tree = $(&#039;#custom_treebox&#039;).fancytree(&#039;getTree&#039;);
        // nodes are weird: node[0]= &lt;FancytreeNode(#1, &#039;Archaea&#039;)&gt;
        var node_ids = $.map(tree.getSelectedNodes(), function(node){
            return node.key;
        });
        // add hidden input
        if(node_ids === &#039;&#039;){
          alert(msg)
          return
        }else{
          var input = document.createElement(&#039;input&#039;);
          input.type = &#039;hidden&#039;;
          input.name = &#039;custom_taxa&#039;;
          input.value = node_ids.toString();
          get_graphics_form.appendChild(input);
        }
        
      }else if(custom_selection == &#039;dhtmlx&#039;){
        var node_ids = customTree.getAllChecked()
        // nodes are keys to server: new_taxonomy.taxa_tree_dict_map_by_id
        //alert(node_ids)
        //alert(typeof node_ids)
        if(node_ids === &#039;&#039;){
          alert(msg)
          return
        }else{
          var input = document.createElement(&#039;input&#039;);
          input.type = &#039;hidden&#039;;
          input.name = &#039;custom_taxa&#039;;
          input.value = node_ids.toString();
          get_graphics_form.appendChild(input);
        }
        
      }
      get_graphics_form.submit();
      
    }else{
      alert(&#039;ERROR &#039;+selected_unit_choice)
    }
    if (taxa_checked)
    {
     // msg = &#039;You must select one or more display output choices&#039;;
     // check_form(get_graphics_form, msg, &quot;visuals[]&quot;);
    }
  });
}
//
// TOGGLE_SIMPLE_TAXA
//
function toggle_simple_taxa(ckbxclass,togglebtn)
{
  // page: unit_selection
  // units: taxonomy
  // toggles domain checkboxes on/off
  
  var boxes = document.getElementsByClassName(ckbxclass);
  var i;
  //alert(boxes)
  if (boxes[0].checked === false) {
      for (i = 0; i &lt; boxes.length; i++) {
          boxes[i].checked = true;
          togglebtn.checked = true;
      }
  } else {
      for (i = 0; i &lt; boxes.length; i++) {
          boxes[i].checked = false;
          togglebtn.checked = false;
    }
  }
}
//
// TOGGLE_REQUIRED_METADATA
//
function toggle_required_metadata()
{
  // page: unit_selection
  // units: taxonomy
  // toggles domain checkboxes on/off
  var boxes = document.getElementsByClassName(&#039;required_meta_ckbx&#039;);
  var i;
  if (boxes[0].checked === false) {
      for (i = 0; i &lt; boxes.length; i++) {
          boxes[i].checked = true;
          document.getElementById(&#039;toggle_meta_r_btn&#039;).checked = true;
      }
  } else {
      for (i = 0; i &lt; boxes.length; i++) {
          boxes[i].checked = false;
          document.getElementById(&#039;toggle_meta_r_btn&#039;).checked = false;
    }
  }
}
//
// TOGGLE_CUSTOM_METADATA
//
function toggle_custom_metadata()
{
  // page: unit_selection
  // units: taxonomy
  // toggles domain checkboxes on/off
  var boxes = document.getElementsByClassName(&#039;custom_meta_ckbx&#039;);
  var i;
  if (boxes[0].checked === false) {
      for (i = 0; i &lt; boxes.length; i++) {
          boxes[i].checked = true;
          document.getElementById(&#039;toggle_meta_c_btn&#039;).checked = true;
      }
  } else {
      for (i = 0; i &lt; boxes.length; i++) {
          boxes[i].checked = false;
          document.getElementById(&#039;toggle_meta_c_btn&#039;).checked = false;
    }
  }
}
//
//
//
function load_initial_taxa_tree(unit_choice) {
  //get_requested_units_selection_box(unit_choice)
  // all created on INITIAL PAGE LOAD
  document.getElementById(&#039;unit_choice_id&#039;).value = unit_choice
  var xmlhttp2 = new XMLHttpRequest();
  switch(unit_choice){
    case &#039;tax_silva119_simple&#039;:
      load_simple_tax();
      // globals
      simple_loaded = true;  custom_loaded = false; rdp_loaded = false;// fancytree_loaded = false;  dhtmlx_loaded = false
      document.getElementById(&#039;simple_treebox&#039;).style.display = &#039;block&#039;
      document.getElementById(&#039;custom_tax_div&#039;).style.display = &#039;none&#039;
      document.getElementById(&#039;rdp_treebox&#039;).style.display = &#039;none&#039;
      
      break;
    case &#039;tax_silva119_custom&#039;:
      load_custom_tax_tree();
      // globals
      simple_loaded = false;  custom_loaded = true; rdp_loaded = false;// fancytree_loaded = false;  dhtmlx_loaded = false
      document.getElementById(&#039;simple_treebox&#039;).style.display = &#039;none&#039;
      document.getElementById(&#039;custom_tax_div&#039;).style.display = &#039;block&#039;
      document.getElementById(&#039;rdp_treebox&#039;).style.display = &#039;none&#039;
      
      break;
    case &#039;tax_rdp_simple&#039;:
        
      load_rdp_tax_simple()
      // globals
      simple_loaded = false;  custom_loaded = false; rdp_loaded = true;
      document.getElementById(&#039;simple_treebox&#039;).style.display = &#039;none&#039;
      document.getElementById(&#039;custom_tax_div&#039;).style.display = &#039;none&#039;
      document.getElementById(&#039;rdp_treebox&#039;).style.display = &#039;block&#039;
      
      break;   
    
    default:
      alert(unit_choice+&#039; not implemented...&#039;)
  }
  
  xmlhttp2.open(&quot;GET&quot;, &#039;set_units?units=&#039;+unit_choice);
  xmlhttp2.send();

}
function load_simple_tax() {
      var xmlhttp1 = new XMLHttpRequest();
      xmlhttp1.open(&quot;GET&quot;, &#039;/visuals/partials/tax_silva119_simple&#039;);
      xmlhttp1.onreadystatechange = function() {

             if (xmlhttp1.readyState == 4 ) {

                var data = xmlhttp1.responseText;
                
                //alert(file_id)
                document.getElementById(&#039;unit_choice_id&#039;).value = &#039;tax_silva119_simple&#039;
                //show_custom_taxa_tree();
                
                document.getElementById(&#039;simple_treebox&#039;).innerHTML = data;
                toggle_taxa_btn = document.getElementById(&#039;toggle_taxa_silva_btn&#039;) || null;
                if (toggle_taxa_btn !== null) {
                  toggle_taxa_btn.addEventListener(&#039;click&#039;, function () {
                      
                      toggle_simple_taxa(&#039;simple_taxa_silva_ckbx&#039;,toggle_taxa_btn);
                  });
                } 
                simple_loaded = true
             }
      };
      xmlhttp1.send();
}
function load_custom_tax_tree() {
      
      switch(custom_selection){

        case &#039;html&#039;:
            var xmlhttp1 = new XMLHttpRequest();
            xmlhttp1.open(&quot;GET&quot;, &#039;/visuals/partials/tax_silva119_custom&#039;);
            xmlhttp1.onreadystatechange = function() {

                   if (xmlhttp1.readyState == 4 ) {

                      var data = xmlhttp1.responseText;
                      
                     //alert(file_id)
                      document.getElementById(&#039;unit_choice_id&#039;).value = &#039;tax_silva119_custom&#039;
                      //show_custom_taxa_tree();
                      
                      //alert(&#039;custom&#039;)
                      document.getElementById(&#039;custom_treebox&#039;).innerHTML = data;
                      show_custom_taxa_tree()
                      custom_loaded = true
                   
                      
                   }
            };
            xmlhttp1.send();
            break;
        case &#039;fancytree&#039;:
            load_fancytree();
            // customTree.bind(&quot;fancytreedblclick&quot;, function(event, data){
            //   if( data.node.isFolder() ){
            //     return false;
            //   }
            // });
            break;
        case &#039;dhtmlx&#039;:
            load_dhtmlx()
            break;
        default:
          alert(&#039;error&#039;)
    }

}
function load_rdp_tax_simple() {
      
      var xmlhttp = new XMLHttpRequest();
      xmlhttp.open(&quot;GET&quot;, &#039;/visuals/partials/tax_rdp_simple&#039;);
      xmlhttp.onreadystatechange = function() {

             if (xmlhttp.readyState == 4 ) {

                var data = xmlhttp.responseText;
                
                //alert(file_id)
                document.getElementById(&#039;unit_choice_id&#039;).value = &#039;tax_rdp_simple&#039;
                //show_custom_taxa_tree();
                
                document.getElementById(&#039;rdp_treebox&#039;).innerHTML = data;
                toggle_taxa_btn = document.getElementById(&#039;toggle_taxa_rdp_btn&#039;) || null;
                if (toggle_taxa_btn !== null) {
                  toggle_taxa_btn.addEventListener(&#039;click&#039;, function () {
                      
                      toggle_simple_taxa(&#039;simple_taxa_rdp_ckbx&#039;,toggle_taxa_btn);
                  });
                } 
                rdp_loaded = true
             }
      };
      xmlhttp.send();
}
// function load_fancytree() {
    
//     //customFile = &quot;/json/tax_silva108_custom_fancytree.json&quot; 
//     customTree = $(&quot;#custom_treebox&quot;).fancytree({
//       checkbox: true,
//       icon: false,
//       clickFolderMode: 4,
//       selectMode: 3,
//       keyPathSeparator: &quot;/&quot;,
//       //generateIds: true,
//       //idPrefix:&#039;XXX_&#039;,
//       //imagePath:&#039;fancytree&#039;,
//       //source:  JSON.parse(data),
//       source:  {
//         //url:customFile,
//         url:&#039;/visuals/tax_custom_fancytree&#039;
//       },
//       //dblclick: function(event, data) {
//       //  return false;
//       //},
//       dblclick: function(event, data) {
//         //data.node.toggleSelected();
//         //data.node.toggleExpanded();
//         //alert(data.node)
//         var node = data.node;
//         //id = node.id
//         var id = node.key
//         var taxon = node.title
//         //alert(taxon) 
//         expand_children_fancytree(node)
//         return false;  // this turns off/on default behavior
//       },
//       lazyLoad: function(event, data){
//           var node = data.node;
//           //alert(node.key,&#039; &#039;,node.node_id)
//           // Load child nodes via ajax GET /getTreeData?mode=children&amp;parent=1234
//           data.result = {
//              url: &quot;/visuals/tax_custom_fancytree?id=&quot;+node.key,
//              data: {mode: &quot;children&quot;, parent: node.key},
//              cache: false
//            };
//       },
      
//     });
//     custom_loaded = true
// }

// function expand_children_fancytree(node) {
//   //alert(node)

  

//   if(node.isExpanded()){
//     // second+ times through: -- node is open
//     // get children and open one level

//     child_nodes = node.getChildren()
//     // alert(child_nodes)
//     for(i in child_nodes){
//        cnode = child_nodes[i]
//        alert(cnode)
       
       
//        expand_children(cnode)
//     }
//   }else{
//     //first time through: node is not expanded: must open(lazy) first
//     node.load().done(function() {
//         //child_nodes = node.getChildren()
        
//         node.setExpanded(true);
//         //alert(child_nodes)
//         // for(i in child_nodes){
//         //   cnode = child_nodes[i]
//         //   //expand_children(cnode)
//         //   cnode.setExpanded()
//         // }
//         //node.visit(function(childNode) {
//           //alert(childNode)
//           //node.setExpanded(true);
//            // childNode.setExpanded(true);
//             //expand_children(childNode)
//         //});
//     });

//     //child_nodes = node.getChildren()
//   }
  
//   //alert(child_nodes)
//   // for(n in child_nodes){
//   //   cnode = child_nodes[n]
//   //   alert(cnode)
//   // }
// }
function load_dhtmlx() {
    customTree = new dhtmlXTreeObject(&quot;custom_treebox&quot;,&quot;100%&quot;,&quot;100%&quot;,0);
    customTree.setImagesPath(&quot;/images/dhtmlx/imgs/&quot;);
    customTree.enableCheckBoxes(true);
    //customTree.enableThreeStateCheckboxes(true);
    customTree.enableTreeLines(true); // true by default
    customTree.enableTreeImages(false);
    customTree.attachEvent(&quot;onCheck&quot;,function(id){
        on_check_dhtmlx(id)
    });
    customTree.attachEvent(&quot;onDblClick&quot;, function(id){
        expand_tree_dhtmlx(id)
    });
    
    
    customTree.setXMLAutoLoading(&quot;/visuals/tax_custom_dhtmlx&quot;);
	  customTree.setDataMode(&quot;json&quot;);
	  //load first level of tree
	  customTree.load(&quot;/visuals/tax_custom_dhtmlx?id=0&quot;,&quot;json&quot;);
    
    // USING file: AJAX not needed here
    //customFile = &quot;/json/tax_silva108_custom_dhtmlx.json&quot;
    //customTree.load(customFile,&quot;json&quot;);
    
    custom_loaded = true
    
}

// initialize

function change_mode_dhtmlx(change_to_mode){
  mode = change_to_mode;
  //document.getElementById(&#039;select_type_&#039;+change_to_mode).checked = true;
}

function reset_tree_dhtmlx(){
  clk_counter = 0
  customTree.refreshItem();
}
function on_check_dhtmlx(id){

  if(mode == &#039;individual&#039;) 
   {
       //this.setSubChecked(id,false);
       // allows only the individual checkbox tobe 
       // selected or unselected.
      // if(customTree.isItemChecked(id)){
      //   alert(&#039;checked&#039;)
      //   //customTree.setCheck(id,false);

      // }else{
      //   alert(&#039;not checked&#039;)
      //   //customTree.setCheck(id,true);
      // }

      
   }else{  // clade mode ....
       customTree.openItem(id);
  
       if(customTree.isItemChecked(id)){
          customTree.setSubChecked(id,false);
          customTree.setCheck(id,true);   
          //alert(id)
       }else{
             //turn off this level
          customTree.setCheck(id,false);
          subTaxons = customTree.getAllSubItems(id);
          subTaxonsArray = subTaxons.split(&#039;,&#039;);
          //alert(subTaxons)
          for(i=0;i&lt;subTaxonsArray.length;i++)
          {
           
            sid = subTaxonsArray[i];
            //alert(sid)
            //open state only applies to folders/nodes not leaves
            openState = customTree.getOpenState(sid);
            //alert(openState)
            //customTree.setCheck(sid,true);
          
            if(openState &lt; 1){
              customTree.setCheck(sid,true);  
            }else{
              customTree.setCheck(sid,false); 
            }
    
          } //end of loop
          
       }

   }  
  // if(customTree.getOpenState(id)){
    
  //   nodes = customTree.getAllSubItems(id)
  //   alert(nodes)
  //   customTree.setSubChecked(id,true)

  // }else{
  //   // closed -- do nothing
  // }
}

function expand_tree_dhtmlx(id){
  //alert(customTree.hasChildren(id))
  //kids = customTree.getAllSubItems(id);
  level = customTree.getLevel(id)
  clk_counter = 0
  //clk_counter = level
  //alert(level)
  if ( customTree.hasChildren(id) ) {
       
      //clk_counter++;
      //if(clk_counter+level &lt;= 7){
        //document.getElementById(&#039;custom_rank_info&#039;).innerHTML = &#039;opening;
        customTree.openAllItems(id,true); 

      //}else{
      //  alert(&#039;no more levels&#039;)
      //}

      
       
        // openkids = customTree.getAllSubItems(id).split(&#039;,&#039;);
        // //alert(openkids)
        // gotone = false
        // for(i in openkids){
        //   if(customTree.hasChildren(id)){
        //     gotone = true
        //   }
        // }
        // if(openkids !=[] &amp;&amp; ! gotone){
        //   alert(gotone)
        // }

        
        //taxon = taxa[ccid];
        
        //alert(kids)
        // if(kids !=0)
        // {
             
        //      // here we try to prevent opening the OTU list on double click
        //      kids_array = kids.split(&#039;,&#039;);
        //      new_kids=&#039;&#039;;
        //      for(n=0;n&lt;kids_array.length;n++){
                  
        //         new_kids = new_kids + kids_array[n] + &#039;,&#039;;
                 
        //      }
        //      kids = new_kids.replace(/,$/,&quot;&quot;);
             
        //      this.openItemsDynamic(kids,false);
        // }
  }else{
    alert(&#039;no sub-levels found&#039;)
  }

}
function show_tax_selection_box() {
  // show/hide
  //alert(&#039;in s-h sel box&#039;)
  target = this.value
  var xmlhttp2 = new XMLHttpRequest();
  xmlhttp2.open(&quot;GET&quot;, &#039;set_units?units=&#039;+target);
  xmlhttp2.send();
  //alert(target)
  document.getElementById(&#039;unit_choice_id&#039;).value = target
  switch(target){
    case &#039;tax_silva119_simple&#039;:
        if(!simple_loaded){
          load_simple_tax()
        }
        document.getElementById(&#039;rdp_treebox&#039;).style.display = &#039;none&#039;
        document.getElementById(&#039;simple_treebox&#039;).style.display = &#039;block&#039;
        document.getElementById(&#039;custom_tax_div&#039;).style.display = &#039;none&#039;
        
        break;
    case &#039;tax_silva119_custom&#039;:
        if(!custom_loaded){
          load_custom_tax_tree()
        }
        document.getElementById(&#039;rdp_treebox&#039;).style.display = &#039;none&#039;
        document.getElementById(&#039;simple_treebox&#039;).style.display = &#039;none&#039;
        document.getElementById(&#039;custom_tax_div&#039;).style.display = &#039;block&#039;
        
        break;
    case &#039;tax_rdp_simple&#039;:
        if(!rdp_loaded){
          load_rdp_tax_simple()
        }
        
        document.getElementById(&#039;rdp_treebox&#039;).style.display = &#039;block&#039;
        document.getElementById(&#039;simple_treebox&#039;).style.display = &#039;none&#039;
        document.getElementById(&#039;custom_tax_div&#039;).style.display = &#039;none&#039;
        
        break;   
    // case &#039;tax_silva108_custom_fancytree&#039;:
    //   if(!fancytree_loaded){
    //       load_fancytree()
    //     }
    //     document.getElementById(&#039;simple_treebox&#039;).style.display = &#039;none&#039;
    //     document.getElementById(&#039;custom_treebox&#039;).style.display = &#039;none&#039;
    //     document.getElementById(&#039;custom_treebox_fancytree&#039;).style.display = &#039;block&#039;
    //     document.getElementById(&#039;custom_treebox_dhtmlx&#039;).style.display = &#039;none&#039;
        
    //     break;
    // case &#039;tax_silva108_custom_dhtmlx&#039;:
    //   if(!dhtmlx_loaded){
    //       load_dhtmlx()
    //     }
    //     document.getElementById(&#039;simple_treebox&#039;).style.display = &#039;none&#039;
    //     document.getElementById(&#039;custom_treebox&#039;).style.display = &#039;none&#039;
    //     document.getElementById(&#039;custom_treebox_fancytree&#039;).style.display = &#039;none&#039;
    //     document.getElementById(&#039;custom_treebox_dhtmlx&#039;).style.display = &#039;block&#039;
        
    //     break;
    default:
        document.getElementById(&#039;simple_treebox&#039;).style.display = &#039;none&#039;
        document.getElementById(&#039;custom_tax_div&#039;).style.display = &#039;none&#039;
        alert(&#039;Not Implemented Yet&#039;)
  }
  
}

//
// GET REQUESTED UNITS SELECTION BOX
//
// function get_requested_units_selection_box(file) {
  
//   if(this.value){
//     var file_id = this.value
//   }else{
//     var file_id = file
//   }
//   //alert(file_id)
//   //alert(file_id)
//   // Using ajax it will show the requested units module
//   var file = &#039;&#039;;
//   var partial_name = &#039;/visuals/partials/&#039;+file_id;
//   //var partial_name = &#039;/public/json/tax_silva108_custom.json&#039; //+file_id;
//   //alert(partial_name)
//   var xmlhttp1 = new XMLHttpRequest();
//   var xmlhttp2 = new XMLHttpRequest();
  
//   $(&quot;#echoSelection&quot;).text(&#039;&#039;);
//   document.getElementById(&#039;units_select_choices_div&#039;).innerHTML = &#039;Loading&#039;;

//   if(file_id == &#039;tax_silva108_custom_fancytree&#039;){
//                 customFile = &quot;/json/tax_silva108_custom_fancytree.json&quot; 
//                 customTree = $(&quot;#units_select_choices_div&quot;).fancytree({
//                   checkbox: true,
//                   icon: false,
//                   clickFolderMode: 4,
//                   selectMode: 2,
//                   keyPathSeparator: &quot;/&quot;,
//                   //generateIds: true,
//                   //idPrefix:&#039;XXX_&#039;,
//                   //imagePath:&#039;fancytree&#039;,
//                   //source:  JSON.parse(data),
//                   source:  {
//                     url:customFile
//                   },


//                   select: function(event, data) {
//                     // Display list of selected nodes
//                     var selNodes = data.tree.getSelectedNodes();
//                     // convert to title/key array
//                     var selKeys = $.map(selNodes, function(node){
//                          return &quot;[&quot; + node.key + &quot;]: &#039;&quot; + node.title + &quot;&#039;&quot;;
//                          //return node.getKeyPath()
//                       });
//                     $(&quot;#echoSelection&quot;).text(selKeys);
//                   },
//                   click: function(event, data) {
//                     // We should not toggle, if target was &quot;checkbox&quot;, because this
//                     // would result in double-toggle (i.e. no toggle)
//                     if( $.ui.fancytree.getEventTargetType(event) === &quot;title&quot; ){
//                       data.node.toggleSelected();
//                     }
//                   },
//                   keydown: function(event, data) {
//                     if( event.which === 32 ) {
//                       data.node.toggleSelected();
//                       return false;
//                     }
//                   }

//                   //cache: true
//                   //source: $.ajax({url:file_path,  dataType: &quot;json&quot;})
                    
//                 });
                
//                 $(&#039;#get_graphics_form&#039;).submit(function() {
//                   // Render hidden &lt;input&gt; elements for active and selected nodes
                  
//                   $(&quot;#units_select_choices_div&quot;).fancytree(&quot;getTree&quot;).generateFormElements();

//                   //alert(&quot;POST data:\n&quot; + jQuery.param($(this).serializeArray()));
                  
//                   // return false to prevent submission of this sample
//                   //return false;
//                 });
//                 xmlhttp2.open(&quot;GET&quot;, &#039;set_units?units=&#039;+file_id);
//                 xmlhttp2.send();
//   }else if(file_id == &#039;tax_silva108_custom_dhtmlx&#039;){
//                 customTree = new dhtmlXTreeObject(&quot;units_select_choices_div&quot;,&quot;100%&quot;,&quot;100%&quot;,0);
//                 customTree.setImagesPath(&quot;/images/dhtmlx/imgs/&quot;);
//                 customTree.enableCheckBoxes(true);
//                 customTree.enableTreeLines(true); // true by default
//                 customTree.enableTreeImages(false);
//                 customTree.enableThreeStateCheckboxes(true);
//                 customTree.enableSmartCheckboxes(true);
//                 //customTree.setImagesPath(&quot;/Users/avoorhis/programming/vamps-node.js/public/images/dhtmlx/imgs/&quot;);
                
//                 // USING file: AJAX not needed here
//                 customFile = &quot;/json/tax_silva108_custom_dhtmlx.json&quot;
//                 //document.getElementById(&#039;units_select_choices_div&#039;).innerHTML = &#039;customTree&#039;;
                
//                 customTree.load(customFile,&quot;json&quot;);
//                 xmlhttp2.open(&quot;GET&quot;, &#039;set_units?units=&#039;+file_id);
//                 xmlhttp2.send();
//   }else{  
//       //xmlhttp1.addEventListener(&quot;load&quot;, transferComplete(file_id), false);
//       //alert(&#039;simple&#039;)
//       xmlhttp1.open(&quot;GET&quot;, partial_name);
//       xmlhttp1.onreadystatechange = function() {

//              if (xmlhttp1.readyState == 4 ) {

//                 var data = xmlhttp1.responseText;
                
//                //alert(file_id)
//                 document.getElementById(&#039;unit_choice_id&#039;).value = file_id
//                 //show_custom_taxa_tree();
//                 if(file_id == &#039;tax_silva108_simple&#039;){
                  
//                     document.getElementById(&#039;units_select_choices_div&#039;).innerHTML = data;
//                     toggle_taxa_btn = document.getElementById(&#039;toggle_taxa_btn&#039;) || null;
//                     if (toggle_taxa_btn !== null) {
//                       toggle_taxa_btn.addEventListener(&#039;click&#039;, function () {
//                           toggle_simple_taxa();
//                       });
//                     } 

//                 }else if(file_id == &#039;tax_silva108_custom&#039;){
//                     //alert(&#039;custom&#039;)
//                     document.getElementById(&#039;units_select_choices_div&#039;).innerHTML = data;
//                     show_custom_taxa_tree()
                    
//                 }
                
//              }
//       };
//       xmlhttp1.send();
//   }
// }
// function get_requested_units_selection_box_orig(file) {
//   //alert(file)
//   if(this.value){
//     var file_id = this.value
//   }else{
//     var file_id = file
//   }
  
//   //alert(file_id)
//   // Using ajax it will show the requested units module
//   var file = &#039;&#039;;
//   var partial_name = &#039;/visuals/partials/&#039;+file_id;
//   //alert(partial_name)
//   var xmlhttp1 = new XMLHttpRequest();
//   var xmlhttp2 = new XMLHttpRequest();
//   xmlhttp1.addEventListener(&quot;load&quot;, transferComplete(file_id), false);

//   xmlhttp1.open(&quot;GET&quot;, partial_name);
//   xmlhttp1.onreadystatechange = function() {

//          if (xmlhttp1.readyState == 4 ) {

//             var string = xmlhttp1.responseText;
//             var div = document.getElementById(&#039;units_select_choices_div&#039;).innerHTML = string;
//            //alert(file_id)
//             document.getElementById(&#039;unit_selection_id&#039;).value = file_id
//             show_custom_taxa_tree();
//             if(file_id == &#039;tax_silva108_simple&#039;){
//               toggle_taxa_btn = document.getElementById(&#039;toggle_taxa_btn&#039;) || null;
//               //alert(toggle_taxa_btn)
//               if (toggle_taxa_btn !== null) {
//                 toggle_taxa_btn.addEventListener(&#039;click&#039;, function () {
//                     toggle_simple_taxa();
//                 });
//               }
//             }
//             xmlhttp2.open(&quot;GET&quot;, &#039;set_units?units=&#039;+file_id);
//             xmlhttp2.send();
//          }
//   };
//   xmlhttp1.send();
// }
// function get_requested_units_selection_box2(file) {
  
//   if(this.value){
//     var file_id = this.value
//   }else{
//     var file_id = file
//   }
//   //alert(file_id)
//   //alert(file_id)
//   // Using ajax it will show the requested units module
//   var file = &#039;&#039;;
//   var partial_name = &#039;/visuals/partials/&#039;+file_id;
//   //var partial_name = &#039;/public/json/tax_silva108_custom.json&#039; //+file_id;
//   //alert(partial_name)
//   var xmlhttp1 = new XMLHttpRequest();
//   var xmlhttp2 = new XMLHttpRequest();
//   document.getElementById(&#039;units_select_choices_div&#039;).innerHTML = &#039;&#039;;

    
//   //xmlhttp1.addEventListener(&quot;load&quot;, transferComplete(file_id), false);
//   //alert(&#039;simple&#039;)
//   xmlhttp1.open(&quot;GET&quot;, partial_name);
//   xmlhttp1.onreadystatechange = function() {

//          if (xmlhttp1.readyState == 4 ) {

//             var data = xmlhttp1.responseText;
            
//            //alert(file_id)
//             document.getElementById(&#039;unit_selection_id&#039;).value = file_id
//             //show_custom_taxa_tree();
//             if(file_id == &#039;tax_silva108_simple&#039;){
              
//                 document.getElementById(&#039;units_select_choices_div&#039;).innerHTML = data;
//                 toggle_taxa_btn = document.getElementById(&#039;toggle_taxa_btn&#039;) || null;
//                 if (toggle_taxa_btn !== null) {
//                   toggle_taxa_btn.addEventListener(&#039;click&#039;, function () {
//                       toggle_simple_taxa();
//                   });
//                 } 

//             }else{
              
//                 //alert(data)
//                 $(&quot;#units_select_choices_div&quot;).fancytree({
//                   checkbox: true,
//                   icon: false,
//                   clickFolderMode: 4,
//                   selectMode: 2,
//                   keyPathSeparator: &quot;/&quot;,
//                   //generateIds: true,
//                   //idPrefix:&#039;XXX_&#039;,
//                   //imagePath:&#039;fancytree&#039;,
//                   source:  JSON.parse(data),
//                   //source:  treeData //JSON.parse(data),
//                   select: function(event, data) {
//                     // Display list of selected nodes
//                     var selNodes = data.tree.getSelectedNodes();
//                     // convert to title/key array
//                     var selKeys = $.map(selNodes, function(node){
//                          return &quot;[&quot; + node.key + &quot;]: &#039;&quot; + node.title + &quot;&#039;&quot;;
//                          //return node.getKeyPath()
//                       });
//                     $(&quot;#echoSelection&quot;).text(selKeys);
//                   },
//                   click: function(event, data) {
//                     // We should not toggle, if target was &quot;checkbox&quot;, because this
//                     // would result in double-toggle (i.e. no toggle)
//                     if( $.ui.fancytree.getEventTargetType(event) === &quot;title&quot; ){
//                       data.node.toggleSelected();
//                     }
//                   },
//                   keydown: function(event, data) {
//                     if( event.which === 32 ) {
//                       data.node.toggleSelected();
//                       return false;
//                     }
//                   }

//                   //cache: true
//                   //source: $.ajax({url:file_path,  dataType: &quot;json&quot;})
                    
//                 });
                
//                 $(&#039;#get_graphics_form&#039;).submit(function() {
//                   // Render hidden &lt;input&gt; elements for active and selected nodes
                  
//                   $(&quot;#units_select_choices_div&quot;).fancytree(&quot;getTree&quot;).generateFormElements();

//                   //alert(&quot;POST data:\n&quot; + jQuery.param($(this).serializeArray()));
                  
//                   // return false to prevent submission of this sample
//                   //return false;
//                 });



//             }
//             xmlhttp2.open(&quot;GET&quot;, &#039;set_units?units=&#039;+file_id);
//             xmlhttp2.send();
//          }
//   };
//   xmlhttp1.send();

// }

function transferComplete(file_id) {
  // alert(&quot;The transfer is complete.&quot;);
  // var div = document.getElementById(&#039;units_select_choices_div&#039;).innerHTML = string;
  // alert(file_id);
  // if (file_id === &quot;tax_silva108_custom&quot;)
  // {
  //   show_custom_taxa_tree();
  //   // convertTrees();
  // }
}

// visualization: check_form_pg2.js



// custom taxa tree
function show_custom_taxa_tree()
{
  $(&#039;.tree li:has(ul)&#039;).addClass(&#039;parent_li&#039;);
  $(&#039;.tree .parent_li &gt; span.sign &gt; i&#039;).addClass(&#039;icon-plus-sign&#039;).removeClass(&#039;icon-no-sign&#039;);

// hide by default
  $(&#039;.tree li.parent_li &gt; span&#039;).filter(&#039;.sign&#039;).each(function(i,e){
      if ($(this).find(&#039;i&#039;).hasClass(&quot;icon-plus-sign&quot;)){
          $(this).parent(&#039;li.parent_li&#039;).find(&#039; &gt; ul &gt; li&#039;).hide();
          $(this).attr(&#039;title&#039;, &#039;Expand this branch&#039;);
      }
  });

// domains are checked at the beginning
  $(&#039;.tree ul.domain &gt; li.parent_li &gt; input&#039;).each(function(i,e){
      $(this).prop( &quot;checked&quot;, true );
  });

  $(&#039;.tree li.parent_li &gt; span&#039;).filter(&#039;.sign&#039;).click(toggle_children);

  // Default Selection Mode: Clade
  $(&#039;input.custom-taxa&#039;).click({param1: &quot;clade&quot;}, check_input);

  $(&#039;.radiobox input&#039;).click(function() {
    check_mode = this.id;
    $(&#039;input.custom-taxa&#039;).unbind(&#039;click&#039;);
    $(&#039;input.custom-taxa&#039;).click({param1: check_mode}, check_input);

  });

  $(&#039;.open-one-layer&#039;).dblclick(open_one_layer);
}

var check_input = function(event)
{
  var check_mode = event.data.param1;
  var children = $(this).parent(&#039;li.parent_li&#039;).find(&#039; &gt; ul &gt; li&#039;);
  if (children.is(&quot;:visible&quot;)) {
    check_mode === &quot;clade&quot; ? check_last_visible(this) : toggle_checking;

  } 
  // uncomment to show children on check
  // else {
    // show_children(this);
    // alert(&quot;HERE&quot;);
  // }
};

var open_one_layer = function()
{
   first_hidden_class = $(this).parent(&#039;li.parent_li&#039;).find(&quot;:hidden:first&quot;).parent().attr(&#039;class&#039;);
   $(this).parent(&#039;li.parent_li&#039;).find(&quot;.&quot; + first_hidden_class).each(function(i)
   {
     try
     {
        show_children(this);
     }
     catch(e)
     {
       //Handle errors here
     }
  });
};

var check_last_visible = function(this_input)
{
  all_plus_vis = $(this_input).closest(&#039;ul&#039;).find(&#039;.icon-plus-sign:visible, .icon-no-sign:visible&#039;);
  all_inputs_vis = all_plus_vis.closest(&#039;span.sign&#039;).siblings(&#039;input.custom-taxa&#039;);
  all_inputs_vis.each(toggle_checking);
};

var show_children = function(current)
{
  $(current).parent(&#039;li.parent_li&#039;).find(&#039; &gt; ul &gt; li&#039;).show(&#039;fast&#039;);
  var span_sign = $(current).parent(&#039;li.parent_li&#039;).find(&#039; &gt; span&#039;).filter(&#039;.sign&#039;);
  span_sign.attr(&#039;title&#039;, &#039;Collapse this branch&#039;);
  span_sign.find(&#039; &gt; i&#039;).addClass(&#039;icon-minus-sign&#039;).removeClass(&#039;icon-plus-sign&#039;);
};

var hide_children = function(current, children)
{
  children.hide(&#039;fast&#039;);
  $(current).parent(&#039;li.parent_li&#039;).find(&#039; &gt; span.sign &gt; i&#039;).addClass(&#039;icon-plus-sign&#039;).removeClass(&#039;icon-minus-sign&#039;);
};

// todo: the same in project_dataset_tree.js
var toggle_checking = function()
{
  $(this.parentNode.parentNode).find(&#039;input&#039;).filter(&quot;:visible&quot;).prop(&#039;checked&#039;,
     function(idx, oldProp) {
       return !oldProp;
     });
};

var count_checked = function()
{
  a = $( &quot;input&quot; ).filter(&#039;:checked&#039;).length;
  alert(a);
};

// todo: similar in project_dataset_tree.js
var uncheck_closed =  function(current)
{
  $(current).siblings().find(&#039;input&#039;).each(function(i){$(this).prop( &quot;checked&quot;, false )});
};

var toggle_children = function()
{
    var children = $(this).parent(&#039;li.parent_li&#039;).find(&#039; &gt; ul &gt; li&#039;);
    var current = this;
    if (children.is(&quot;:visible&quot;)) {
        hide_children(current, children);
        uncheck_closed(this);
    } else {
        show_children(this);
    }

    return false;
};</textarea>
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p>.</p>
  </div>
</footer>

<script type="text/html" id="complexity-popover-template">
  <div class="complexity-notice">
    Complexity : {{ complexity.cyclomatic }} <br>
    Length : {{ complexity.halstead.length }} <br>
    Difficulty : {{ complexity.halstead.difficulty.toFixed(2) }} <br>
    Est # bugs : {{ complexity.halstead.bugs.toFixed(2) }}<br>
  </div>
</script>

<script type="text/javascript" src="../../assets/scripts/bundles/core-bundle.js"></script>
<script type="text/javascript" src="../../assets/scripts/bundles/codemirror.js"></script>
<script type="text/javascript" src="../../assets/scripts/codemirror.markpopovertext.js"></script>
<script type="text/javascript" src="report.js"></script>
<script type="text/javascript" src="report.history.js"></script>
<script type="text/javascript" src="../../assets/scripts/plato-file.js"></script>
</body>
</html>
