<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Plato - public/javascripts/user_viz_data.js</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link href="../../assets/css/vendor/morris.css" rel="stylesheet">
  <link href="../../assets/css/vendor/bootstrap.css" rel="stylesheet">
  <link href="../../assets/css/vendor/font-awesome.css" rel="stylesheet">
  <link href="../../assets/css/vendor/codemirror.css" rel="stylesheet">
  <link href="../../assets/css/plato.css" rel="stylesheet">
  <link href="../../assets/css/plato-file.css" rel="stylesheet">

</head>

<body>

<div class="navbar navbar-fixed-top">
  <div class="container">
    <a class="navbar-brand" href="http://github.com/es-analysis/plato">Plato on Github</a>
    <ul class="nav navbar-nav">
      <li>
        <a href="../../index.html">Report Home</a>
      </li>
    </ul>
  </div>
</div>

<div class="jumbotron">
  <div class="container">
    <h1>public/javascripts/user_viz_data.js</h1>
  </div>
</div>

<div class="container aggregate-stats">
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Maintainability <a href="http://blogs.msdn.com/b/codeanalysis/archive/2007/11/20/maintainability-index-range-and-meaning.aspx"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="A value between 0 and 100 that represents the relative ease of maintaining the code. A high value means better maintainability." data-original-title="Maintainability Index"  data-container="body"></i></a></h2>
      <p class="stat">54.18</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Lines of code <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h2>
      <p class="stat">235</p>
    </div>
  </div>
  <div class="row historical">
    <div class="col-md-6">
      <p id="chart_historical_maint" class="chart"></p>
    </div>
    <div class="col-md-6">
      <p id="chart_historical_sloc" class="chart"></p>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Difficulty  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="The difficulty measure is related to the difficulty of the program to write or understand." data-original-title="Difficulty" data-container="body"></i></a></h2>
      <p class="stat">44.41</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Estimated Errors  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Halstead's delivered bugs is an estimate for the number of errors in the implementation." data-original-title="Delivered Bugs" data-container="body"></i></a></h2>
      <p class="stat">2.98</p>
    </div>
  </div>
</div>

<div class="container charts">
  <div class="row">
    <h2 class="header">Function weight</h2>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h3 class="chart-header">By Complexity <a href="http://en.wikipedia.org/wiki/Cyclomatic_complexity"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="This metric counts the number of distinct paths through a block of code. Lower values are better." data-original-title="Cyclomatic Complexity" data-container="body"></i></a></h3>
      <div id="fn-by-complexity" class="stat"></div>
    </div>
    <div class="col-md-6">
      <h3 class="chart-header">By SLOC  <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h3>
      <div id="fn-by-sloc" class="stat"></div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <textarea id="file-source" class="col-md-12">//
//  CREATE SINGLE BARCHART on page load
//
var $liveTip = $(&#039;&lt;div id=&quot;livetip_chart&quot;&gt;&lt;/div&gt;&#039;).hide().appendTo(&#039;body&#039;),
    $win = $(window),
    showTip;

var tip = {
  title: &#039;&#039;,
  offset: 12,
  delay: 50,
  position: function(event) {
    var positions = {x: event.pageX, y: event.pageY};
    var dimensions = {
      x: [
        $win.width(),
        $liveTip.outerWidth()
      ],
      y: [
        $win.scrollTop() + $win.height(),
        $liveTip.outerHeight()
      ]
    };
 
    for ( var axis in dimensions ) {
 
      if (dimensions[axis][0] &lt;dimensions[axis][1] + positions[axis] + this.offset) {
        positions[axis] -= dimensions[axis][1] + this.offset;
      } else {
        positions[axis] += this.offset;
      }
 
    }
 
    $liveTip.css({
      top: positions.y,
      left: positions.x
    });
  }
};


// download fasta
var download_fasta_btn = document.getElementById(&#039;download_fasta_btn&#039;) || null;
if (download_fasta_btn !== null) {
  download_fasta_btn.addEventListener(&#039;click&#039;, function () {
      
      form = document.getElementById(&#039;download_fasta_form_id&#039;);
      download_type = form.download_type.value; 
      ts =  &#039;&#039;;       
      download_data(&#039;fasta&#039;, download_type, ts);
  });
}


function get_single_bar_html(obj){
  
  var total = 0;
  var html =&#039;&#039;;
  var tax_col_count = 0;
  var ordered_taxa = [];
  var taxa;
  var ranks = [&#039;Domain&#039;,&#039;Phylum&#039;,&#039;Class&#039;,&#039;Order&#039;,&#039;Family&#039;,&#039;Genus&#039;,&#039;Species&#039;,&#039;Strain&#039;]
  for(n in obj.rows){
    if(obj.data[n] &gt; 0){
      total += parseInt(obj.data[n]);
      taxa = obj.rows[n].id.split(&#039;;&#039;)

      ordered_taxa[n] = taxa
      if(taxa.length &gt; tax_col_count){
        tax_col_count = taxa.length
      }
    }
  }
  //alert(ordered_taxa)
  html += &quot;&lt;div class=&#039;overflow_500&#039;&gt;click headers to sort&quot;;
  html += &quot;&lt;table id=&#039;single_barchart_table_id&#039; class=&#039;table table-condensed overflow200 sortable&#039;&gt;&quot;;
  html += &#039;&lt;thead&gt;&#039;
  html += &quot;&lt;tr&gt;&lt;th width=&#039;25&#039; &gt;color&lt;/th&gt;&quot;;  //&lt;th&gt;Taxonomy &lt;small&gt;(click to sort)&lt;/small&gt;&lt;/th&gt;
  for(i=0;i&lt;tax_col_count;i++){
    html += &#039;&lt;th&gt;&#039;+ranks[i]+&#039;&lt;/th&gt;&#039;
  }
  html += &quot;&lt;th&gt;Count&lt;/th&gt;&lt;/tr&gt;&quot;;
  
  html += &#039;&lt;/thead&gt;&lt;tbody&gt;&#039;
  
  //alert(html)
  for(n in obj.rows){
    if(obj.data[n] &gt; 0){
      color = string_to_color_code(obj.rows[n].id)
      link = &#039;sequences?id=&#039;+obj.columns[0].id+&#039;&amp;taxa=&#039;+encodeURIComponent(obj.rows[n].id)+&#039;&amp;filename=&#039;+filename;
      var pct = ((obj.data[n] / total)*100).toFixed(2);
      var id = &#039;barcharts-|-&#039; + obj.rows[n].id + &#039;-|-&#039;+ obj.data[n] + &#039;-|-&#039; + pct;
      html += &quot;&lt;tr class=&#039;tooltip_viz&#039; id=&#039;&quot;+id+&quot;&#039; &gt;&lt;td style=&#039;background-color:&quot;+color+&quot;&#039;&gt;&lt;/td&gt;&quot;;
      for(i=0;i&lt;tax_col_count;i++){
        html += &quot;&lt;td&gt;&lt;a href=&#039;&quot;+link+&quot;&#039;&gt;&quot;+ordered_taxa[n][i]+&#039;&lt;/a&gt;&lt;/td&gt;&#039;
      }
      html += &#039;&lt;td&gt;&#039;+obj.data[n]+&quot;&lt;/td&gt;&lt;/tr&gt;&quot;;
    }
  }
  html += &#039;&lt;/tbody&gt;&#039;
  html += &#039;&lt;/table&gt;&lt;/div&gt;&#039;;
  
  return html;
}
//
//
//
function get_double_bar_html(obj, ts){
  
  var total = [0,0];
  var ranks = [&#039;Domain&#039;,&#039;Phylum&#039;,&#039;Class&#039;,&#039;Order&#039;,&#039;Family&#039;,&#039;Genus&#039;,&#039;Species&#039;,&#039;Strain&#039;]
  var pct1,pct2,id1,id2,link1,link2,filename1,filename2,color,taxa;
  var tax_col_count = 0;
  var ordered_taxa = [];
  for(n in obj.rows){
    if(obj.data[n][0] &gt; 0 || obj.data[n][1] &gt; 0){
      total[0] += parseInt(obj.data[n][0]);
      total[1] += parseInt(obj.data[n][1]);
      taxa = obj.rows[n].id.split(&#039;;&#039;)
      ordered_taxa[n] = taxa
      if(taxa.length &gt; tax_col_count){
          tax_col_count = taxa.length
      }
    }
  }
  var html =&#039;&#039;;

  html += &quot;&lt;div class=&#039;overflow_500&#039;&gt;click headers to sort&quot;;
  html += &quot;&lt;table class=&#039;table table-condensed overflow200 sortable&#039;&gt;&quot;;
  html += &#039;&lt;thead&gt;&#039;
  html += &quot;&lt;tr&gt;&lt;th width=&#039;25&#039; &gt;color&lt;/th&gt;&quot;
  for(i=0;i&lt;tax_col_count;i++){
    html += &#039;&lt;th&gt;&#039;+ranks[i]+&#039;&lt;/th&gt;&#039;
  }
  html += &quot;&lt;th&gt;&quot;+obj.datasets[0]+&quot; &lt;/th&gt;&lt;th&gt;&quot;+obj.datasets[1]+&quot;&lt;/th&gt;&lt;/tr&gt;&quot;;
  html += &#039;&lt;/thead&gt;&lt;tbody&gt;&#039;
  
  for(n in obj.rows){
      if(obj.data[n][0] &gt; 0 || obj.data[n][1] &gt; 0){
        color = string_to_color_code(obj.rows[n].id)
        filename1 = user_local+&#039;_&#039;+obj.columns[0].did+&#039;_&#039;+ts+&#039;_sequences.json&#039;;
        filename2 = user_local+&#039;_&#039;+obj.columns[1].did+&#039;_&#039;+ts+&#039;_sequences.json&#039;;
        link1 = &#039;sequences?id=&#039;+obj.columns[0].id+&#039;&amp;taxa=&#039;+encodeURIComponent(obj.rows[n].id)+&#039;&amp;filename=&#039;+filename1;
        link2 = &#039;sequences?id=&#039;+obj.columns[1].id+&#039;&amp;taxa=&#039;+encodeURIComponent(obj.rows[n].id)+&#039;&amp;filename=&#039;+filename2;
        pct1 = ((obj.data[n][0] / total[0])*100).toFixed(2);
        id1 = &#039;barcharts-|-&#039; + obj.rows[n].id + &#039;-|-&#039;+ obj.data[n][0] + &#039;-|-&#039; + pct1;
        pct2 = ((obj.data[n][1] / total[1])*100).toFixed(2);
        id2 = &#039;barcharts-|-&#039; + obj.rows[n].id + &#039;-|-&#039;+ obj.data[n][1] + &#039;-|-&#039; + pct2;
        html += &quot;&lt;tr&gt;&quot;
        html += &quot;&lt;td style=&#039;background-color:&quot;+color+&quot;&#039;&gt;&lt;/td&gt;&quot;;
        for(i=0;i&lt;tax_col_count;i++){
          html += &quot;&lt;td&gt;&quot;+ordered_taxa[n][i]+&#039;&lt;/td&gt;&#039;
        }
        html += &quot;&lt;td class=&#039;tooltip_viz&#039; id=&#039;&quot;+id1+&quot;&#039; &gt;&lt;a href=&#039;&quot;+link1+&quot;&#039;&gt;&quot;+obj.data[n][0]+&#039;&lt;/a&gt;&lt;/td&gt;&#039;
        //html += &quot;&lt;td class=&#039;tooltip_viz&#039; id=&#039;&quot;+id2+&quot;&#039; &gt;&quot;+obj.data[n][1]+&#039;&lt;/td&gt;&#039;
        html += &quot;&lt;td class=&#039;tooltip_viz&#039; id=&#039;&quot;+id2+&quot;&#039; &gt;&lt;a href=&#039;&quot;+link2+&quot;&#039;&gt;&quot;+obj.data[n][1]+&#039;&lt;/a&gt;&lt;/td&gt;&#039;
        html += &quot;&lt;/tr&gt;&quot;;
      }
  }
  html += &#039;&lt;/tbody&gt;&#039;
  html += &#039;&lt;/table&gt;&lt;/div&gt;&#039;;
  
  return html;
}
//
//
//
function download_data(type, download_type, ts) {
    var html = &#039;&#039;;
    var args =  &quot;download_type=&quot;+download_type;
    
    var xmlhttp = new XMLHttpRequest(); 
    if(type == &#039;metadata&#039;){
      target = &#039;/user_data/download_selected_metadata&#039;;      
    } else if(type == &#039;fasta&#039;){
      target = &#039;/user_data/download_selected_seqs&#039;
    }else if(type == &#039;matrix&#039;){
      //alert(ts)
      args += &#039;&amp;ts=&#039;+ts;
      target = &#039;/user_data/download_selected_matrix&#039;
    }else{

    }
    xmlhttp.open(&quot;POST&quot;, target, true);
    xmlhttp.setRequestHeader(&quot;Content-type&quot;,&quot;application/x-www-form-urlencoded&quot;);
    xmlhttp.onreadystatechange = function() {
      if (xmlhttp.readyState == 4 ) {
         var filename = xmlhttp.responseText; 
         html += &quot;&lt;div class=&#039;&#039;&gt;Your file is being compiled. &quot;
         html += &quot; When ready your file can be downloaded from the file retrieval page under &#039;Your Data&#039;: &quot;+filename+&quot;&lt;/div&gt;&quot;
         document.getElementById(&#039;download_confirm_id&#039;).innerHTML = html;
      }
    };
    xmlhttp.send(args);   
}
//
//
//
function hide_seqs(id, taxa, fname){
  checked_seqs = document.getElementById(&#039;hide_seqs_cb&#039;).checked;
  checked_taxa = document.getElementById(&#039;hide_tax_cb&#039;).checked;

  seq_tds = document.getElementsByClassName(&#039;hide_class_seq&#039;);
  for(i in seq_tds){
    if(checked_seqs){
        seq_tds[i].style.display = &#039;none&#039;
    }else{
        seq_tds[i].style.display = &#039;inline&#039;;
    }
  }
  
}
//
//
//
function hide_tax(id, taxa, fname){
  checked_seqs = document.getElementById(&#039;hide_seqs_cb&#039;).checked;
  checked_taxa = document.getElementById(&#039;hide_tax_cb&#039;).checked;
  tax_tds = document.getElementsByClassName(&#039;hide_class_tax&#039;);
  
  for(i in tax_tds){
    if(checked_taxa){
        tax_tds[i].style.display = &#039;none&#039;
    }else{
        tax_tds[i].style.display = &#039;inline&#039;;
    }
  }
      
}
//
//
//
function ncbi_blast(seq){

  var ncbi_url = &quot;https://blast.ncbi.nlm.nih.gov/Blast.cgi?PROGRAM=blastn&amp;PAGE_TYPE=BlastSearch&amp;LINK_LOC=blasthome&amp;QUERY=&quot;
  window.open(ncbi_url+seq)
}</textarea>
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p>.</p>
  </div>
</footer>

<script type="text/html" id="complexity-popover-template">
  <div class="complexity-notice">
    Complexity : {{ complexity.cyclomatic }} <br>
    Length : {{ complexity.halstead.length }} <br>
    Difficulty : {{ complexity.halstead.difficulty.toFixed(2) }} <br>
    Est # bugs : {{ complexity.halstead.bugs.toFixed(2) }}<br>
  </div>
</script>

<script type="text/javascript" src="../../assets/scripts/bundles/core-bundle.js"></script>
<script type="text/javascript" src="../../assets/scripts/bundles/codemirror.js"></script>
<script type="text/javascript" src="../../assets/scripts/codemirror.markpopovertext.js"></script>
<script type="text/javascript" src="report.js"></script>
<script type="text/javascript" src="report.history.js"></script>
<script type="text/javascript" src="../../assets/scripts/plato-file.js"></script>
</body>
</html>
