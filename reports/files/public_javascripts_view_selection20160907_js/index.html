<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Plato - public/javascripts/view_selection20160907.js</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link href="../../assets/css/vendor/morris.css" rel="stylesheet">
  <link href="../../assets/css/vendor/bootstrap.css" rel="stylesheet">
  <link href="../../assets/css/vendor/font-awesome.css" rel="stylesheet">
  <link href="../../assets/css/vendor/codemirror.css" rel="stylesheet">
  <link href="../../assets/css/plato.css" rel="stylesheet">
  <link href="../../assets/css/plato-file.css" rel="stylesheet">

</head>

<body>

<div class="navbar navbar-fixed-top">
  <div class="container">
    <a class="navbar-brand" href="http://github.com/es-analysis/plato">Plato on Github</a>
    <ul class="nav navbar-nav">
      <li>
        <a href="../../index.html">Report Home</a>
      </li>
    </ul>
  </div>
</div>

<div class="jumbotron">
  <div class="container">
    <h1>public/javascripts/view_selection20160907.js</h1>
  </div>
</div>

<div class="container aggregate-stats">
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Maintainability <a href="http://blogs.msdn.com/b/codeanalysis/archive/2007/11/20/maintainability-index-range-and-meaning.aspx"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="A value between 0 and 100 that represents the relative ease of maintaining the code. A high value means better maintainability." data-original-title="Maintainability Index"  data-container="body"></i></a></h2>
      <p class="stat">60.79</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Lines of code <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h2>
      <p class="stat">2761</p>
    </div>
  </div>
  <div class="row historical">
    <div class="col-md-6">
      <p id="chart_historical_maint" class="chart"></p>
    </div>
    <div class="col-md-6">
      <p id="chart_historical_sloc" class="chart"></p>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Difficulty  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="The difficulty measure is related to the difficulty of the program to write or understand." data-original-title="Difficulty" data-container="body"></i></a></h2>
      <p class="stat">97.26</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Estimated Errors  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Halstead's delivered bugs is an estimate for the number of errors in the implementation." data-original-title="Delivered Bugs" data-container="body"></i></a></h2>
      <p class="stat">33.81</p>
    </div>
  </div>
</div>

<div class="container charts">
  <div class="row">
    <h2 class="header">Function weight</h2>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h3 class="chart-header">By Complexity <a href="http://en.wikipedia.org/wiki/Cyclomatic_complexity"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="This metric counts the number of distinct paths through a block of code. Lower values are better." data-original-title="Cyclomatic Complexity" data-container="body"></i></a></h3>
      <div id="fn-by-complexity" class="stat"></div>
    </div>
    <div class="col-md-6">
      <h3 class="chart-header">By SLOC  <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h3>
      <div id="fn-by-sloc" class="stat"></div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <textarea id="file-source" class="col-md-12">$(document).ready(function(){

    $(&#039;.selectpicker&#039;).selectpicker({showSubtext:true, tickIcon: &#039;&#039;,});

    $(&quot;#metadata_table_div&quot;).on(&quot;click&quot;, &quot;#metadata_table&quot;, function () {
        new Tablesort(document.getElementById(&#039;metadata_table&#039;));
    });
    // capture entire page click -- to cancel(hide) charts
    //document.body.addEventListener(&#039;click&#039;, hide_chart(e), true);
    //$(window).click(function(e){
    //  e_page_click = window.event
     // page_click(e_page_click)
    //});
    //click_on_graph_icon = false;
});

$.fn.scrollView = function () {
    return this.each(function () {
        $(&#039;html, body&#039;).animate({
            scrollTop: $(this).offset().top - 80
        }, 500);
    });
}

// code for tooltips

var $liveTip = $(&#039;&lt;div id=&quot;livetip_chart&quot;&gt;&lt;/div&gt;&#039;).hide().appendTo(&#039;body&#039;),
    $win = $(window),
    showTip;

var tip = {
  title: &#039;&#039;,
  offset: 12,
  delay: 50,
  position: function(event) {
    var positions = {x: event.pageX, y: event.pageY};
    var dimensions = {
      x: [
        $win.width(),
        $liveTip.outerWidth()
      ],
      y: [
        $win.scrollTop() + $win.height(),
        $liveTip.outerHeight()
      ]
    };
    for ( var axis in dimensions ) {
      if (dimensions[axis][0] &lt;dimensions[axis][1] + positions[axis] + this.offset) {
        positions[axis] -= dimensions[axis][1] + this.offset;
      } else {
        positions[axis] += this.offset;
      }
    }
    $liveTip.css({
      top: positions.y,
      left: positions.x
    });
  }
};

$(&quot;body&quot;).delegate(&quot;.tooltip_viz&quot;, &quot;mouseover mouseout mousemove&quot;, function (event) {
      var link = this,
      html = &#039;&#039;;
      $link = $(this);
     
      if (event.type == &#039;mouseover&#039;) {
        tip.id = link.id;
        link.id = &#039;&#039;;
        id_items = tip.id.split(&#039;-|-&#039;);
        html = &quot;&lt;table&gt;&lt;tr&gt;&quot;;
        if(id_items[0] == &#039;dheatmap&#039;) {
          html += &quot;&lt;td&gt;&quot;+id_items[1]+&quot;&lt;/td&gt;&quot;;
          html += &quot;&lt;/tr&gt;&lt;tr&gt;&quot;;
          html += &quot;&lt;td&gt;&quot;+id_items[2]+&quot;&lt;/td&gt;&quot;;
          html += &quot;&lt;/tr&gt;&lt;tr&gt;&quot;;
          html += &quot;&lt;td&gt;Distance: &quot;+id_items[3]+&quot;&lt;/td&gt;&quot;;
        }else if(id_items[0] == &#039;frequencies&#039;){
          html += &quot;&lt;td&gt;&quot;+id_items[1]+&quot;&lt;/td&gt;&quot;;
          html += &quot;&lt;/tr&gt;&lt;tr&gt;&quot;;
          html += &quot;&lt;td&gt;&quot;+id_items[2]+&quot;&lt;/td&gt;&quot;;
          html += &quot;&lt;/tr&gt;&lt;tr&gt;&quot;;
          html += &quot;&lt;td&gt;Count: &quot;+id_items[3]+&quot; (&quot;+id_items[4]+&quot;%)&lt;/td&gt;&quot;;
        }else{  // barcharts and piecharts            
          html += &quot;&lt;td&gt;&quot;+id_items[1]+&quot;&lt;/td&gt;&quot;;
          html += &quot;&lt;/tr&gt;&lt;tr&gt;&quot;;
          html += &quot;&lt;td&gt;Count: &quot;+id_items[2]+&quot; (&quot;+id_items[3]+&quot;%)&lt;/td&gt;&quot;;
        }
        html += &quot;&lt;/tr&gt;&lt;table&gt;&quot;;
        showTip = setTimeout(function() {
          $link.data(&#039;tipActive&#039;, true);
          tip.position(event);
          //alert(event.pageX)
          $liveTip
          .html(&#039;&lt;div&gt;&#039; + html  + &#039;&lt;/div&gt;&#039;)
          .fadeOut(0)
          .fadeIn(200);
     
        }, tip.delay);
      }
      if (event.type == &#039;mouseout&#039;) {
        link.id = tip.id || link.id;
        if ($link.data(&#039;tipActive&#039;)) {
          $link.removeData(&#039;tipActive&#039;);
          $liveTip.hide();
        } else {
          clearTimeout(showTip);
        }
      }
      if (event.type == &#039;mousemove&#039; &amp;&amp; $link.data(&#039;tipActive&#039;)) {
        tip.position(event);
      }      
});              

$(&quot;body&quot;).delegate(&quot;.tooltip_viz_help&quot;, &quot;mouseover mouseout mousemove&quot;, function (event) {
      var link = this,
      html = &#039;&#039;;
      $link = $(this);
     
      if (event.type == &#039;mouseover&#039;) {
        tip.id = link.id;
        //alert(tip.id)
        link.id = &#039;&#039;;
        if(tip.id==&#039;&#039;){
          return;  // no need to show if nothing there
        }
        id_items = tip.id.split(&#039;-|-&#039;);
        
        // html = &quot;Requirements:&lt;br&gt;&quot;;
        // html += &#039;&lt;ul&gt;&#039;;        
        // for(var i=0;i&lt;=id_items.length-1;i++){
        //    //html += &quot;&lt;tr&gt;&lt;td&gt;&quot;+id_items[i]+&quot;&lt;/td&gt;&lt;/tr&gt;&quot;; 
        //    html += &quot;&lt;li&gt;&quot;+id_items[i]+&quot;&lt;/li&gt;&quot;      
        // }
        // html += &#039;&lt;/ul&gt;&#039;;


        html = &quot;&lt;table&gt;&quot;;
        html += &quot;&lt;tr&gt;&lt;td&gt;Requirements:&lt;/td&gt;&lt;/tr&gt;&quot;;
        for(var i=0;i&lt;=id_items.length-1;i++){
          html += &quot;&lt;tr&gt;&lt;td&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&quot;+id_items[i]+&quot;&lt;/td&gt;&lt;/tr&gt;&quot;;       
        }
        html += &quot;&lt;table&gt;&quot;;

        
        showTip = setTimeout(function() {
     
          $link.data(&#039;tipActive&#039;, true);
          
          tip.position(event);
     //alert(event.pageX)
          $liveTip
          .html(&#039;&lt;div&gt;&#039; + html  + &#039;&lt;/div&gt;&#039;)
          .fadeOut(0)
          .fadeIn(200);
     
        }, tip.delay);
      }
     
      if (event.type == &#039;mouseout&#039;) {
        link.id = tip.id || link.id;
        if ($link.data(&#039;tipActive&#039;)) {
          $link.removeData(&#039;tipActive&#039;);
          $liveTip.hide();
        } else {
          clearTimeout(showTip);
        }
      }
     
      if (event.type == &#039;mousemove&#039; &amp;&amp; $link.data(&#039;tipActive&#039;)) {
        tip.position(event);
      }
              
});    


var showDots=&#039;&#039;;

// Save Confiuration
save_config = document.getElementById(&#039;save_config_id&#039;) || null;
if (save_config !== null) {
  save_config.addEventListener(&#039;click&#039;, function () {
      save_configuration(ds_local,user_local);
  });
}

// create fasta
var download_fasta_btn = document.getElementById(&#039;download_fasta_btn&#039;) || null;
if (download_fasta_btn !== null) {
  download_fasta_btn.addEventListener(&#039;click&#039;, function () {
      //alert(selected_distance_combo)
      form = document.getElementById(&#039;download_fasta_form_id&#039;);
      download_type = form.download_type.value; 
      ts =  &#039;&#039;;       
      download_data(&#039;fasta&#039;,  download_type, ts);
  });
}

// create metadata
var download_metadata_btn = document.getElementById(&#039;download_metadata_btn&#039;) || null;
if (download_metadata_btn !== null) {
  download_metadata_btn.addEventListener(&#039;click&#039;, function () {
      //alert(selected_distance_combo)
      form = document.getElementById(&#039;download_metadata_form_id&#039;);
      download_type = form.download_type.value;  
      ts =  &#039;&#039;;      
      download_data(&#039;metadata&#039;, download_type, ts);
  });
}
// create counts matrix
var download_matrix_btn = document.getElementById(&#039;download_matrix_btn&#039;) || null;
if (download_matrix_btn !== null) {
  download_matrix_btn.addEventListener(&#039;click&#039;, function () {
      
      form = document.getElementById(&#039;download_matrix_form_id&#039;);
      download_type = form.download_type.value;       
      ts =  form.ts.value;    
      download_data(&#039;matrix&#039;, download_type, ts);
  });
}



function create_freq_table_file(script, ts) {
    // for view_selection tables: frequency 
    download_data(script, &#039;partial_project&#039;, ts);
}
function transfer_file_for_download(script, ts) {
    download_data(script, &#039;&#039;, ts);
}



// normalization radio-buttons
var norm_counts_radios = document.getElementsByName(&#039;normalization&#039;);
if (typeof norm_counts_radios[1] !==&quot;undefined&quot;) {
  norm_counts_radios[1].addEventListener(&#039;click&#039;, function () {
    val = norm_counts_radios[1].value
    //alert(&#039;1 &#039;+val)
    document.getElementById(&#039;output_choices_submit_btn&#039;).disabled = false;
    document.getElementById(&#039;output_choices_submit_btn&#039;).innerHTML=&#039;&lt;span class=&quot;glyphicon glyphicon-alert&quot; aria-hidden=&quot;true&quot;&gt;&lt;/span&gt; Update&#039;
    document.getElementById(&#039;output_choices_submit_btn&#039;).style.background = &#039;#FF6600&#039;;
  });
}
if (typeof norm_counts_radios[2] !==&quot;undefined&quot;) {
  norm_counts_radios[2].addEventListener(&#039;click&#039;, function () {
    val = norm_counts_radios[2].value
    //alert(&#039;2 &#039;+val)
    document.getElementById(&#039;output_choices_submit_btn&#039;).disabled = false;
    document.getElementById(&#039;output_choices_submit_btn&#039;).innerHTML=&#039;&lt;span class=&quot;glyphicon glyphicon-alert&quot; aria-hidden=&quot;true&quot;&gt;&lt;/span&gt; Update&#039;
    document.getElementById(&#039;output_choices_submit_btn&#039;).style.background = &#039;#FF6600&#039;;
  });
}
if (typeof norm_counts_radios[3] !==&quot;undefined&quot;) {
  norm_counts_radios[3].addEventListener(&#039;click&#039;, function () {
    //alert(&#039;3&#039;)
    document.getElementById(&#039;output_choices_submit_btn&#039;).disabled = false;
    document.getElementById(&#039;output_choices_submit_btn&#039;).innerHTML=&#039;&lt;span class=&quot;glyphicon glyphicon-alert&quot; aria-hidden=&quot;true&quot;&gt;&lt;/span&gt; Update&#039;
    document.getElementById(&#039;output_choices_submit_btn&#039;).style.background = &#039;#FF6600&#039;;
  });
}
// include_nas radio-buttons
var include_nas_radios = document.getElementsByName(&#039;include_nas&#039;);
if (typeof include_nas_radios[1] !==&quot;undefined&quot;) {
  include_nas_radios[1].addEventListener(&#039;click&#039;, function () {
    //alert(&#039;1&#039;)
    document.getElementById(&#039;output_choices_submit_btn&#039;).disabled = false;
    document.getElementById(&#039;output_choices_submit_btn&#039;).innerHTML=&#039;&lt;span class=&quot;glyphicon glyphicon-alert&quot; aria-hidden=&quot;true&quot;&gt;&lt;/span&gt; Update&#039;
    document.getElementById(&#039;output_choices_submit_btn&#039;).style.background = &#039;#FF6600&#039;;
  });
}
if (typeof include_nas_radios[2] !==&quot;undefined&quot;) {
  include_nas_radios[2].addEventListener(&#039;click&#039;, function () {
    //alert(&#039;2&#039;)
    document.getElementById(&#039;output_choices_submit_btn&#039;).disabled = false;
    document.getElementById(&#039;output_choices_submit_btn&#039;).innerHTML=&#039;&lt;span class=&quot;glyphicon glyphicon-alert&quot; aria-hidden=&quot;true&quot;&gt;&lt;/span&gt; Update&#039;
    document.getElementById(&#039;output_choices_submit_btn&#039;).style.background = &#039;#FF6600&#039;;
  });
}
// Distance Metric Select (Combo)
var selected_distance_combo = document.getElementById(&#039;selected_distance&#039;);
if (typeof selected_distance_combo !==&quot;undefined&quot;) {
  $(&#039;.selectpicker&#039;).on(&#039;change&#039;, function () {
      //alert(selected_distance_combo)
      document.getElementById(&#039;output_choices_submit_btn&#039;).disabled = false;
    document.getElementById(&#039;output_choices_submit_btn&#039;).innerHTML=&#039;&lt;span class=&quot;glyphicon glyphicon-alert&quot; aria-hidden=&quot;true&quot;&gt;&lt;/span&gt; Update&#039;
      document.getElementById(&#039;output_choices_submit_btn&#039;).style.background = &#039;#FF6600&#039;;
  });
}
// MIN Select (Combo)
var min_range_combo = document.getElementById(&#039;min_range&#039;) ;
if (typeof min_range_combo !==&quot;undefined&quot;) {
  min_range_combo.addEventListener(&#039;change&#039;, function () {
      document.getElementById(&#039;output_choices_submit_btn&#039;).disabled = false;
    document.getElementById(&#039;output_choices_submit_btn&#039;).innerHTML=&#039;&lt;span class=&quot;glyphicon glyphicon-alert&quot; aria-hidden=&quot;true&quot;&gt;&lt;/span&gt; Update&#039;
      document.getElementById(&#039;output_choices_submit_btn&#039;).style.background = &#039;#FF6600&#039;;
  });
}
// MAX Select (Combo)
var max_range_combo = document.getElementById(&#039;max_range&#039;);
if (typeof max_range_combo !==&quot;undefined&quot;) {
  max_range_combo.addEventListener(&#039;change&#039;, function () {
      document.getElementById(&#039;output_choices_submit_btn&#039;).disabled = false;
    document.getElementById(&#039;output_choices_submit_btn&#039;).innerHTML=&#039;&lt;span class=&quot;glyphicon glyphicon-alert&quot; aria-hidden=&quot;true&quot;&gt;&lt;/span&gt; Update&#039;
      document.getElementById(&#039;output_choices_submit_btn&#039;).style.background = &#039;#FF6600&#039;;
  });
}
////////////////////////////////////////////////////////////////////////////////
var visuals = [&#039;counts_table&#039;,&#039;metadata_table&#039;,&#039;dheatmap&#039;,&#039;barcharts&#039;,&#039;piecharts&#039;,&#039;fheatmap&#039;,&#039;dbrowser&#039;,
                &#039;dendrogram01&#039;,&#039;dendrogram03&#039;,&#039;pcoa&#039;,&#039;pcoa3d&#039;,&#039;geodistribution&#039;,&#039;adiversity&#039;,&#039;phyloseq_bars01&#039;,
                &#039;phyloseq_hm02&#039;,&#039;phyloseq_nw03&#039;,&#039;phyloseq_ord04&#039;,&#039;phyloseq_tree05&#039;]    
for(i in visuals){
  alert(visuals[i])
}
//
//
////  VISUALIZATION BUTTONS  \\\\
// COUNTS Table
//
var tax_counts_link = document.getElementById(&#039;counts_table_link_id&#039;) || null;
var tax_counts_btn = document.getElementById(&#039;counts_table_hide_btn&#039;);
var tax_counts_div = document.getElementById(&#039;counts_table_div&#039;);
//var counts_table_download_btn = document.getElementById(&#039;counts_table_download_btn&#039;);
var pre_counts_table_div = document.getElementById(&#039;pre_counts_table_div&#039;);
if (tax_counts_link !== null) {
    tax_counts_link.addEventListener(&#039;click&#039;, function () {
    
  if(typeof tax_table_created == &quot;undefined&quot;){
        create_viz(&#039;counts_table&#039;, pi_local.ts, false);
    //counts_table_download_btn.disabled = false;
    }else{
        if(tax_counts_btn.value == &#039;hide&#039;){
          //toggle_visual_element(tax_counts_div,&#039;show&#039;,tax_counts_btn);
        }else{
          toggle_visual_element(tax_counts_div,&#039;hide&#039;,tax_counts_btn);
        }
    }
  $(pre_counts_table_div).scrollView();
  });
}
if (typeof tax_counts_btn !==&quot;undefined&quot;) {
  tax_counts_btn.addEventListener(&#039;click&#039;, function () {
      if(tax_counts_btn.value == &#039;hide&#039;){
        toggle_visual_element(tax_counts_div,&#039;show&#039;,tax_counts_btn);
      }else{
        toggle_visual_element(tax_counts_div,&#039;hide&#039;,tax_counts_btn);
      }
  });
}
if (typeof counts_table_download_btn !==&quot;undefined&quot;) {
  
    counts_table_download_btn.addEventListener(&#039;click&#039;, function () {
   //alert(ds_local.ids)
   download_data(&#039;matrix&#039;, JSON.stringify(ds_local), &#039;partial_project&#039;, pi_local.ts)

  });
}
var counts_table_open_btn = document.getElementById(&#039;counts_table_open_btn&#039;) || null;
if (counts_table_open_btn !== null) {
  counts_table_open_btn.addEventListener(&#039;click&#039;, function () {
      
      create_viz(&#039;counts_table&#039;, pi_local.ts, true);      
  });
}
//
// METADATA  Table
//

var metadata_link = document.getElementById(&#039;metadata_table_link_id&#039;) || null;
var metadata_btn = document.getElementById(&#039;metadata_table_hide_btn&#039;);
var metadata_div = document.getElementById(&#039;metadata_table_div&#039;);
//var metadata_download_btn = document.getElementById(&#039;metadata_download_btn&#039;);
var pre_metadata_table_div = document.getElementById(&#039;pre_metadata_table_div&#039;);
if (metadata_link !== null) {
    metadata_link.addEventListener(&#039;click&#039;, function () {
     
    //$(window).scrollTo(500);
    
    if(typeof metadata_table_created == &quot;undefined&quot;){
        create_viz(&#039;metadata_table&#039;, pi_local.ts, false);
    //metadata_download_btn.disabled = false;
      }else{
        if(metadata_btn.value == &#039;hide&#039;){
          //toggle_visual_element(metadata_div,&#039;show&#039;,metadata_btn);
        }else{
          toggle_visual_element(metadata_div,&#039;hide&#039;,metadata_btn);
        }
      }
      $(pre_metadata_table_div).scrollView();
  });
}
if (typeof metadata_btn !==&quot;undefined&quot;) {
  metadata_btn.addEventListener(&#039;click&#039;, function () {
      //alert(&#039;here in tt&#039;)
      if(metadata_btn.value == &#039;hide&#039;){
        toggle_visual_element(metadata_div,&#039;show&#039;,metadata_btn);
      }else{
        toggle_visual_element(metadata_div,&#039;hide&#039;,metadata_btn);
      }
      
  });
}
var metadata_open_btn = document.getElementById(&#039;metadata_table_open_btn&#039;) || null;
if (metadata_open_btn !== null) {
  metadata_open_btn.addEventListener(&#039;click&#039;, function () {
      
      create_viz(&#039;metadata_table&#039;, pi_local.ts, true);      
  });
}
//
// PIECHARTS
//
var piecharts_link = document.getElementById(&#039;piecharts_link_id&#039;) || null;
var piecharts_btn = document.getElementById(&#039;piecharts_hide_btn&#039;);
var piecharts_div = document.getElementById(&#039;piecharts_div&#039;);
//var piecharts_download_btn = document.getElementById(&#039;piecharts_download_btn&#039;);
var pre_piecharts_div = document.getElementById(&#039;pre_piecharts_div&#039;);
if (piecharts_link !== null) {
  piecharts_link.addEventListener(&#039;click&#039;, function () {
      
    if(typeof piecharts_created == &quot;undefined&quot;){
        create_viz(&#039;piecharts&#039;, pi_local.ts, false);
    //piecharts_download_btn.disabled = false;
      }else{
        if(piecharts_btn.value == &#039;hide&#039;){
          //toggle_visual_element(piecharts_div,&#039;show&#039;,piecharts_btn);
        }else{
          toggle_visual_element(piecharts_div,&#039;hide&#039;,piecharts_btn);
        }
      }
      $(pre_piecharts_div).scrollView();
  });
}
if (typeof piecharts_btn !==&quot;undefined&quot;) {
  piecharts_btn.addEventListener(&#039;click&#039;, function () {
      //alert(&#039;here in tt&#039;)
      if(piecharts_btn.value == &#039;hide&#039;){
        toggle_visual_element(piecharts_div,&#039;show&#039;,piecharts_btn);
      }else{
        toggle_visual_element(piecharts_div,&#039;hide&#039;,piecharts_btn);
      }
      
  });
}
var piecharts_open_btn = document.getElementById(&#039;piecharts_open_btn&#039;);
if (typeof piecharts_open_btn !== &quot;undefined&quot;) {
  piecharts_open_btn.addEventListener(&#039;click&#039;, function () {
      create_viz(&#039;piecharts&#039;, pi_local.ts, true);      
  });
}
//
// KRONA Chart (Data Browser)
//
// var dbrowser_link = document.getElementById(&#039;dbrowser_link_id&#039;) || null;
// var dbrowser_btn = document.getElementById(&#039;dbrowser_hide_btn&#039;);
// var dbrowser_div = document.getElementById(&#039;dbrowser_div&#039;);
// var dbrowser_download_btn = document.getElementById(&#039;dbrowser_download_btn&#039;);
// var pre_dbrowser_div = document.getElementById(&#039;pre_dbrowser_div&#039;);
// if (dbrowser_link !== null) {
//   dbrowser_link.addEventListener(&#039;click&#039;, function () {
      
//    if(typeof dbrowser_created == &quot;undefined&quot;){
//         create_viz(&#039;dbrowser&#039;, pi_local.ts);
//    dbrowser_download_btn.disabled = false;
//       }else{
//         if(dbrowser_btn.value == &#039;hide&#039;){
//           //toggle_visual_element(piecharts_div,&#039;show&#039;,dbrowser_btn);
//         }else{
//           toggle_visual_element(dbrowser_div,&#039;hide&#039;,dbrowser_btn);
//         }
//       }
//       $(pre_dbrowser_div).scrollView();
//   });
// }
// if (typeof dbrowser_btn !==&quot;undefined&quot;) {
//   dbrowser_btn.addEventListener(&#039;click&#039;, function () {
//       //alert(&#039;here in tt&#039;)
//       if(dbrowser_btn.value == &#039;hide&#039;){
//         toggle_visual_element(dbrowser_div,&#039;show&#039;,dbrowser_btn);
//       }else{
//         toggle_visual_element(dbrowser_div,&#039;hide&#039;,dbrowser_btn);
//       }
      
//   });
// }
//
// BARCHARTS
//
var barchart_link = document.getElementById(&#039;barcharts_link_id&#039;) || null;
var barcharts_btn = document.getElementById(&#039;barcharts_hide_btn&#039;);
var barcharts_div = document.getElementById(&#039;barcharts_div&#039;);
//var barcharts_download_btn = document.getElementById(&#039;barcharts_download_btn&#039;);
var pre_barcharts_div = document.getElementById(&#039;pre_barcharts_div&#039;);
if (barchart_link !== null) {
  barchart_link.addEventListener(&#039;click&#039;, function () {
      
    if(typeof barcharts_created == &quot;undefined&quot;){
        create_viz(&#039;barcharts&#039;, pi_local.ts, false);
        //barcharts_download_btn.disabled = false;
      }else{
        if(barcharts_btn.value == &#039;hide&#039;, false){        
          //toggle_visual_element(barcharts_div,&#039;show&#039;,barcharts_btn);
        }else{
          toggle_visual_element(barcharts_div,&#039;hide&#039;,barcharts_btn);
        }
      }
      $(pre_barcharts_div).scrollView();
  });
}
if (typeof barcharts_btn !==&quot;undefined&quot;) {
  barcharts_btn.addEventListener(&#039;click&#039;, function () {
      //alert(&#039;here in tt&#039;)
      if(barcharts_btn.value == &#039;hide&#039;){        
        toggle_visual_element(barcharts_div,&#039;show&#039;,barcharts_btn);
      }else{
        toggle_visual_element(barcharts_div,&#039;hide&#039;,barcharts_btn);
      }
      
  });
}
var barcharts_open_btn = document.getElementById(&#039;barcharts_open_btn&#039;);
if (typeof barcharts_open_btn !== &quot;undefined&quot;) {
  barcharts_open_btn.addEventListener(&#039;click&#039;, function () {
      create_viz(&#039;barcharts&#039;, pi_local.ts, true);      
  });
}
//
// DISTANCE HEATMAP
//
var dheatmap_link = document.getElementById(&#039;dheatmap_link_id&#039;) || null;
var dheatmap_hide_btn = document.getElementById(&#039;dheatmap_hide_btn&#039;);
var dheatmap_div = document.getElementById(&#039;dheatmap_div&#039;);
//var dheatmap_download_btn = document.getElementById(&#039;dheatmap_download_btn&#039;);
var pre_dheatmap_div = document.getElementById(&#039;pre_dheatmap_div&#039;);
if (dheatmap_link !== null) {
  dheatmap_link.addEventListener(&#039;click&#039;, function () {
      
    if(typeof dheatmap_created == &quot;undefined&quot;){
        create_viz(&#039;dheatmap&#039;, pi_local.ts, false);
        //dheatmap_download_btn.disabled = false;
      }else{
        if(dheatmap_hide_btn.value == &#039;hide&#039;){        
          //toggle_visual_element(dheatmap_div,&#039;show&#039;,dheatmap_btn);
        }else{
          toggle_visual_element(dheatmap_div,&#039;hide&#039;,dheatmap_hide_btn);
        }
      }
      $(pre_dheatmap_div).scrollView();
  });
}
if (typeof dheatmap_hide_btn !== &quot;undefined&quot;) {
  dheatmap_hide_btn.addEventListener(&#039;click&#039;, function () {
      //alert(&#039;here in tt&#039;)
      if(dheatmap_hide_btn.value == &#039;hide&#039;){        
        toggle_visual_element(dheatmap_div,&#039;show&#039;,dheatmap_hide_btn);
      }else{
        toggle_visual_element(dheatmap_div,&#039;hide&#039;,dheatmap_hide_btn);
      }
      
  });
}
var dheatmap_open_btn = document.getElementById(&#039;dheatmap_open_btn&#039;);
if (typeof dheatmap_open_btn !== &quot;undefined&quot;) {
  dheatmap_open_btn.addEventListener(&#039;click&#039;, function () {
      create_viz(&#039;dheatmap&#039;, pi_local.ts, true);      
  });
}
//
// FREQUENCY HEATMAP
//
var fheatmap_link = document.getElementById(&#039;fheatmap_link_id&#039;) || null;
var fheatmap_btn = document.getElementById(&#039;fheatmap_hide_btn&#039;);
var fheatmap_div = document.getElementById(&#039;fheatmap_div&#039;);
//var fheatmap_download_btn = document.getElementById(&#039;fheatmap_download_btn&#039;);
var pre_fheatmap_div = document.getElementById(&#039;pre_fheatmap_div&#039;);
if (fheatmap_link !== null) {
  fheatmap_link.addEventListener(&#039;click&#039;, function () {
      
    if(typeof fheatmap_created == &quot;undefined&quot;){
        create_viz(&#039;fheatmap&#039;, pi_local.ts, false);
    //fheatmap_download_btn.disabled = false;
      }else{
        if(fheatmap_btn.value == &#039;hide&#039;){        
          //toggle_visual_element(fheatmap_div,&#039;show&#039;,fheatmap_btn);
        }else{
          toggle_visual_element(fheatmap_div,&#039;hide&#039;,fheatmap_btn);
        }
      }  
    $(pre_fheatmap_div).scrollView();    
  });
}
if (typeof fheatmap_btn !== &quot;undefined&quot;) {
  fheatmap_btn.addEventListener(&#039;click&#039;, function () {
      //alert(&#039;here in tt&#039;)
      if(fheatmap_btn.value == &#039;hide&#039;){        
        toggle_visual_element(fheatmap_div,&#039;show&#039;,fheatmap_btn);
      }else{
        toggle_visual_element(fheatmap_div,&#039;hide&#039;,fheatmap_btn);
      }
      
  });
}
var fheatmap_open_btn = document.getElementById(&#039;fheatmap_open_btn&#039;);
if (typeof fheatmap_open_btn !== &quot;undefined&quot;) {
  fheatmap_open_btn.addEventListener(&#039;click&#039;, function () {
      create_viz(&#039;fheatmap&#039;, pi_local.ts, true);      
  });
}
//
// DENDROGRAM1  D3 Phylogram
//
var dendrogram01_link = document.getElementById(&#039;dendrogram01_link_id&#039;) || null;
var dendrogram01_btn = document.getElementById(&#039;dendrogram01_hide_btn&#039;);
var dendrogram01_div = document.getElementById(&#039;dendrogram01_div&#039;);
//var dendrogram1_download_btn = document.getElementById(&#039;dendrogram1_download_btn&#039;);
var pre_dendrogram01_div = document.getElementById(&#039;pre_dendrogram01_div&#039;);
if (dendrogram01_link !== null) {
  dendrogram01_link.addEventListener(&#039;click&#039;, function () {
      
    if(typeof dendrogram01_created == &quot;undefined&quot;){
        create_viz(&#039;dendrogram01&#039;, pi_local.ts, false);
    //dendrogram1_download_btn.disabled = false;
      }else{
        if(dendrogram01_btn.value == &#039;hide&#039;){        
          //toggle_visual_element(dendrogram1_div,&#039;show&#039;,dendrogram1_btn);
        }else{
          toggle_visual_element(dendrogram01_div,&#039;hide&#039;,dendrogram01_btn);
        }
      }
    $(pre_dendrogram01_div).scrollView();
  });
}
if (typeof dendrogram01_btn !== &quot;undefined&quot;) {
  dendrogram01_btn.addEventListener(&#039;click&#039;, function () {
      //alert(&#039;here in tt&#039;)
      if(dendrogram01_btn.value == &#039;hide&#039;){        
        toggle_visual_element(dendrogram01_div,&#039;show&#039;,dendrogram01_btn);
      }else{
        toggle_visual_element(dendrogram01_div,&#039;hide&#039;,dendrogram01_btn);
      }      
  });
}
var dendrogram01_open_btn = document.getElementById(&#039;dendrogram01_open_btn&#039;);
if (typeof dendrogram01_open_btn !== &quot;undefined&quot;) {
  dendrogram01_open_btn.addEventListener(&#039;click&#039;, function () {
      create_viz(&#039;dendrogram01&#039;, pi_local.ts, true);      
  });
}
//
// DENDROGRAM2  D3 Phylonator
//
// var dendrogram2_link = document.getElementById(&#039;dendrogram2_link_id&#039;) || null;
// var dendrogram2_btn = document.getElementById(&#039;dendrogram2_hide_btn&#039;);
// var dendrogram2_div = document.getElementById(&#039;dendrogram2_div&#039;);
// //var dendrogram2_download_btn = document.getElementById(&#039;dendrogram2_download_btn&#039;);
// var pre_dendrogram2_div = document.getElementById(&#039;pre_dendrogram2_div&#039;);
// if (dendrogram2_link !== null) {
//   dendrogram2_link.addEventListener(&#039;click&#039;, function () {
      
//     if(typeof dendrogram2_created == &quot;undefined&quot;){
//         create_viz(&#039;dendrogram2&#039;, pi_local.ts, false);
//     //dendrogram2_download_btn.disabled = false;
//       }else{
//         if(dendrogram2_btn.value == &#039;hide&#039;){        
//           //toggle_visual_element(dendrogram_div,&#039;show&#039;,dendrogram_btn);
//         }else{
//           toggle_visual_element(dendrogram2_div,&#039;hide&#039;,dendrogram2_btn);
//         }
//       }
//     $(pre_dendrogram2_div).scrollView();
//   });
// }
// if (typeof dendrogram2_btn !== &quot;undefined&quot;) {
//   dendrogram2_btn.addEventListener(&#039;click&#039;, function () {
//       //alert(&#039;here in tt&#039;)
//       if(dendrogram2_btn.value == &#039;hide&#039;){        
//         toggle_visual_element(dendrogram2_div,&#039;show&#039;,dendrogram2_btn);
//       }else{
//         toggle_visual_element(dendrogram2_div,&#039;hide&#039;,dendrogram2_btn);
//       }      
//   });
// }
// var dendrogram2_open_btn = document.getElementById(&#039;dendrogram2_open_btn&#039;);
// if (typeof dendrogram2_open_btn !== &quot;undefined&quot;) {
//   dendrogram2_open_btn.addEventListener(&#039;click&#039;, function () {
//       create_viz(&#039;dendrogram2&#039;, pi_local.ts, true);      
//   });
// }
//
// DENDROGRAM3  D3 Radial
//
var dendrogram03_link = document.getElementById(&#039;dendrogram03_link_id&#039;) || null;
var dendrogram03_btn = document.getElementById(&#039;dendrogram03_hide_btn&#039;);
var dendrogram03_div = document.getElementById(&#039;dendrogram03_div&#039;);
//var dendrogram3_download_btn = document.getElementById(&#039;dendrogram3_download_btn&#039;);
var pre_dendrogram03_div = document.getElementById(&#039;pre_dendrogram03_div&#039;);
if (dendrogram03_link !== null) {
  dendrogram03_link.addEventListener(&#039;click&#039;, function () {
      
    if(typeof dendrogram03_created == &quot;undefined&quot;){
        create_viz(&#039;dendrogram03&#039;, pi_local.ts, false);
    //dendrogram3_download_btn.disabled = false;
      }else{
        if(dendrogram03_btn.value == &#039;hide&#039;){        
          //toggle_visual_element(dendrogram_div,&#039;show&#039;,dendrogram_btn);
        }else{
          toggle_visual_element(dendrogram03_div,&#039;hide&#039;,dendrogram3_btn);
        }
      }
    $(pre_dendrogram03_div).scrollView();
  });
}
if (typeof dendrogram03_btn !== &quot;undefined&quot;) {
  dendrogram03_btn.addEventListener(&#039;click&#039;, function () {
      //alert(&#039;here in tt&#039;)
      if(dendrogram03_btn.value == &#039;hide&#039;){        
        toggle_visual_element(dendrogram03_div,&#039;show&#039;,dendrogram03_btn);
      }else{
        toggle_visual_element(dendrogram03_div,&#039;hide&#039;,dendrogram03_btn);
      }      
  });
}
var dendrogram03_open_btn = document.getElementById(&#039;dendrogram03_open_btn&#039;);
if (typeof dendrogram03_open_btn !== &quot;undefined&quot;) {
  dendrogram03_open_btn.addEventListener(&#039;click&#039;, function () {
      create_viz(&#039;dendrogram03&#039;, pi_local.ts, true);      
  });
}
//
// DENDROGRAM PDF
//
// var dendrogram_pdf_link = document.getElementById(&#039;dendrogram_pdf_link_id&#039;) || null;
// var dendrogram_pdf_btn = document.getElementById(&#039;dendrogram_pdf_hide_btn&#039;);
// var dendrogram_pdf_div = document.getElementById(&#039;dendrogram_pdf_div&#039;);
// //var dendrogram_pdf_download_btn = document.getElementById(&#039;dendrogram_pdf_download_btn&#039;);
// var pre_dendrogram_pdf_div = document.getElementById(&#039;pre_dendrogram_pdf_div&#039;);
// if (dendrogram_pdf_link !== null) {
//   dendrogram_pdf_link.addEventListener(&#039;click&#039;, function () {
      
//     if(typeof dendrogram_pdf_created == &quot;undefined&quot;){
//         create_viz(&#039;dendrogram_pdf&#039;, pi_local.ts, false);
//     //dendrogram_pdf_download_btn.disabled = false;
//       }else{
//         if(dendrogram_pdf_btn.value == &#039;hide&#039;){        
//           //toggle_visual_element(dendrogram_pdf_div,&#039;show&#039;,dendrogram_pdf_btn);
//         }else{
//           toggle_visual_element(dendrogram_pdf_div,&#039;hide&#039;,dendrogram_pdf_btn);
//         }
//       }
//       $(pre_dendrogram_pdf_div).scrollView();
//   });
// }
// if (typeof dendrogram_pdf_btn !== &quot;undefined&quot;) {
//   dendrogram_pdf_btn.addEventListener(&#039;click&#039;, function () {
//       //alert(&#039;here in tt&#039;)
//       if(dendrogram_pdf_btn.value == &#039;hide&#039;){        
//         toggle_visual_element(dendrogram_pdf_div,&#039;show&#039;,dendrogram_pdf_btn);
//       }else{
//         toggle_visual_element(dendrogram_png_div,&#039;hide&#039;,dendrogram_pdf_btn);
//       }      
//   });
// }
// var dendrogram_pdf_open_btn = document.getElementById(&#039;dendrogram_pdf_open_btn&#039;);
// if (typeof dendrogram_pdf_open_btn !== &quot;undefined&quot;) {
//   dendrogram_pdf_open_btn.addEventListener(&#039;click&#039;, function () {
//       create_viz(&#039;dendrogram_pdf&#039;, pi_local.ts, true);      
//   });
// }
//
// PCOA  2D
//
var pcoa_link = document.getElementById(&#039;pcoa_link_id&#039;) || null;
var pcoa_btn = document.getElementById(&#039;pcoa_hide_btn&#039;);
var pcoa_div = document.getElementById(&#039;pcoa_div&#039;);
//var pcoa_download_btn = document.getElementById(&#039;pcoa_download_btn&#039;);
var pre_pcoa_div = document.getElementById(&#039;pre_pcoa_div&#039;);
if (pcoa_link !== null) {
  pcoa_link.addEventListener(&#039;click&#039;, function () {
      
    if(typeof pcoa_created == &quot;undefined&quot;){
        create_viz(&#039;pcoa&#039;, pi_local.ts, false);
    //pcoa_download_btn.disabled = false;
      }else{
        if(pcoa_btn.value == &#039;hide&#039;){        
          //toggle_visual_element(pcoa_div,&#039;show&#039;,pcoa_btn);
        }else{
          toggle_visual_element(pcoa_div,&#039;hide&#039;,pcoa_btn);
        }
      } 
    $(pre_pcoa_div).scrollView();     
  });
}
if (typeof pcoa_btn !== &quot;undefined&quot;) {
  pcoa_btn.addEventListener(&#039;click&#039;, function () {
      //alert(&#039;here in tt&#039;)
      if(pcoa_btn.value == &#039;hide&#039;){        
        toggle_visual_element(pcoa_div,&#039;show&#039;,pcoa_btn);
      }else{
        toggle_visual_element(pcoa_div,&#039;hide&#039;,pcoa_btn);
      }
  });
}
var pcoa_open_btn = document.getElementById(&#039;pcoa_open_btn&#039;);
if (typeof pcoa_open_btn !== &quot;undefined&quot;) {
  pcoa_open_btn.addEventListener(&#039;click&#039;, function () {
      create_viz(&#039;pcoa&#039;, pi_local.ts, true);      
  });
}
//
// PCOA  3D
//
var pcoa3d_link = document.getElementById(&#039;pcoa3d_link_id&#039;) || null;
var pcoa3d_btn = document.getElementById(&#039;pcoa3d_hide_btn&#039;);
var pcoa3d_div = document.getElementById(&#039;pcoa3d_div&#039;);
//var pcoa3d_download_btn = document.getElementById(&#039;pcoa3d_download_btn&#039;);
var pre_pcoa3d_div = document.getElementById(&#039;pre_pcoa3d_div&#039;);
if (pcoa3d_link !== null) {
  pcoa3d_link.addEventListener(&#039;click&#039;, function () {
      
    if(typeof pcoa3d_created == &quot;undefined&quot;){
        create_viz(&#039;pcoa3d&#039;, pi_local.ts, false);
    
      }else{
        if(pcoa3d_btn.value == &#039;hide&#039;){        
         
        }else{
          toggle_visual_element(pcoa3d_div,&#039;hide&#039;,pcoa3d_btn);
        }
      } 
    $(pre_pcoa3d_div).scrollView();     
  });
}
if (typeof pcoa3d_btn !== &quot;undefined&quot;) {
  pcoa3d_btn.addEventListener(&#039;click&#039;, function () {
      //alert(&#039;here in tt&#039;)
      if(pcoa3d_btn.value == &#039;hide&#039;){        
        toggle_visual_element(pcoa3d_div,&#039;show&#039;,pcoa3d_btn);
      }else{
        toggle_visual_element(pcoa3d_div,&#039;hide&#039;,pcoa3d_btn);
      }
  });
}

//
// GEOSPATIAL
//
var geospatial_link = document.getElementById(&#039;geospatial_link_id&#039;) || null;
var geospatial_btn = document.getElementById(&#039;geospatial_hide_btn&#039;);
var geospatial_div = document.getElementById(&#039;map-canvas&#039;);
//var geospatial_download_btn = document.getElementById(&#039;geospatial_download_btn&#039;);
var pre_geospatial_div = document.getElementById(&#039;pre_geospatial_div&#039;);
if (geospatial_link !== null) {
  //google.maps.event.addDomListener(window, &#039;load&#039;, initialize);
  geospatial_link.addEventListener(&#039;click&#039;, function () {
      
    if(typeof geospatial_created == &quot;undefined&quot;){
        create_viz(&#039;geospatial&#039;, pi_local.ts, false);
        //geospatial_download_btn.disabled = false;
      }else{
        if(geospatial_btn.value == &#039;hide&#039;){        
         // toggle_visual_element(geospatial_div,&#039;show&#039;,geospatial_btn);
        }else{
          toggle_visual_element(geospatial_div,&#039;hide&#039;,geospatial_btn);
        }
      } 
    $(pre_geospatial_div).scrollView();     
  });
}
if (typeof geospatial_btn !== &quot;undefined&quot;) {
  geospatial_btn.addEventListener(&#039;click&#039;, function () {
      //alert(&#039;here in tt&#039;)
      if(geospatial_btn.value == &#039;hide&#039;){        
        toggle_visual_element(geospatial_div,&#039;show&#039;,geospatial_btn);
      }else{
        toggle_visual_element(geospatial_div,&#039;hide&#039;,geospatial_btn);
      }
  });
}
var geospatial_open_btn = document.getElementById(&#039;geospatial_open_btn&#039;);
if (typeof geospatial_open_btn !== &quot;undefined&quot;) {
  geospatial_open_btn.addEventListener(&#039;click&#039;, function () {
      create_viz(&#039;geospatial&#039;, pi_local.ts, true);      
  });
}
//
// ALPHA DIVERSITY
//
var adiversity_link = document.getElementById(&#039;adiversity_link_id&#039;) || null;
var adiversity_btn = document.getElementById(&#039;adiversity_hide_btn&#039;);
var adiversity_div = document.getElementById(&#039;adiversity_div&#039;);
//var adiversity_download_btn = document.getElementById(&#039;adiversity_download_btn&#039;);
var pre_adiversity_div = document.getElementById(&#039;pre_adiversity_div&#039;);
if (adiversity_link !== null) {
  //google.maps.event.addDomListener(window, &#039;load&#039;, initialize);
  adiversity_link.addEventListener(&#039;click&#039;, function () {
      
    if(typeof adiversity_created == &quot;undefined&quot;){
        create_viz(&#039;adiversity&#039;, pi_local.ts, false);
        //adiversity_download_btn.disabled = false;
      }else{
        if(adiversity_btn.value == &#039;hide&#039;){        
         // toggle_visual_element(adiversity_div,&#039;show&#039;,adiversity_btn);
        }else{
          toggle_visual_element(adiversity_div,&#039;hide&#039;,adiversity_btn);
        }
      } 
    $(pre_adiversity_div).scrollView();     
  });
}
if (typeof adiversity_btn !== &quot;undefined&quot;) {
  adiversity_btn.addEventListener(&#039;click&#039;, function () {
      //alert(&#039;here in tt&#039;)
      if(adiversity_btn.value == &#039;hide&#039;){        
        toggle_visual_element(adiversity_div,&#039;show&#039;,adiversity_btn);
      }else{
        toggle_visual_element(adiversity_div,&#039;hide&#039;,adiversity_btn);
      }
  });
}
var adiversity_open_btn = document.getElementById(&#039;adiversity_open_btn&#039;);
if (typeof adiversity_open_btn !== &quot;undefined&quot;) {
  adiversity_open_btn.addEventListener(&#039;click&#039;, function () {
      create_viz(&#039;adiversity&#039;, pi_local.ts, true);      
  });
}
//
// PHYLOSEQ 01
//
var phyloseq_bars01_link = document.getElementById(&#039;phyloseq_bars01_link_id&#039;) || null;
var phyloseq_bars01_btn = document.getElementById(&#039;phyloseq_bars01_hide_btn&#039;);
var phyloseq_bars01_div = document.getElementById(&#039;phyloseq_bars01_div&#039;);
//var phyloseq01_download_btn = document.getElementById(&#039;phyloseq01_download_btn&#039;);
var pre_phyloseq_bars01_div = document.getElementById(&#039;pre_phyloseq_bars01_div&#039;);
if (phyloseq_bars01_link !== null) {
  //google.maps.event.addDomListener(window, &#039;load&#039;, initialize);
  phyloseq_bars01_link.addEventListener(&#039;click&#039;, function () {
      
    if(typeof phyloseq_bars01_created == &quot;undefined&quot;){
        create_viz(&#039;phyloseq01&#039;, pi_local.ts, false);
        //phyloseq01_download_btn.disabled = false;
      }else{
        if(phyloseq_bars01_btn.value == &#039;hide&#039;){        
         // toggle_visual_element(adiversity_div,&#039;show&#039;,adiversity_btn);
        }else{
          toggle_visual_element(phyloseq_bars01_div,&#039;hide&#039;,phyloseq_bars01_btn);
        }
      } 
    $(pre_phyloseq_bars01_div).scrollView();     
  });
}
if (typeof phyloseq_bars01_btn !== &quot;undefined&quot;) {
  phyloseq_bars01_btn.addEventListener(&#039;click&#039;, function () {
      //alert(&#039;here in tt&#039;)
      if(phyloseq_bars01_btn.value == &#039;hide&#039;){        
        toggle_visual_element(phyloseq_bars01_div,&#039;show&#039;,phyloseq_bars01_btn);
      }else{
        toggle_visual_element(phyloseq_bars01_div,&#039;hide&#039;,phyloseq_bars01_btn);
      }
  });
}
var phyloseq_bars01_open_btn = document.getElementById(&#039;phyloseq_bars01_open_btn&#039;);
if (typeof phyloseq_bars01_open_btn !== &quot;undefined&quot;) {
  phyloseq_bars01_open_btn.addEventListener(&#039;click&#039;, function () {
      create_viz(&#039;phyloseq01&#039;, pi_local.ts, true);      
  });
}
//
// PHYLOSEQ 02
//
var phyloseq_hm02_link = document.getElementById(&#039;phyloseq_hm02_link_id&#039;) || null;
var phyloseq_hm02_btn = document.getElementById(&#039;phyloseq_hm02_hide_btn&#039;);
var phyloseq_hm02_div = document.getElementById(&#039;phyloseq_hm02_div&#039;);
//var phyloseq02_download_btn = document.getElementById(&#039;phyloseq02_download_btn&#039;);
var pre_phyloseq_hm02_div = document.getElementById(&#039;pre_phyloseq_hm02_div&#039;);
if (phyloseq_hm02_link !== null) {
  //google.maps.event.addDomListener(window, &#039;load&#039;, initialize);
  phyloseq_hm02_link.addEventListener(&#039;click&#039;, function () {
      
    if(typeof phyloseq_hm02_created == &quot;undefined&quot;){
        create_viz(&#039;phyloseq02&#039;, pi_local.ts, false);
        //phyloseq02_download_btn.disabled = false;
      }else{
        if(phyloseq_hm02_btn.value == &#039;hide&#039;){        
         // toggle_visual_element(adiversity_div,&#039;show&#039;,adiversity_btn);
        }else{
          toggle_visual_element(phyloseq_hm02_div,&#039;hide&#039;,phyloseq_hm02_btn);
        }
      } 
    $(pre_phyloseq_hm02_div).scrollView();     
  });
}
if (typeof phyloseq_hm02_btn !== &quot;undefined&quot;) {
  phyloseq_hm02_btn.addEventListener(&#039;click&#039;, function () {
      //alert(&#039;here in tt&#039;)
      if(phyloseq_hm02_btn.value == &#039;hide&#039;){        
        toggle_visual_element(phyloseq_hm02_div,&#039;show&#039;,phyloseq_hm02_btn);
      }else{
        toggle_visual_element(phyloseq_hm02_div,&#039;hide&#039;,phyloseq_hm02_btn);
      }
  });
}
var phyloseq_hm02_open_btn = document.getElementById(&#039;phyloseq_hm02_open_btn&#039;);
if (typeof phyloseq_hm02_open_btn !== &quot;undefined&quot;) {
  phyloseq_hm02_open_btn.addEventListener(&#039;click&#039;, function () {
      create_viz(&#039;phyloseq02&#039;, pi_local.ts, true);      
  });
}
//
// PHYLOSEQ 03
//
var phyloseq_nw03_link = document.getElementById(&#039;phyloseq_nw03_link_id&#039;) || null;
var phyloseq_nw03_btn = document.getElementById(&#039;phyloseq_nw03_hide_btn&#039;);
var phyloseq_nw03_div = document.getElementById(&#039;phyloseq_nw03_div&#039;);
//var phyloseq03_download_btn = document.getElementById(&#039;phyloseq03_download_btn&#039;);
var pre_phyloseq_nw03_div = document.getElementById(&#039;pre_phyloseq_nw03_div&#039;);
if (phyloseq_nw03_link !== null) {
  //google.maps.event.addDomListener(window, &#039;load&#039;, initialize);
  phyloseq_nw03_link.addEventListener(&#039;click&#039;, function () {
      
    if(typeof phyloseq_nw03_created == &quot;undefined&quot;){
        create_viz(&#039;phyloseq03&#039;, pi_local.ts, false);
        //phyloseq03_download_btn.disabled = false;
      }else{
        if(phyloseq_nw03_btn.value == &#039;hide&#039;){        
         // toggle_visual_element(adiversity_div,&#039;show&#039;,adiversity_btn);
        }else{
          toggle_visual_element(phyloseq_nw03_div,&#039;hide&#039;,phyloseq_nw03_btn);
        }
      } 
    $(pre_phyloseq_nw03_div).scrollView();     
  });
}
if (typeof phyloseq_nw03_btn !== &quot;undefined&quot;) {
  phyloseq_nw03_btn.addEventListener(&#039;click&#039;, function () {
      //alert(&#039;here in tt&#039;)
      if(phyloseq_nw03_btn.value == &#039;hide&#039;){        
        toggle_visual_element(phyloseq_nw03_div,&#039;show&#039;,phyloseq_nw03_btn);
      }else{
        toggle_visual_element(phyloseq_nw03_div,&#039;hide&#039;,phyloseq_nw03_btn);
      }
  });
}
var phyloseq_nw03_open_btn = document.getElementById(&#039;phyloseq_nw03_open_btn&#039;);
if (typeof phyloseq_nw03_open_btn !== &quot;undefined&quot;) {
  phyloseq_nw03_open_btn.addEventListener(&#039;click&#039;, function () {
      create_viz(&#039;phyloseq03&#039;, pi_local.ts, true);      
  });
}
//
// PHYLOSEQ 04
//
var phyloseq_ord04_link = document.getElementById(&#039;phyloseq_ord04_link_id&#039;) || null;
var phyloseq_ord04_btn = document.getElementById(&#039;phyloseq_ord04_hide_btn&#039;);
var phyloseq_ord04_div = document.getElementById(&#039;phyloseq_ord04_div&#039;);
//var phyloseq04_download_btn = document.getElementById(&#039;phyloseq04_download_btn&#039;);
var pre_phyloseq_ord04_div = document.getElementById(&#039;pre_phyloseq_ord_ord04_div&#039;);
if (phyloseq_ord04_link !== null) {
  //google.maps.event.addDomListener(window, &#039;load&#039;, initialize);
  phyloseq_ord04_link.addEventListener(&#039;click&#039;, function () {
      
    if(typeof phyloseq_ord04_created == &quot;undefined&quot;){
        create_viz(&#039;phyloseq04&#039;, pi_local.ts, false);
        //phyloseq04_download_btn.disabled = false;
      }else{
        if(phyloseq_ord04_btn.value == &#039;hide&#039;){        
         // toggle_visual_element(adiversity_div,&#039;show&#039;,adiversity_btn);
        }else{
          toggle_visual_element(phyloseq_ord04_div,&#039;hide&#039;,phyloseq_ord04_btn);
        }
      } 
    $(pre_phyloseq_ord04_div).scrollView();     
  });
}
if (typeof phyloseq_ord04_btn !== &quot;undefined&quot;) {
  phyloseq_ord04_btn.addEventListener(&#039;click&#039;, function () {
      //alert(&#039;here in tt&#039;)
      if(phyloseq_ord04_btn.value == &#039;hide&#039;){        
        toggle_visual_element(phyloseq_ord04_div,&#039;show&#039;,phyloseq_ord04_btn);
      }else{
        toggle_visual_element(phyloseq_ord04_div,&#039;hide&#039;,phyloseq_ord04_btn);
      }
  });
}
var phyloseq_ord04_open_btn = document.getElementById(&#039;phyloseq_ord04_open_btn&#039;);
if (typeof phyloseq_ord04_open_btn !== &quot;undefined&quot;) {
  phyloseq_ord04_open_btn.addEventListener(&#039;click&#039;, function () {
      create_viz(&#039;phyloseq04&#039;, pi_local.ts, true);      
  });
}
//
// PHYLOSEQ 05
//
var phyloseq_tree05_link = document.getElementById(&#039;phyloseq_tree05_link_id&#039;) || null;
var phyloseq_tree05_btn = document.getElementById(&#039;phyloseq_tree05_hide_btn&#039;);
var phyloseq_tree05_div = document.getElementById(&#039;phyloseq_tree05_div&#039;);
//var phyloseq05_download_btn = document.getElementById(&#039;phyloseq05_download_btn&#039;);
var pre_phyloseq_tree05_div = document.getElementById(&#039;pre_phyloseq_tree05_div&#039;);
if (phyloseq_tree05_link !== null) {
  //google.maps.event.addDomListener(window, &#039;load&#039;, initialize);
  phyloseq_tree05_link.addEventListener(&#039;click&#039;, function () {
      
    if(typeof phyloseq_tree05_created == &quot;undefined&quot;){
        create_viz(&#039;phyloseq05&#039;, pi_local.ts, false);
        //phyloseq05_download_btn.disabled = false;
      }else{
        if(phyloseq_tree05_btn.value == &#039;hide&#039;){        
         // toggle_visual_element(adiversity_div,&#039;show&#039;,adiversity_btn);
        }else{
          toggle_visual_element(phyloseq_tree05_div,&#039;hide&#039;,phyloseq_tree05_btn);
        }
      } 
    $(pre_phyloseq05_div).scrollView();     
  });
}
if (typeof phyloseq_tree05_btn !== &quot;undefined&quot;) {
  phyloseq_tree05_btn.addEventListener(&#039;click&#039;, function () {
      //alert(&#039;here in tt&#039;)
      if(phyloseq_tree05_btn.value == &#039;hide&#039;){        
        toggle_visual_element(phyloseq_tree05_div,&#039;show&#039;,phyloseq_tree05_btn);
      }else{
        toggle_visual_element(phyloseq_tree05_div,&#039;hide&#039;,phyloseq_tree05_btn);
      }
  });
}
var phyloseq_tree05_open_btn = document.getElementById(&#039;phyloseq_tree05_open_btn&#039;);
if (typeof phyloseq_tree05_open_btn !== &quot;undefined&quot;) {
  phyloseq_tree05_open_btn.addEventListener(&#039;click&#039;, function () {
      create_viz(&#039;phyloseq05&#039;, pi_local.ts, true);      
  });
}
//
//
//
// TEST
//
// test_link = document.getElementById(&#039;test_page_link_id&#039;);
// if (typeof test_link !==&quot;undefined&quot;) {
//   test_link.addEventListener(&#039;click&#039;, function () {
//       //alert(&#039;here in pc&#039;)
//       create_test_page(pi_local.ts);
//   });
// }
// function create_test_page(ts) {
//
//     var opened = window.open(&quot;&quot;);
//     opened.document.write(&quot;&lt;html&gt;&lt;head&gt;&lt;title&gt;My title&lt;/title&gt;&lt;/head&gt;&lt;body&gt;open in another page:  test&lt;/body&gt;&lt;/html&gt;&quot;);
//
// }

//
//  CYTOSCAPE
//
var cytoscape_link = document.getElementById(&#039;cytoscape_link_id&#039;) || null;
var cytoscape_btn = document.getElementById(&#039;cytoscape_hide_btn&#039;);
var cytoscape_div = document.getElementById(&#039;cytoscape_div&#039;);
//var cytoscape_download_btn = document.getElementById(&#039;cytoscape_download_btn&#039;);
var pre_cytoscape_div = document.getElementById(&#039;pre_cytoscape_div&#039;);
if (cytoscape_link !== null) {
  cytoscape_link.addEventListener(&#039;click&#039;, function () {
      
    if(typeof cytoscape_created == &quot;undefined&quot;){
        
        create_viz(&#039;cytoscape&#039;, pi_local.ts, false);
        //cytoscape_download_btn.disabled = false;
      }else{
        if(cytoscape_btn.value == &#039;hide&#039;){        
         // toggle_visual_element(geospatial_div,&#039;show&#039;,geospatial_btn);
        }else{
          toggle_visual_element(cytoscape_div,&#039;hide&#039;,cytoscape_btn);
        }
      } 
    $(pre_cytoscape_div).scrollView();     
  });
}
if (typeof cytoscape_btn !== &quot;undefined&quot;) {
  cytoscape_btn.addEventListener(&#039;click&#039;, function () {
      //alert(&#039;here in tt&#039;)
      if(cytoscape_btn.value == &#039;hide&#039;){        
        toggle_visual_element(cytoscape_div,&#039;show&#039;,cytoscape_btn);
      }else{
        toggle_visual_element(cytoscape_div,&#039;hide&#039;,cytoscape_btn);
      }
  });
}
var cytoscape_open_btn = document.getElementById(&#039;cytoscape_open_btn&#039;);
if (typeof cytoscape_open_btn !== &quot;undefined&quot;) {
  cytoscape_open_btn.addEventListener(&#039;click&#039;, function () {
      create_viz(&#039;cytoscape&#039;, pi_local.ts, true);      
  });
}


function toggle_visual_element(table_div, tog, btn){
  if(tog == &#039;show&#039;) {
    table_div.style.display = &#039;none&#039;;
    btn.value = &#039;show&#039;;
    btn.innerHTML = &#039;Show Panel&#039;;
  }else{
    table_div.style.display = &#039;block&#039;;
    btn.value = &#039;hide&#039;;
    btn.innerHTML = &#039;Hide Panel&#039;;
  }
}


function create_viz(visual, ts, new_window) {
   
    if(visual === &#039;counts_table&#039;){
      create_counts_table(new_window);      
    }else if(visual === &#039;metadata_table&#039;){
      create_metadata_table(new_window);
    }else if(visual === &#039;piecharts&#039;){
      create_piecharts(ts, new_window);
    }else if(visual === &#039;barcharts&#039;){
      create_barcharts_group(ts, new_window);
    }else if(visual === &#039;dheatmap&#039;){
      create_dheatmap(ts, new_window);
    }else if(visual === &#039;dendrogram01&#039;){
      create_dendrogram(ts,&#039;svg&#039;,&#039;phylogram&#039;, new_window);
    //}
    //else if(visual === &#039;dendrogram2&#039;){
    //  create_dendrogram(ts,&#039;svg&#039;,&#039;phylonator&#039;, new_window);
    }else if(visual === &#039;dendrogram03&#039;){
      create_dendrogram(ts,&#039;svg&#039;,&#039;radial&#039;, new_window);
    }else if(visual === &#039;pcoa&#039;){
      create_pcoa(ts,&#039;2d&#039;, new_window);
    }else if(visual === &#039;pcoa3d&#039;){
      create_pcoa(ts,&#039;3d&#039;);
    }else if(visual === &#039;fheatmap&#039;){
      create_fheatmap(ts, new_window);
    }else if(visual === &#039;geospatial&#039;){
      create_geospatial(new_window);
    }else if(visual === &#039;dbrowser&#039;){
      create_dbrowser(ts);
    }else if(visual === &#039;adiversity&#039;){
      create_adiversity(ts, new_window);
    }else if(visual === &#039;phyloseq01&#039;){
      create_phyloseq(ts,&#039;bar&#039;, new_window);
    }else if(visual === &#039;phyloseq02&#039;){
      create_phyloseq(ts,&#039;heatmap&#039;, new_window);
    }else if(visual === &#039;phyloseq03&#039;){
      create_phyloseq(ts,&#039;network&#039;, new_window);
    }else if(visual === &#039;phyloseq04&#039;){
      create_phyloseq(ts,&#039;ord&#039;, new_window);
    }else if(visual === &#039;phyloseq05&#039;){
      create_phyloseq(ts,&#039;tree&#039;, new_window);
    }else if(visual === &#039;cytoscape&#039;){
      create_cytoscape(ts);
    }else{

    }
}
function create_cytoscape(ts){
  //alert(ts)
  var cydiv = document.getElementById(&#039;cytoscape_div&#039;);

  // cytoscape_created = true;
      
      
  //     //cydiv.innerHTML = &#039;&#039;;
    

  var cy = cytoscape({
    container: cydiv,
    elements: [
    { data: { id: &#039;a&#039; } },
    { data: { id: &#039;b&#039; } },
    {
      data: {
        id: &#039;ab&#039;,
        source: &#039;a&#039;,
        target: &#039;b&#039;
      }
    }]
  });
  for (var i = 0; i &lt; 10; i++) {
      cy.add({
          data: { id: &#039;node&#039; + i }
          }
      );
      var source = &#039;node&#039; + i;
      cy.add({
          data: {
              id: &#039;edge&#039; + i,
              source: source,
              target: (i % 2 == 0 ? &#039;a&#039; : &#039;b&#039;)
          }
      });
  }



cydiv.style.border = &#039;1px solid red&#039;
cydiv.style.height = &#039;200px&#039;
cydiv.style.width = &#039;100%&#039;
cydiv.style.display = &#039;inline-block&#039;;
//cydiv.style.width = &#039;100%&#039;;

document.getElementById(&#039;pre_cytoscape_div&#039;).style.display = &#039;block&#039;;

}
//
// TAX TABLE
//
function create_counts_table(new_window) {
      
      if(new_window == true){
        var htmlstring = document.getElementById(&#039;counts_table_div&#039;).innerHTML;
        function openindex()
            {
                  rando = Math.floor(Math.random() * 20);
                  OpenWindow=window.open(&quot;&quot;, &quot;counts_table&quot;+rando.toString(), &quot;height=900, width=900,toolbar=no,scrollbars=yes,menubar=no&quot;);
                  OpenWindow.document.write(new_window_skeleton(htmlstring))
                  OpenWindow.document.close()
                  self.name=&quot;main&quot;
            }
        openindex()
        return
      }
      tax_table_created = true;
      var info_line = create_header(&#039;ftable&#039;, pi_local);
      

      document.getElementById(&#039;counts_table_title&#039;).innerHTML = info_line;
      
      document.getElementById(&#039;pre_counts_table_div&#039;).style.display = &#039;block&#039;;
      document.getElementById(&#039;counts_table_title&#039;).style.color = &#039;white&#039;;
      document.getElementById(&#039;counts_table_title&#039;).style[&#039;font-size&#039;] = &#039;small&#039;;
      
      var tax_counts_div = document.getElementById(&#039;counts_table_div&#039;);
      tax_counts_div.innerHTML = &#039;&#039;;
      tax_counts_div.style.display = &#039;block&#039;;
      var html = &#039;&#039;;
         
      // need the max ranks
      maxrank = 0;
      for (var i in mtx_local.rows){
        taxitems = mtx_local.rows[i].id.split(&#039;;&#039;);
        if(maxrank &lt; taxitems.length){
          maxrank = taxitems.length;
        }
      }
      html += &quot;&lt;div id=&#039;tax_counts_graph_div&#039; style=&#039;background-color:white;width:600px;height:400px;display:none;&#039;&gt;&lt;/div&gt;&quot;;
      html += &quot;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;table id=&#039;counts_table_id&#039; border=&#039;0&#039; class=&#039;&#039; &gt;&quot;;
      html += &quot;&lt;tr&gt;&lt;td class=&#039;no_border&#039;&gt;&lt;/td&gt;&quot;
      for (t = 0; t &lt; maxrank; t++) {
        if(t==2){
          html += &quot;&lt;th class=&#039;&#039; valign=&#039;bottom&#039;&gt;&lt;small&gt;Class&lt;/small&gt;&lt;/th&gt;&quot;;
        }else{
          html += &quot;&lt;th class=&#039;&#039; valign=&#039;bottom&#039;&gt;&lt;small&gt;&quot;+cts_local.RANKS[t].toUpperCase().charAt(0)+cts_local.RANKS[t].slice(1)+&quot;&lt;/small&gt;&lt;/th&gt;&quot;;
        }
      }
      html += &quot;&lt;th class=&#039;right_justify&#039; valign=&#039;bottom&#039;&gt;&lt;small&gt;Graph&lt;/small&gt;&lt;/th&gt;&quot;;
      for (var n in mtx_local.columns) {
        //html += &quot;&lt;th class=&#039;verticalTableHeader&#039; &gt;&quot;+mtx_local.columns[n].id +&quot;&lt;/th&gt;&quot;;
        html += &quot;&lt;th class=&#039;rotate&#039;&gt;&lt;div&gt;&lt;span&gt;&lt;a href=&#039;bar_single?id=&quot;+mtx_local.columns[n].id+&quot;&#039; target=&#039;_blank&#039;&gt;&quot;+(parseInt(n)+1).toString()+&#039;) &#039;
        html += mtx_local.columns[n].id+&quot;&lt;/a&gt;&lt;/span&gt;&lt;/div&gt;&lt;/th&gt;&quot;;
      
      }

      
      html += &quot;&lt;th class=&#039;right_justify&#039; valign=&#039;bottom&#039;&gt;&lt;small&gt;Total&lt;/small&gt;&lt;/th&gt;&quot;;
      html += &quot;&lt;th class=&#039;right_justify&#039; valign=&#039;bottom&#039;&gt;&lt;small&gt;Average&lt;/small&gt;&lt;/th&gt;&quot;;
      html += &quot;&lt;th class=&#039;right_justify&#039; valign=&#039;bottom&#039;&gt;&lt;small&gt;Min&lt;/small&gt;&lt;/th&gt;&quot;;
      html += &quot;&lt;th class=&#039;right_justify&#039; valign=&#039;bottom&#039;&gt;&lt;small&gt;Max&lt;/small&gt;&lt;/th&gt;&quot;;
      html += &quot;&lt;th class=&#039;right_justify&#039; valign=&#039;bottom&#039;&gt;&lt;small&gt;Std Dev&lt;/small&gt;&lt;/th&gt;&quot;;

      html += &quot;&lt;/tr&gt;&quot;;
      
      for (var i in mtx_local.rows){
        count = parseInt(i)+1;
        taxitems = mtx_local.rows[i].id.split(&#039;;&#039;);

        html += &quot;&lt;tr class=&#039;chart_row&#039;&gt;&lt;td&gt;&quot;+count.toString()+&quot;&lt;/td&gt;&quot;;
        
        for (t = 0; t &lt; maxrank; t++) {
          if(taxitems.length &gt; t){
            html += &quot;&lt;td class=&#039;left_justify&#039;&gt;&quot;+taxitems[t] +&quot;&lt;/td&gt;&quot;;
          }else{
            html += &quot;&lt;td class=&#039;left_justify&#039;&gt;--&lt;/td&gt;&quot;;
          }
        }
        counts_string=JSON.stringify(mtx_local.data[i])
        html += &quot;&lt;td title=&#039;Graph&#039; align=&#039;center&#039; style=&#039;cursor:pointer;&#039;&gt;&quot;
        graph_link_id = &#039;flot_graph_link&#039;+i.toString()
        html += &quot;&lt;img width=&#039;25&#039; id=&#039;&quot;+graph_link_id+&quot;&#039; src=&#039;/images/visuals/graph.png&#039; onclick=\&quot;graph_counts(&#039;&quot;+i.toString()+&quot;&#039;,&#039;&quot;+mtx_local.rows[i].id+&quot;&#039;,&#039;&quot;+counts_string+&quot;&#039;)\&quot;&gt;&quot;
        html += &quot;&lt;/td&gt;&quot;;


        var tot   = 0;
        var avg   = 0;
        var min   = mtx_local.data[i][0];
        var max   = 0;
        var sd    = 0;
        for (var da in mtx_local.data[i]) {
          var cnt = mtx_local.data[i][da];
          var ds_num = (parseInt(da)+1).toString()
          var pct =  (cnt * 100 / mtx_local.column_totals[da]).toFixed(2);
          var id  = &#039;frequencies-|-&#039;+mtx_local.rows[i].id+&#039;-|-&#039;+ds_num+&#039;) &#039;+mtx_local.columns[da].id+&#039;-|-&#039;+cnt.toString()+&#039;-|-&#039;+pct.toString();
          html += &quot;&lt;td id=&#039;&quot;+id+&quot;&#039; class=&#039;tooltip_viz right_justify tax_data&#039;&gt;&quot;+cnt.toString()+&#039;&lt;/td&gt;&#039;;
          tot += cnt;
          if(cnt &gt; max){
            max = cnt
          }
          if(cnt &lt; min){
            min = cnt
          }
          
        }
        
        
        
        
        avg = (tot/(mtx_local.columns).length).toFixed(2)
        sd = standardDeviation(mtx_local.data[i]).toFixed(2)
        html += &quot;&lt;td title=&#039;Total&#039; class=&#039;right_justify tax_result&#039;&gt;&lt;small&gt;&quot;+tot.toString()+&#039;&lt;/small&gt;&lt;/td&gt;&#039;;
        html += &quot;&lt;td title=&#039;Average&#039; class=&#039;right_justify tax_result&#039;&gt;&lt;small&gt;&quot;+avg.toString()+&quot;&lt;/small&gt;&lt;/td&gt;&quot;;
        html += &quot;&lt;td title=&#039;Min&#039; class=&#039;right_justify tax_result&#039;&gt;&lt;small&gt;&quot;+min.toString()+&quot;&lt;/small&gt;&lt;/td&gt;&quot;;
        html += &quot;&lt;td title=&#039;Max&#039; class=&#039;right_justify tax_result&#039;&gt;&lt;small&gt;&quot;+max.toString()+&quot;&lt;/small&gt;&lt;/td&gt;&quot;;
        html += &quot;&lt;td title=&#039;Std Deviation&#039; class=&#039;right_justify tax_result&#039;&gt;&lt;small&gt;&quot;+sd.toString()+&quot;&lt;/small&gt;&lt;/td&gt;&quot;;
        html += &quot;&lt;/tr&gt;&quot;;
      }
      // TOTALS
      html += &quot;&lt;tr&gt;&lt;td&gt;&lt;/td&gt;&quot;;
      for (t = 0; t &lt; maxrank; t++) {
        html += &quot;&lt;td&gt;&lt;/td&gt;&quot;;
      }
      html += &quot;&lt;td class=&#039;right_justify&#039;&gt;&lt;strong&gt;Sums:&lt;/strong&gt;&lt;/td&gt;&quot;;
      for (var m in mtx_local.column_totals){
        var total;
        if(pi_local.normalization == &#039;frequency&#039;){
          total = mtx_local.column_totals[m].toFixed(6);
        }else{
          total = mtx_local.column_totals[m];
        }
        html += &quot;&lt;td title=&#039;Column Sum&#039; class=&#039;right_justify&#039;&gt;&quot; + total + &quot;&lt;/td&gt;&quot;;
      }
      html += &quot;&lt;/tr&gt;&quot;;
      html += &quot;&lt;/table&gt;&quot;;
      
      //document.getElementById(&#039;counts_tooltip_div&#039;).innerHTML = tooltip_tbl;
      tax_counts_div.innerHTML = html; 
      document.getElementById(&#039;counts_table_dnld_btn&#039;).disabled = false
      //$(&quot;.verticalTableHeader&quot;).each(function(){$(this).height($(this).width())  
      
}

function graph_counts(new_id,taxonomy,counts){
  
  var e = window.event;
  
  if(typeof id !== &#039;undefined&#039; &amp;&amp; id == new_id){
    // same: hide graph
    chart_data = []
    if(document.getElementById(&#039;tax_counts_graph_div&#039;).style.display==&#039;none&#039;){
        document.getElementById(&#039;tax_counts_graph_div&#039;).style.display=&#039;block&#039;
    }
  }else{
    // different: -- show graph
    $(&#039;#tax_counts_graph_div&#039;).css({&#039;top&#039;:e.pageY-200,&#039;left&#039;:e.pageX, &#039;position&#039;:&#039;absolute&#039;, &#039;border&#039;:&#039;1px solid black&#039;, &#039;padding&#039;:&#039;55px&#039;});
    document.getElementById(&#039;tax_counts_graph_div&#039;).style.display=&#039;block&#039;
    id = new_id
  }
  counts = JSON.parse(counts)
  //alert(typeof data)
  if(typeof chart_data == &#039;undefined&#039;){
    chart_data = []
  }
  var myseries = []
  for(c in counts){
    myseries.push([parseInt(c)+1,counts[c]])
  }
  taxa = taxonomy.split(&#039;;&#039;)
  var deepest_tax = taxa[taxa.length-2]+&#039; &#039;+taxa[taxa.length-1]
  chart_data.push({data:myseries, label:deepest_tax, lines:{show:true}, points:{show:true}})
  //alert(data.length)
  var options = {
    
    legend:{position:&#039;nw&#039;},
    grid: {
        borderWidth: 1,
        labelMargin: 5,
        backgroundColor: {
            colors: [&quot;#fff&quot;, &quot;#e4f4f4&quot;]
        },
        margin: {
            top: 40,
            bottom: 20,
            left: 5
        }
    },
    
    xaxis:{
          min: 1,
          //max: datasetcount,
          tickSize: 1,
          tickDecimals: 0,
          labelHeight: 30
      },
      yaxis:{
         min: 0,
         tickDecimals: 0
      }
  };
  
    $.plot($(&quot;#tax_counts_graph_div&quot;), chart_data, options);
    var xaxisLabel = $(&quot;&lt;div class=&#039;axisLabel xaxisLabel&#039;&gt;&lt;/div&gt;&quot;).text(&quot;Dataset&quot;).appendTo($(&#039;#tax_counts_graph_div&#039;));
    var graph_title = $(&quot;&lt;div class=&#039;graph_title&#039;&gt;&lt;/div&gt;&quot;).text(&quot;Sequence Counts&quot;).appendTo($(&#039;#tax_counts_graph_div&#039;));
    var close_button = $(&quot;&lt;input class=&#039;graph_close_btn axisLabel btn btn-xs btn-primary&#039; type=&#039;button&#039; value=&#039;Close&#039; onclick=&#039;close_graph()&#039;&gt;&quot;).appendTo($(&#039;#tax_counts_graph_div&#039;));
   
    graph_title.css(&quot;margin-top&quot;,  0);
  
}
function close_graph(){
    chart_data = []
    document.getElementById(&#039;tax_counts_graph_div&#039;).style.display = &#039;none&#039;
}

function standardDeviation(values){
  var avg = average(values);
  
  var squareDiffs = values.map(function(value){
    var diff = value - avg;
    var sqrDiff = diff * diff;
    return sqrDiff;
  });
  
  var avgSquareDiff = average(squareDiffs);
  var stdDev = Math.sqrt(avgSquareDiff);
  return stdDev;
}

function average(data){
  var sum = data.reduce(function(sum, value){
    return sum + value;
  }, 0);

  var avg = sum / data.length;
  return avg;
}
//
//  CREATE METADATA TABLE
//
function create_metadata_table(new_window) {
     
    if(new_window){
        var htmlstring = document.getElementById(&#039;metadata_table_div&#039;).innerHTML;
        function openindex()
            {
                  rando = Math.floor(Math.random() * 20);
                  OpenWindow=window.open(&quot;&quot;, &quot;metadata_table&quot;+rando.toString(), &quot;height=900, width=900,toolbar=no,scrollbars=yes,menubar=no&quot;);
                  OpenWindow.document.write(new_window_skeleton(htmlstring))
                  OpenWindow.document.close()
                  self.name=&quot;main&quot;
            }
        openindex()
        return
    }
    metadata_table_created = true;
    var info_line = create_header(&#039;mtable&#039;, pi_local);
    document.getElementById(&#039;metadata_table_title&#039;).innerHTML = info_line;
    document.getElementById(&#039;metadata_table_title&#039;).style.color = &#039;white&#039;;
    document.getElementById(&#039;metadata_table_title&#039;).style[&#039;font-size&#039;] = &#039;small&#039;;
    var metadata_div = document.getElementById(&#039;metadata_table_div&#039;);
    
    metadata_div.innerHTML = &#039;&#039;;
    metadata_div.style.display = &#039;block&#039;;
    document.getElementById(&#039;pre_metadata_table_div&#039;).style.display = &#039;block&#039;;
    var html = &#039;&#039;;
      //html += &quot;&lt;table border=&#039;1&#039; id=&#039;metadata_table&#039; class=&#039;single_border small_font md_table&#039; &gt;&quot;;
    html += &quot;&lt;table border=&#039;1&#039; id=&#039;metadata_table&#039; class=&#039;table table-condensed&#039; &gt;&quot;;
    html += &quot;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;Dataset (click to sort)&lt;/th&gt;&lt;th&gt;Name (click to sort)&lt;/th&gt;&lt;th&gt;Value (click to sort)&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&quot;;
      
    for (var ds in md_local) {

          for (var md_item in md_local[ds]) {
            html += &quot;&lt;tr&gt;&quot;;
            html += &quot;&lt;td&gt;&quot;+ds+&quot;&lt;/td&gt;&quot;;
            md_val = md_local[ds][md_item];
            if(md_val == &#039;&#039; || md_val == undefined){
              md_val = &#039;undefined&#039;;
            }
            html += &quot;&lt;td&gt;&quot;+md_item+&quot;&lt;/td&gt;&lt;td&gt;&quot;+md_val+&quot;&lt;/td&gt;&quot;;
            html += &quot;&lt;/tr&gt;&quot;;
          }        
    }
    html += &quot;&lt;/tbody&gt;&lt;/table&gt;&quot;;

      //alert(md_local[0].env_matter)
    metadata_div.innerHTML = html;
    document.getElementById(&#039;metadata_table_dnld_btn&#039;).disabled = false
}

//
//  CREATE Dendrogram
//

function create_dendrogram(ts, image_type, script, new_window) {
      //alert(&#039;im DEND&#039;)
    if(new_window){
        if(image_type == &#039;pdf&#039;){
          //var htmlstring = document.getElementById(&#039;dendrogram_pdf_div&#039;).innerHTML;
        }else if(script == &#039;phylogram&#039;){
          var htmlstring = document.getElementById(&#039;dendrogram01_div&#039;).innerHTML;
        //}else if(script == &#039;phylonator&#039;){  
        //  var htmlstring = document.getElementById(&#039;dendrogram2_div&#039;).innerHTML;
        }else if(script == &#039;radial&#039;){ 
          var htmlstring = document.getElementById(&#039;dendrogram03_div&#039;).innerHTML;
        }
        
        function openindex()
            {
                  rando = Math.floor(Math.random() * 20);
                  OpenWindow=window.open(&quot;&quot;, &quot;dendrogram&quot;+rando.toString(), &quot;height=900, width=900,toolbar=no,scrollbars=yes,menubar=no&quot;);
                  OpenWindow.document.write(new_window_skeleton(htmlstring))
                  OpenWindow.document.close()
                  self.name=&quot;main&quot;
            }

        openindex()
        return

    }
      var info_line = create_header(&#039;dend&#039;, pi_local);
      var dend_div;
      if(script == &#039;phylogram&#039;){  // svg
        //dendrogram1_created = true;
        var dend_div = document.getElementById(&#039;dendrogram01_div&#039;);        
        document.getElementById(&#039;pre_dendrogram01_div&#039;).style.display = &#039;block&#039;;        
        dend_div.style.display = &#039;block&#039;;
        document.getElementById(&#039;dendrogram01_title&#039;).innerHTML = info_line;
        document.getElementById(&#039;dendrogram01_title&#039;).style.color = &#039;white&#039;;
        document.getElementById(&#039;dendrogram01_title&#039;).style[&#039;font-size&#039;] = &#039;small&#039;;
      
      }else if(script == &#039;radial&#039;){  // svg
        //dendrogram3_created = true;
        var dend_div = document.getElementById(&#039;dendrogram03_div&#039;);        
        document.getElementById(&#039;pre_dendrogram03_div&#039;).style.display = &#039;block&#039;;        
        dend_div.style.display = &#039;block&#039;;
        document.getElementById(&#039;dendrogram03_title&#039;).innerHTML = info_line;
        document.getElementById(&#039;dendrogram03_title&#039;).style.color = &#039;white&#039;;
        document.getElementById(&#039;dendrogram03_title&#039;).style[&#039;font-size&#039;] = &#039;small&#039;;
      }else{
        return;
      }
      dend_div.innerHTML = &#039;&#039;;
      
      //var dist = cnsts.DISTANCECHOICES.choices.id[]
      
      
      
      var html = &#039;&#039;;
      var args =  &quot;metric=&quot;+pi_local.selected_distance;
      args += &quot;&amp;ts=&quot;+ts;
      args += &quot;&amp;image_type=&quot;+image_type;
      args += &quot;&amp;script=&quot;+script;
      
      var xmlhttp = new XMLHttpRequest();  
      xmlhttp.open(&quot;POST&quot;, &#039;/visuals/dendrogram&#039;, true);  // gets newick
      xmlhttp.setRequestHeader(&quot;Content-type&quot;,&quot;application/x-www-form-urlencoded&quot;);
      showDots=&#039;&#039;;
      var myWaitVar = setInterval(myWaitFunction,1000,dend_div);
      xmlhttp.onreadystatechange = function() {        
        if (xmlhttp.readyState == 4 ) {
          clearInterval(myWaitVar);
          var htmlstring = xmlhttp.responseText;
          
          //htmlstring =&quot;(&#039;ICM_LCY_Bv6--LCY_0007_2003_05_04&#039;:0.090874090613,(&#039;ICM_LCY_Bv6--LCY_0001_2003_05_11&#039;:0.00863121477239,(&#039;ICM_LCY_Bv6--LCY_0005_2003_05_16&#039;:0.00382350678165,&#039;ICM_LCY_Bv6--LCY_0003_2003_05_04&#039;:0.00382350678165)))&quot;
          var newick = Newick.parse(htmlstring);
         
          //alert(JSON.stringify(newick, null, 4))
          //var newick = JSON.parse(newick);
          var newickNodes = []
          function buildNewickNodes(node, callback) {
            newickNodes.push(node)
            if (node.branchset) {
              for (var i=0; i &lt; node.branchset.length; i++) {
                buildNewickNodes(node.branchset[i])
              }
            }
          }
          buildNewickNodes(newick)
          var w = 1100;
          var h = 900;
          if(ds_local.ids.length &gt; 50){
            h = 1200;
          }
          if(script == &#039;phylogram&#039;){
              document.getElementById(&#039;dendrogram01_div&#039;).innerHTML = &#039;&#039;;
              document.getElementById(&#039;dendrogram01_dnld_btn&#039;).disabled = false
              d3.phylogram.build(&#039;#dendrogram01_div&#039;, newick, {
                width: w,
                height: h
              });
              
          }else if(script == &#039;radial&#039;) {
              
              document.getElementById(&#039;dendrogram03_div&#039;).innerHTML = &#039;&#039;;
              document.getElementById(&#039;dendrogram03_dnld_btn&#039;).disabled = false
              d3.phylogram.buildRadial(&#039;#dendrogram03_div&#039;, newick, {
                width: w,
                height: h
              });
              
              
          }

         
          

        }  // end if xmlhttp.readyState


      };
      xmlhttp.send(args);
 
}


//
//  CREATE PCoA -- both 2d and 3d
//
function create_pcoa(ts,image_type, new_window) {
      //alert(&#039;JS PCoA: &#039;+image_type)
    if(new_window){
        if(image_type === &#039;2d&#039;){
          var htmlstring = document.getElementById(&#039;pcoa_div&#039;).innerHTML;
        
        
          function openindex()
            {
                  rando = Math.floor(Math.random() * 20);
                  OpenWindow=window.open(&quot;&quot;, &quot;pcoa&quot;+rando.toString(), &quot;height=900, width=900,toolbar=no,scrollbars=yes,menubar=no&quot;);
                  OpenWindow.document.write(new_window_skeleton(htmlstring))
                  OpenWindow.document.close()
                  self.name=&quot;main&quot;
            }

          openindex()
          return
        }

    }
    var address, info_line, pcoa_div;
    var args =  &quot;metric=&quot;+pi_local.selected_distance;
    args += &quot;&amp;ts=&quot;+ts;
    args += &quot;&amp;image_type=&quot;+image_type;
    if(image_type === &#039;2d&#039;){
        //pcoa_created = true;
        pcoa_div = document.getElementById(&#039;pcoa_div&#039;);        
        info_line = create_header(&#039;pcoa&#039;, pi_local);        
        pcoa_div.style.display = &#039;block&#039;;
        md1 = document.getElementById(&#039;pcoa_md1&#039;).value;
        md2 = document.getElementById(&#039;pcoa_md2&#039;).value;
        document.getElementById(&#039;pcoa_title&#039;).innerHTML = info_line;
        document.getElementById(&#039;pcoa_title&#039;).style.color = &#039;white&#039;;
        document.getElementById(&#039;pcoa_title&#039;).style[&#039;font-size&#039;] = &#039;small&#039;;
        document.getElementById(&#039;pre_pcoa_div&#039;).style.display = &#039;block&#039;;
        address = &#039;/visuals/pcoa&#039;;
        args += &quot;&amp;md1=&quot;+md1+&quot;&amp;md2=&quot;+md2;
    }else if(image_type === &#039;3d&#039;){
        //alert(&#039;3d&#039;)
        pcoa_created = true;
        pcoa_div = document.getElementById(&#039;pcoa3d_div&#039;);        
        info_line = create_header(&#039;pcoa3d&#039;, pi_local);        
        pcoa_div.style.display = &#039;block&#039;;
        document.getElementById(&#039;pcoa3d_title&#039;).innerHTML = info_line;
        document.getElementById(&#039;pcoa3d_title&#039;).style.color = &#039;white&#039;;
        document.getElementById(&#039;pcoa3d_title&#039;).style[&#039;font-size&#039;] = &#039;small&#039;;
        document.getElementById(&#039;pre_pcoa3d_div&#039;).style.display = &#039;block&#039;;
        address = &#039;/visuals/pcoa3d&#039;;
    }else{
        // ERROR
    }
      
      pcoa_div.innerHTML = &#039;&#039;;
      
      
      var xmlhttp = new XMLHttpRequest();  
      xmlhttp.open(&quot;POST&quot;, address, true);
      xmlhttp.setRequestHeader(&quot;Content-type&quot;,&quot;application/x-www-form-urlencoded&quot;);
      xmlhttp.setRequestHeader(&quot;data-type&quot;,&quot;html&quot;);
      showDots=&#039;&#039;;
      var myWaitVar = setInterval(myWaitFunction,1000,pcoa_div);
      xmlhttp.onreadystatechange = function() {        
        if (xmlhttp.readyState == 4 ) {
            clearInterval(myWaitVar);
            var response = xmlhttp.responseText;            
            pcoa_div.innerHTML = response; 
            if(image_type === &#039;2d&#039;){
              document.getElementById(&#039;pcoa_dnld_btn&#039;).disabled = false
            }else{
              document.getElementById(&#039;pcoa3d_dnld_btn&#039;).disabled = false     
            }
        }
      };
      xmlhttp.send(args);
      
}
//
//  CREATE DBROWSER
//
function create_dbrowser(ts) {
     
         dbrowser_created = true;
         var info_line = create_header(&#039;dbrowser&#039;, pi_local);
         var dbrowser_div = document.getElementById(&#039;dbrowser_div&#039;);
         document.getElementById(&#039;dbrowser_title&#039;).innerHTML = info_line;
         document.getElementById(&#039;dbrowser_title&#039;).style.color = &#039;white&#039;;
        document.getElementById(&#039;dbrowser_title&#039;).style[&#039;font-size&#039;] = &#039;small&#039;;
         dbrowser_div.style.display = &#039;block&#039;;
         
         document.getElementById(&#039;pre_dbrowser_div&#039;).style.display = &#039;block&#039;;
         var args =  &quot;ts=&quot;+ts;
         var xmlhttp = new XMLHttpRequest();  
         xmlhttp.open(&quot;POST&quot;, &#039;/visuals/dbrowser&#039;, true);
         xmlhttp.setRequestHeader(&quot;Content-type&quot;,&quot;application/x-www-form-urlencoded&quot;);
         showDots=&#039;&#039;;
         var myWaitVar = setInterval(myWaitFunction,1000,dbrowser_div);
         xmlhttp.onreadystatechange = function() {          
           if (xmlhttp.readyState == 4 ) {
              clearInterval(myWaitVar);
              var response = xmlhttp.responseText;              
              dbrowser_div.innerHTML = response;            
           }
         };
         xmlhttp.send(args);
}
//
//
//

//
//  CREATE DIST HEATMAP
//
function recreate_image_from_html(image, ts) {
  var htmlstring
  //var str = htmlstring.replace(/\r?\n|\r/g,&#039;&#039;)
  //alert(encodeURIComponent(str))
  //var args = &#039;html=&#039;+encodeURIComponent(htmlstring)
  var args = &#039;&#039;
  args += &#039;ts=&#039;+ts
  args += &#039;&amp;image=&#039;+image
  if(image == &#039;barcharts&#039;){
    htmlstring = document.getElementById(&#039;barcharts_div&#039;).innerHTML;
    args += &#039;&amp;html=&#039;+encodeURIComponent(htmlstring)
  }else if(image == &#039;piecharts&#039;){
    htmlstring = document.getElementById(&#039;piecharts_div&#039;).innerHTML;
    args += &#039;&amp;html=&#039;+encodeURIComponent(htmlstring)
  }else{
    htmlstring = document.getElementById(&#039;dheatmap_div&#039;).innerHTML;
  }
  //alert(args)
  var xmlhttp = new XMLHttpRequest(); 
  xmlhttp.open(&quot;POST&quot;, &#039;/user_data/copy_html_to_image&#039;, true);
  xmlhttp.setRequestHeader(&quot;Content-type&quot;,&quot;application/x-www-form-urlencoded&quot;);
  xmlhttp.onreadystatechange = function() {        
        if (xmlhttp.readyState == 4 ) {
            html = &#039;Saved!\n\n(File available from the &quot;File Retrieval&quot; button on the &quot;Your Data&quot; page)&#039;
            alert(html)            
        }
      };
  xmlhttp.send(args);      
}
//
//
//
function create_dheatmap(ts, new_window) {
      //alert(&#039;im HM&#039;)
      if(new_window){
        var htmlstring = document.getElementById(&#039;dheatmap_div&#039;).innerHTML;
        function openindex()
            {
              rando = Math.floor(Math.random() * 20);
              OpenWindow=window.open(&quot;&quot;, &quot;heatmap&quot;+rando.toString(), &quot;height=900, width=900,toolbar=no,scrollbars=yes,menubar=no&quot;);
              OpenWindow.document.write(new_window_skeleton(htmlstring))
              OpenWindow.document.close()
              self.name=&quot;main&quot;
            }

        openindex()
        return

      }
      dheatmap_created = true;
      var dhm_div = document.getElementById(&#039;dheatmap_div&#039;);
      dhm_div.innerHTML = &#039;&#039;;
      dhm_div.style.display = &#039;block&#039;;
      //var dist = cnsts.DISTANCECHOICES.choices.id[]
      var info_line = create_header(&#039;dhm&#039;, pi_local);
      document.getElementById(&#039;dheatmap_title&#039;).innerHTML = info_line;
      document.getElementById(&#039;dheatmap_title&#039;).style.color = &#039;white&#039;;
      document.getElementById(&#039;dheatmap_title&#039;).style[&#039;font-size&#039;] = &#039;small&#039;;
      var html = &#039;&#039;;
      var args =  &quot;metric=&quot;+pi_local.selected_distance;
      args += &quot;&amp;ts=&quot;+ts;
      document.getElementById(&#039;pre_dheatmap_div&#039;).style.display = &#039;block&#039;;
       // get distance matrix via AJAX
      var xmlhttp = new XMLHttpRequest();  
      xmlhttp.open(&quot;POST&quot;, &#039;/visuals/heatmap&#039;, true);
      xmlhttp.setRequestHeader(&quot;Content-type&quot;,&quot;application/x-www-form-urlencoded&quot;);
      showDots=&#039;&#039;;
      var myWaitVar = setInterval(myWaitFunction,1000,dhm_div);
      xmlhttp.onreadystatechange = function() {        
        if (xmlhttp.readyState == 4 ) {
            clearInterval(myWaitVar);
            var htmlstring = xmlhttp.responseText;           
            
            dhm_div.innerHTML = htmlstring;
            document.getElementById(&#039;dheatmap_dnld_btn&#039;).disabled = false
            

        }
      };
      xmlhttp.send(args);      
}
//
//  CREATE FREQUENCY HEATMAP
//
function create_fheatmap(ts, new_window) {
      //alert(&#039;im HM&#039;)
      if(new_window){
        
          var htmlstring = document.getElementById(&#039;fheatmap_div&#039;).innerHTML;
        
        
          function openindex()
            {
              rando = Math.floor(Math.random() * 20);
              OpenWindow=window.open(&quot;&quot;, &quot;fheatmap&quot;+rando.toString(), &quot;height=900, width=900,toolbar=no,scrollbars=yes,menubar=no&quot;);
              OpenWindow.document.write(new_window_skeleton(htmlstring))
              OpenWindow.document.close()
              self.name=&quot;main&quot;
            }

          openindex()
          return
       

    }
      fheatmap_created = true;
      var fhm_div = document.getElementById(&#039;fheatmap_div&#039;);
      
      fhm_div.innerHTML = &#039;&#039;;
      fhm_div.style.display = &#039;block&#039;;
      //var dist = cnsts.DISTANCECHOICES.choices.id[]
      var info_line = create_header(&#039;fhm&#039;, pi_local);
      document.getElementById(&#039;fheatmap_title&#039;).innerHTML = info_line;
      document.getElementById(&#039;fheatmap_title&#039;).style.color = &#039;white&#039;;
      document.getElementById(&#039;fheatmap_title&#039;).style[&#039;font-size&#039;] = &#039;small&#039;;
      
      var html = &#039;&#039;;
      var args =  &quot;metric=&quot;+pi_local.selected_distance;
      args += &quot;&amp;ts=&quot;+ts;
      document.getElementById(&#039;pre_fheatmap_div&#039;).style.display = &#039;block&#039;;
      var xmlhttp = new XMLHttpRequest();  
      xmlhttp.open(&quot;POST&quot;, &#039;/visuals/frequency_heatmap&#039;, true);
      xmlhttp.setRequestHeader(&quot;Content-type&quot;,&quot;application/x-www-form-urlencoded&quot;);
      showDots=&#039;&#039;;
      var myWaitVar = setInterval(myWaitFunction,1000,fhm_div);
      xmlhttp.onreadystatechange = function() {        
        if (xmlhttp.readyState == 4 ) {
            clearInterval(myWaitVar);
            var htmlstring = xmlhttp.responseText;           
            fhm_div.innerHTML = htmlstring;
            document.getElementById(&#039;fheatmap_dnld_btn&#039;).disabled = false
        }
      };
      xmlhttp.send(args);   
      
}
//
//  CREATE GEOSPATIAL
//
function create_geospatial(new_window) {
      //alert(&#039;in GEO&#039;)
      if(new_window){
        
          var htmlstring = document.getElementById(&#039;map-canvas&#039;).innerHTML;
        
        
          function openindex()
            {
              rando = Math.floor(Math.random() * 20);
              OpenWindow=window.open(&quot;&quot;, &quot;geospatial&quot;+rando.toString(), &quot;height=900, width=900,toolbar=no,scrollbars=yes,menubar=no&quot;);
              OpenWindow.document.write(new_window_skeleton(htmlstring))
              OpenWindow.document.close()
              self.name=&quot;main&quot;
            }

          openindex()
          return
       

    }
      geospatial_created = true;
      var geo_div = document.getElementById(&#039;map-canvas&#039;);
      
      geo_div.innerHTML = &#039;&#039;;
      geo_div.style.display = &#039;block&#039;;
      geo_div.style.height = &#039;900px&#039;;
            
      var info_line = create_header(&#039;geo&#039;, pi_local);      
      document.getElementById(&#039;geospatial_title&#039;).innerHTML = info_line;
      document.getElementById(&#039;geospatial_title&#039;).style.color = &#039;white&#039;;
      document.getElementById(&#039;geospatial_title&#039;).style[&#039;font-size&#039;] = &#039;small&#039;;
      document.getElementById(&#039;pre_geospatial_div&#039;).style.display = &#039;block&#039;;
      
      var loc_data = [];
      var lat_lon_collector = {};
      var latlon;
      
      for (var ds in md_local) {
          var lat = &#039;&#039;;
          var lon = &#039;&#039;;
          for (var k in md_local[ds]) {
            md_item = k;
            if(md_item == &#039;latitude&#039;) {
              lat = Number(md_local[ds][k]);
            }
            if(md_item == &#039;longitude&#039;){              
              lon = Number(md_local[ds][k]);
            }           
            
          } 
          
          if(typeof lat == &#039;number&#039; &amp;&amp; typeof lon == &#039;number&#039;){
            latlon = lat.toString() +&#039;;&#039;+ lon.toString();
            if (latlon in lat_lon_collector) {
              newds = lat_lon_collector[latlon] + &quot;;&quot; + ds;
              lat_lon_collector[latlon] = newds;
            }else{
              lat_lon_collector[latlon] = ds;
            }            
          }
      }
      var z = 1;

      for(latlon in lat_lon_collector){
        //alert(latlon)
        ds = lat_lon_collector[latlon];
        var latlons =  latlon.split(&#039;;&#039;);
        loc_data.push([ds,latlons[0],latlons[1],z]);
        z+=1; 

      }
//alert(ds)
      if (loc_data.length === 0){
          geospatial_div.innerHTML=&#039;No Lat/Lon Data Found/Selected&#039;;
      }else{
        var center = new google.maps.LatLng(loc_data[0][1],loc_data[0][2]); 
        var mapCanvas = document.getElementById(&#039;map-canvas&#039;);
        var mapOptions = {
          center : center,
          zoom   : 3,
          //zoom: 2,
          //mapTypeId: google.maps.MapTypeId.ROADMAP
        };
        var map = new google.maps.Map(mapCanvas, mapOptions);
        var infowindow =  new google.maps.InfoWindow({
          content: &#039;&#039;
        });

        setMarkers(map, loc_data, infowindow);
      }  
}
//
//
//
function bindInfoWindow(marker, map, infowindow, html) { 
  google.maps.event.addListener(marker, &#039;click&#039;, function() { 
    infowindow.setContent(html); 
    infowindow.open(map, marker); 
  }); 
} 
//
//
//
function setMarkers(map, loc_data, infowindow) {
  for (var i = 0; i &lt; loc_data.length; i++) {
    // create a marker
   // alert(locations[0])
    //var data = loc_data[i];
  
    var myLatLng = new google.maps.LatLng(loc_data[i][1],loc_data[i][2]); 
    var marker = new google.maps.Marker({
      title: loc_data[i][0],
      position: myLatLng,
      map: map
    });
    //alert(data[0])
    // add an event listener for this marker
    var ds_array = loc_data[i][0].split(&#039;;&#039;)
    var html = &#039;&#039;;
    html += &quot;&lt;table  class=&#039;table table_striped&#039; &gt;&quot;
    html += &#039;&lt;tr&gt;&lt;th&gt;Dataset&lt;/th&gt;&lt;/tr&gt;&#039;;
    for(d in ds_array){
      //var pid = pid_collector[lines[l]].pid;
      //var val = pid_collector[lines[l]].value;
      html += &quot;&lt;tr&gt;&lt;td&gt;&quot; + ds_array[d] + &quot;&lt;/td&gt;&lt;/tr&gt;&quot;
    }
    html += &#039;&lt;/table&gt;&#039;
    bindInfoWindow(marker, map, infowindow, &quot;&lt;p&gt;&quot; + html + &quot;&lt;/p&gt;&quot;); 

  }

}
//
//  CREATE PIECHARTS
//
function create_piecharts(ts, new_window) {
    if(new_window){
        
          var htmlstring = document.getElementById(&#039;piecharts_div&#039;).innerHTML;
        
        
          function openindex()
            {
              rando = Math.floor(Math.random() * 20);
              OpenWindow=window.open(&quot;&quot;, &quot;piecharts&quot;+rando.toString(), &quot;height=900, width=900,toolbar=no,scrollbars=yes,menubar=no&quot;);
              OpenWindow.document.write(new_window_skeleton(htmlstring))
              OpenWindow.document.close()
              self.name=&quot;main&quot;
            }

          openindex()
          return
       

    }
    piecharts_created = true;
    
    var info_line = create_header(&#039;pies&#039;, pi_local);
    document.getElementById(&#039;piecharts_title&#039;).innerHTML = info_line;
    var piecharts_div = document.getElementById(&#039;piecharts_div&#039;);
    document.getElementById(&#039;piecharts_title&#039;).style.color = &#039;white&#039;;
    document.getElementById(&#039;piecharts_title&#039;).style[&#039;font-size&#039;] = &#039;small&#039;;
    piecharts_div.innerHTML = &#039;&#039;;
    piecharts_div.style.display = &#039;block&#039;;
    
    document.getElementById(&#039;pre_piecharts_div&#039;).style.display = &#039;block&#039;;
    //d3.select(&#039;svg&#039;).remove();
    var unit_list = [];
    for (var o in mtx_local.rows){
        unit_list.push(mtx_local.rows[o].id);
    }
    //var colors = get_colors(unit_list);
    
  
  var tmp={};
  var tmp_names={};
    for (var d in mtx_local.columns){
      tmp[mtx_local.columns[d].id]=[]; // data
      //tmp_names[mtx_local.columns[d].id]=mtx_local.columns[d].id; // datasets
    }
    for (var x in mtx_local.data){
      for (var y in mtx_local.columns){
        tmp[mtx_local.columns[y].id].push(mtx_local.data[x][y]);
      }
    }
    var myjson_obj={};
    myjson_obj.names=[];
    myjson_obj.values=[];
    //myjson_obj.dids=[];
    for (var z in tmp) {
        
        myjson_obj.names.push(z);
        myjson_obj.values.push(tmp[z]);
        //myjson_obj.dids.push(z);
    }
  //alert(myjson_obj.names);
    
    var pies_per_row = 4;
    var m = 20; // margin
    var r = 320/pies_per_row; // five pies per row
    var image_w = 2*(r+m)*pies_per_row;
    var image_h = Math.ceil(myjson_obj.values.length / 4 ) * ( 2 * ( r + m ) )+ 30;
    var arc = d3.svg.arc()
        .innerRadius(0)
        .outerRadius(r);
    var pie = d3.layout.pie();
  
    var svgContainer = d3.select(&quot;#piecharts_div&quot;).append(&quot;svg&quot;)
        .attr(&quot;width&quot;,image_w)
        .attr(&quot;height&quot;,image_h);
    
    var pies = svgContainer.selectAll(&quot;svg&quot;)
        .data(myjson_obj.values)
        .enter().append(&quot;g&quot;)
        .attr(&quot;transform&quot;, function(d, i){

            var modulo_i = i+1;
            var diam = r+m;
            var h_spacer = diam*2*(i % pies_per_row);
            var v_spacer = diam*2*Math.floor(i / pies_per_row);
            return &quot;translate(&quot; + (diam + h_spacer) + &quot;,&quot; + (diam + v_spacer) + &quot;)&quot;;
        })
        
    .append(&quot;a&quot;)
        //.attr(&quot;xlink:xlink:href&quot;, function(d, i) { return &#039;bar_single?did=&#039;+myjson_obj.dids[i]+&#039;&amp;ts=&#039;+ts;} )
        .attr(&quot;xlink:xlink:href&quot;, function(d, i) { return &#039;bar_single?id=&#039;+myjson_obj.names[i]+&#039;&amp;ts=&#039;+ts;} )
    .attr(&quot;target&quot;, &#039;_blank&#039; );
  pies.append(&quot;text&quot;)
        .attr(&quot;dx&quot;, -(r+m))
        .attr(&quot;dy&quot;, r+m)
        .attr(&quot;text-anchor&quot;, &quot;center&quot;)
        .attr(&quot;font-size&quot;,&quot;9px&quot;)
        .text(function(d, i) {
      return mtx_local.columns[i].id;
        });
    pies.selectAll(&quot;path&quot;)
        .data(pie.sort(null))
        .enter().append(&quot;path&quot;)
        .attr(&quot;d&quot;, arc)
        .attr(&quot;id&quot;,function(d, i) {
            var cnt = d.value;
            var total = 0;
            for (var k in this.parentNode.__data__){
              total += this.parentNode.__data__[k];
            }           
            
            var ds = &#039;&#039;; // PLACEHOLDER for TT
            var pct = (cnt * 100 / total).toFixed(2);
            var id = &#039;piecharts-|-&#039;+unit_list[i]+&#039;-|-&#039;+cnt.toString()+&#039;-|-&#039;+pct;
            //alert(unit_list[i]+&#039;-|-&#039;+cnt.toString()+&#039;-|-&#039;+total+&#039;-|-&#039;+pct)
            return id; // ip of each rectangle should be datasetname-|-unitname-|-count
           
        })
        .attr(&quot;class&quot;,&quot;tooltip_viz&quot;)
        .style(&quot;fill&quot;, function(d, i) {
            return string_to_color_code(unit_list[i]);;
        });
  document.getElementById(&#039;piecharts_dnld_btn&#039;).disabled = false

   
}
function heatmap_click_fxn(did1,ds1,did2,ds2){
      //alert(did1)
      var args =  &quot;did1=&quot;+did1;
      args += &quot;&amp;ds1=&quot;+ds1;
      args += &quot;&amp;did2=&quot;+did2;
      args += &quot;&amp;ds2=&quot;+ds2;
      //args += &quot;&amp;ts=&quot;+ts;
      //document.getElementById(&#039;pre_adiversity_div&#039;).style.display = &#039;block&#039;;
       // get distance matrix via AJAX
      var xmlhttp = new XMLHttpRequest();  
      xmlhttp.open(&quot;POST&quot;, &#039;/visuals/bar_double&#039;, true);
      xmlhttp.setRequestHeader(&quot;Content-type&quot;,&quot;application/x-www-form-urlencoded&quot;);
      //showDots=&#039;&#039;;
      //var myWaitVar = setInterval(myWaitFunction,1000,adiversity_div);
      xmlhttp.onreadystatechange = function() {        
        if (xmlhttp.readyState == 4 ) {

          
           //clearInterval(myWaitVar);
            var retstring = xmlhttp.responseText;           
        //alert(retstring)
        window.open(retstring,&quot;_blank&quot;)
        //    var lines = retstring.split(&#039;\n&#039;);
        //    //alert(lines[0])
        //    var headers = lines.shift();
        //    //var line2 = lines.pop();
        //    //alert(headers)
        //    html = &quot;&lt;table class=&#039;table&#039;&gt;&quot;;
        //    html += &#039;&lt;tr&gt;&#039;;
        //    //alert(line2)
        //    var header_items = headers.split(&#039;\t&#039;)
        //    for(i in header_items){
        //      html += &#039;&lt;td&gt;&#039;+header_items[i]+&#039;&lt;/td&gt;&#039;;
        //    }
        //    html +=  &#039;&lt;/tr&gt;&#039;;
        //    for(i in lines){
        //       html +=  &#039;&lt;tr&gt;&#039;;
        //       items = lines[i].split(&#039;\t&#039;);
        //       for(j in items){
        //         html += &#039;&lt;td&gt;&#039;+items[j]+&#039;&lt;/td&gt;&#039;;
        //       }
        //       html +=  &#039;&lt;/tr&gt;&#039;;
        //    }
        //    html += &#039;&lt;/table&gt;&#039;;

        //    adiversity_div.innerHTML = html;
        }
      };
      xmlhttp.send(args);      
}
//
//  CREATE BARCHARTS
//
function create_barcharts_group(ts, new_window) {
      
    if(new_window){
          var htmlstring = document.getElementById(&#039;barcharts_div&#039;).innerHTML;
          function openindex()
            {
              rando = Math.floor(Math.random() * 20);
              OpenWindow=window.open(&quot;&quot;, &quot;barcharts&quot;+rando.toString(), &quot;height=900, width=900,toolbar=no,scrollbars=yes,menubar=no&quot;);
              OpenWindow.document.write(new_window_skeleton(htmlstring))
              OpenWindow.document.close()
              self.name=&quot;main&quot;
            }
          openindex()
          return
    }
    barcharts_created = true;
    var info_line = create_header(&#039;bars&#039;, pi_local);
    document.getElementById(&#039;barcharts_title&#039;).innerHTML = info_line;
    document.getElementById(&#039;barcharts_title&#039;).style.color = &#039;white&#039;;
    document.getElementById(&#039;barcharts_title&#039;).style[&#039;font-size&#039;] = &#039;small&#039;;
    document.getElementById(&#039;barcharts_div&#039;).innerHTML = &#039;&#039;;
//    barcharts_div.style.display = &#039;block&#039;;
         
    document.getElementById(&#039;pre_barcharts_div&#039;).style.display = &#039;block&#039;;
     
         // this fxn is in common_selection.js
    create_barcharts(&#039;group&#039;, ts);
    document.getElementById(&#039;barcharts_dnld_btn&#039;).disabled = false

}
//
//
//
function create_adiversity(ts, new_window){
    //python scripts
    if(new_window){
        
          var htmlstring = document.getElementById(&#039;adiversity_div&#039;).innerHTML;
        
          function openindex()
            {
              rando = Math.floor(Math.random() * 20);
              OpenWindow=window.open(&quot;&quot;, &quot;adiversity&quot;+rando.toString(), &quot;height=900, width=900,toolbar=no,scrollbars=yes,menubar=no&quot;);
              OpenWindow.document.write(new_window_skeleton(htmlstring))
              OpenWindow.document.close()
              self.name=&quot;main&quot;
            }

          openindex()
          return
       

    }
    adiversity_created = true;
    var info_line = create_header(&#039;adiversity&#039;, pi_local);
    document.getElementById(&#039;adiversity_title&#039;).innerHTML = info_line;
    document.getElementById(&#039;adiversity_title&#039;).style.color = &#039;white&#039;;
    document.getElementById(&#039;adiversity_title&#039;).style[&#039;font-size&#039;] = &#039;small&#039;;
    document.getElementById(&#039;pre_adiversity_div&#039;).style.display = &#039;block&#039;;
    document.getElementById(&#039;adiversity_div&#039;).style.display = &#039;block&#039;;
    document.getElementById(&#039;adiversity_div&#039;).innerHTML = &#039;....&#039;;

      adiversity_created = true;
      var adiversity_div = document.getElementById(&#039;adiversity_div&#039;);
      adiversity_div.innerHTML = &#039;&#039;;
      adiversity_div.style.display = &#039;block&#039;;
      //var dist = cnsts.DISTANCECHOICES.choices.id[]
      var info_line = create_header(&#039;adiversity&#039;, pi_local);
      document.getElementById(&#039;adiversity_title&#039;).innerHTML = info_line;
      
      var html = &#039;&#039;;
      var args =  &quot;metric=&quot;+pi_local.selected_distance;
      args += &quot;&amp;ts=&quot;+ts;
      document.getElementById(&#039;pre_adiversity_div&#039;).style.display = &#039;block&#039;;
       // get distance matrix via AJAX
      var xmlhttp = new XMLHttpRequest();  
      xmlhttp.open(&quot;POST&quot;, &#039;/visuals/alpha_diversity&#039;, true);
      xmlhttp.setRequestHeader(&quot;Content-type&quot;,&quot;application/x-www-form-urlencoded&quot;);
      showDots=&#039;&#039;;
      var myWaitVar = setInterval(myWaitFunction,1000,adiversity_div);
      xmlhttp.onreadystatechange = function() {        
        if (xmlhttp.readyState == 4 ) {
           clearInterval(myWaitVar);
           var retstring = xmlhttp.responseText;           
           var lines = retstring.split(&#039;\n&#039;);
           //alert(lines[0])
           var headers = lines.shift();
           //var line2 = lines.pop();
           //alert(headers)
           html = &quot;&lt;table class=&#039;table&#039;&gt;&quot;;
           html += &#039;&lt;tr&gt;&#039;;
           //alert(line2)
           var header_items = headers.split(&#039;\t&#039;)
           for(i in header_items){
             html += &#039;&lt;td&gt;&#039;+header_items[i]+&#039;&lt;/td&gt;&#039;;
           }
           html +=  &#039;&lt;/tr&gt;&#039;;
           for(i in lines){
              html +=  &#039;&lt;tr&gt;&#039;;
              items = lines[i].split(&#039;\t&#039;);
              for(j in items){
                html += &#039;&lt;td&gt;&#039;+items[j]+&#039;&lt;/td&gt;&#039;;
              }
              html +=  &#039;&lt;/tr&gt;&#039;;
           }
           html += &#039;&lt;/table&gt;&#039;;

           adiversity_div.innerHTML = html;
           document.getElementById(&#039;adiversity_dnld_btn&#039;).disabled = false
        }
      };
      xmlhttp.send(args);      
         

}

//
//  CREATE PHYLOSEQ
//
function create_phyloseq(ts,code, new_window) {
      //alert(&#039;im HM&#039;)
      //phyloseq_created = true;
      if(new_window){
          if(code == &#039;bar&#039;){
            var htmlstring = document.getElementById(&#039;phyloseq_bars01_div&#039;).innerHTML;
          }else if(code == &#039;heatmap&#039;){
            var htmlstring = document.getElementById(&#039;phyloseq_hm02_div&#039;).innerHTML;
          }else if(code == &#039;network&#039;){
            var htmlstring = document.getElementById(&#039;phyloseq_nw03_div&#039;).innerHTML;
          }else if(code == &#039;ord&#039;){
            var htmlstring = document.getElementById(&#039;phyloseq_ord04_div&#039;).innerHTML;
          }else if(code == &#039;tree&#039;){
            var htmlstring = document.getElementById(&#039;phyloseq_tree05_div&#039;).innerHTML;
          }
          function openindex()
            {
                  rando = Math.floor(Math.random() * 20);
                  OpenWindow=window.open(&quot;&quot;, &quot;phyloseq&quot;+rando.toString(), &quot;height=900, width=900,toolbar=no,scrollbars=yes,menubar=no&quot;);
                  OpenWindow.document.write(new_window_skeleton(htmlstring))
                  OpenWindow.document.close()
                  self.name=&quot;main&quot;
            }

          openindex()
          return
       

    }
      var phylo_div,info_line,md1=&#039;&#039;,md2=&#039;&#039;,phy=&#039;&#039;,ord_type;
      var html = &#039;&#039;;
      var args =  &quot;metric=&quot;+pi_local.selected_distance;
      args += &quot;&amp;plot_type=&quot;+code;
      args += &quot;&amp;ts=&quot;+ts;

      if(code == &#039;bar&#039;){
        phy = document.getElementById(&#039;phyloseq_bar_phylum&#039;).value;
        if(phy == &#039;0&#039;){
          alert(&#039;You must choose a phylum.&#039;)
          return
        }
        phylo_div = document.getElementById(&#039;phyloseq_bars01_div&#039;);
        info_line = create_header(&#039;phyloseq_bars01&#039;, pi_local);
        document.getElementById(&#039;phyloseq_bars01_title&#039;).innerHTML = info_line;
        document.getElementById(&#039;phyloseq_bars01_title&#039;).style.color = &#039;white&#039;;
        document.getElementById(&#039;phyloseq_bars01_title&#039;).style[&#039;font-size&#039;] = &#039;small&#039;;
        document.getElementById(&#039;pre_phyloseq_bars01_div&#039;).style.display = &#039;block&#039;;
        
        args += &quot;&amp;phy=&quot;+phy;
      }else if(code == &#039;heatmap&#039;){
        phy = document.getElementById(&#039;phyloseq_heatmap_phylum&#039;).value;
        if(phy == &#039;0&#039;){
          alert(&#039;You must choose a phylum.&#039;)
          return
        }
        phylo_div = document.getElementById(&#039;phyloseq_hm02_div&#039;);
        info_line = create_header(&#039;phyloseq_hm02&#039;, pi_local);
        document.getElementById(&#039;phyloseq_hm02_title&#039;).innerHTML = info_line;
        document.getElementById(&#039;phyloseq_hm02_title&#039;).style.color = &#039;white&#039;;
        document.getElementById(&#039;phyloseq_hm02_title&#039;).style[&#039;font-size&#039;] = &#039;small&#039;;
        document.getElementById(&#039;pre_phyloseq_hm02_div&#039;).style.display = &#039;block&#039;;
        
        ord_types = document.getElementsByName(&#039;phyloseq_heatmap_type&#039;);
        md1 = document.getElementById(&#039;phyloseq_heatmap_md1&#039;).value;
        ord_type = &#039;PCoA&#039;;
        if(ord_types[0].checked == true){
          ord_type = &#039;NMDS&#039;;
        }
        args += &quot;&amp;phy=&quot;+phy+&quot;&amp;md1=&quot;+md1+&quot;&amp;ordtype=&quot;+ord_type;
      }else if(code == &#039;network&#039;){
        phylo_div = document.getElementById(&#039;phyloseq_nw03_div&#039;);
        info_line = create_header(&#039;phyloseq_nw03&#039;, pi_local);
        document.getElementById(&#039;phyloseq_nw03_title&#039;).innerHTML = info_line;
        document.getElementById(&#039;phyloseq_nw03_title&#039;).style.color = &#039;white&#039;;
        document.getElementById(&#039;phyloseq_nw03_title&#039;).style[&#039;font-size&#039;] = &#039;small&#039;;
        document.getElementById(&#039;pre_phyloseq_nw03_div&#039;).style.display = &#039;block&#039;;
        md1 = document.getElementById(&#039;phyloseq_network_md1&#039;).value;
        md2 = document.getElementById(&#039;phyloseq_network_md2&#039;).value;
        max_dists = document.getElementsByName(&#039;phyloseq_nwk_dist&#039;);
        max_dist = &#039;0.3&#039;;
        if(max_dists[0].checked == true){
          max_dist = &#039;0.1&#039;;
        }else if(max_dists[1].checked == true){
          max_dist = &#039;0.2&#039;;
        }else if(max_dists[2].checked == true){
          max_dist = &#039;0.3&#039;;
        }else if(max_dists[3].checked == true){
          max_dist = &#039;0.4&#039;;
        }
        args += &quot;&amp;md1=&quot;+md1+&quot;&amp;md2=&quot;+md2+&quot;&amp;maxdist=&quot;+max_dist;
      }else if(code == &#039;ord&#039;){
        phylo_div = document.getElementById(&#039;phyloseq_ord04_div&#039;);
        info_line = create_header(&#039;phyloseq_ord04&#039;, pi_local);
        document.getElementById(&#039;phyloseq_ord04_title&#039;).innerHTML = info_line;
        document.getElementById(&#039;phyloseq_ord04_title&#039;).style.color = &#039;white&#039;;
        document.getElementById(&#039;phyloseq_ord04_title&#039;).style[&#039;font-size&#039;] = &#039;small&#039;;
        document.getElementById(&#039;pre_phyloseq_ord04_div&#039;).style.display = &#039;block&#039;;
        md1 = document.getElementById(&#039;phyloseq_ord_md1&#039;).value;
        md2 = document.getElementById(&#039;phyloseq_ord_md2&#039;).value;
        ord_types = document.getElementsByName(&#039;phyloseq_ord_type&#039;);
        ord_type = &#039;PCoA&#039;;
        if(ord_types[0].checked == true){
          ord_type = &#039;NMDS&#039;;
        }
        args += &quot;&amp;md1=&quot;+md1+&quot;&amp;md2=&quot;+md2+&quot;&amp;ordtype=&quot;+ord_type;
      }else if(code == &#039;tree&#039;){
        phylo_div = document.getElementById(&#039;phyloseq_tree05_div&#039;);
        info_line = create_header(&#039;phyloseq_tree05&#039;, pi_local);
        document.getElementById(&#039;phyloseq_tree05_title&#039;).innerHTML = info_line;
        document.getElementById(&#039;phyloseq_tree05_title&#039;).style.color = &#039;white&#039;;
        document.getElementById(&#039;phyloseq_tree05_title&#039;).style[&#039;font-size&#039;] = &#039;small&#039;;
        document.getElementById(&#039;pre_phyloseq_tree05_div&#039;).style.display = &#039;block&#039;;
        md1 = document.getElementById(&#039;phyloseq_tree_md1&#039;).value;
        args += &quot;&amp;md1=&quot;+md1;
      }
      phylo_div.innerHTML = &#039;&#039;;
      phylo_div.style.display = &#039;block&#039;;
      //var dist = cnsts.DISTANCECHOICES.choices.id[]
      
      var xmlhttp = new XMLHttpRequest();  
      xmlhttp.open(&quot;POST&quot;, &#039;/visuals/phyloseq&#039;, true);
      xmlhttp.setRequestHeader(&quot;Content-type&quot;,&quot;application/x-www-form-urlencoded&quot;);
      //xmlhttp.setRequestHeader(&quot;Content-type&quot;,&quot;application/xml&quot;);
      showDots=&#039;&#039;;
      var myWaitVar = setInterval(myWaitFunction,1000,phylo_div);
      xmlhttp.onreadystatechange = function() {        
        if (xmlhttp.readyState == 4 ) {
           clearInterval(myWaitVar);
           var response = xmlhttp.responseText;          
           phylo_div.innerHTML = response;
           if(code == &#039;bar&#039;){
              document.getElementById(&#039;phyloseq_bars01_dnld_btn&#039;).disabled = false
            }else if(code == &#039;heatmap&#039;){
              document.getElementById(&#039;phyloseq_hm02_dnld_btn&#039;).disabled = false
            }else if(code == &#039;network&#039;){
              document.getElementById(&#039;phyloseq_nw03_dnld_btn&#039;).disabled = false
            }else if(code == &#039;ord&#039;){
              document.getElementById(&#039;phyloseq_ord04_dnld_btn&#039;).disabled = false
            }else if(code == &#039;tree&#039;){
              document.getElementById(&#039;phyloseq_tree05_dnld_btn&#039;).disabled = false
            }
        }
      };
      xmlhttp.send(args);   
      
}
//
//  Interval timer  
//
function myWaitFunction(div) {
    if(showDots === &#039;..........&#039;){ showDots = &#039;&#039;; }
    showDots = showDots || &#039;.&#039;;
    div.innerHTML = showDots;
    showDots += &#039;.&#039;;
}
//
//
//

function create_header(viz, pi) {
  
  var txt;
  //viz_possibles = [&#039;bars&#039;,&#039;pies&#039;,&#039;geo&#039;,&#039;dhm&#039;,&#039;fhm&#039;,&#039;dend-svg&#039;,&#039;dend-pdf&#039;,&#039;pcoa&#039;,&#039;ftable&#039;,&#039;mtable&#039;];
  
    if(viz == &#039;geo&#039;){
      txt = &#039;Geospatial --&gt; &#039;;
    }else if(viz == &#039;bars&#039;){
      txt = &#039;Barcharts --&gt; &#039;;
    }else if(viz == &#039;pies&#039;){
      txt = &#039;Piecharts --&gt; &#039;;
    }else if(viz == &#039;dhm&#039;){
      txt = &#039;Distance Heatmap --&gt; &#039;;
      txt += &#039; Metric: &#039; + pi.selected_distance+&#039;; &#039;;  
    }else if(viz == &#039;fhm&#039;){
      txt = &#039;Frequency Heatmap --&gt; &#039;;
      txt += &#039; Metric: &#039; + pi.selected_distance+&#039;; &#039;;  
    }else if(viz == &#039;dend&#039;){
      txt = &#039;Dendrogram --&gt; &#039;;
      txt += &#039; Metric: &#039; + pi.selected_distance+&#039;; &#039;;  
    }else if(viz == &#039;pcoa&#039;){
      txt = &#039;PCoA 2D --&gt; &#039;;
      txt += &#039; Metric: &#039; + pi.selected_distance+&#039;; &#039;;  
    }else if(viz == &#039;pcoa3d&#039;){
      txt = &#039;PCoA 3D --&gt;&#039;;
      txt += &#039; Metric: &#039; + pi.selected_distance+&#039;; &#039;;  
    }else if(viz == &#039;ftable&#039;){
      txt = &#039;Frequency Table --&gt; &#039;;
    }else if(viz == &#039;mtable&#039;){
      txt = &#039;Metadata Table --&gt; &#039;;
    }else if(viz == &#039;dbrowser&#039;){
      txt = &#039;Data Browser --&gt; &#039;;
    }else if(viz == &#039;adiversity&#039;){
      txt = &#039;Alpha Diversity --&gt; &#039;;
    }else if(viz == &#039;phyloseq_bars01&#039;){
      txt = &#039;Phyloseq Bars --&gt; &#039;;
      txt += &#039; Metric: &#039; + pi.selected_distance+&#039;; &#039;;  
    }else if(viz == &#039;phyloseq_hm02&#039;){
      txt = &#039;Phyloseq Heatmap --&gt; &#039;;
      txt += &#039; Metric: &#039; + pi.selected_distance+&#039;; &#039;;  
    }else if(viz == &#039;phyloseq_nw03&#039;){
      txt = &#039;Phyloseq Network --&gt; &#039;;
      txt += &#039; Metric: &#039; + pi.selected_distance+&#039;; &#039;;  
    }else if(viz == &#039;phyloseq_ord04&#039;){
      txt = &#039;Phyloseq Ordination --&gt; &#039;;
      txt += &#039; Metric: &#039; + pi.selected_distance+&#039;; &#039;;  
    }else if(viz == &#039;phyloseq_tree05&#039;){
      txt = &#039;Phyloseq Tree --&gt; &#039;;
      txt += &#039; Metric: &#039; + pi.selected_distance+&#039;; &#039;;  
    }else{
      txt = &#039;ERROR in fxn create_headers &#039;+viz;
    }
  txt += &#039; Normalization: &#039; + pi.normalization+&#039;; &#039;;
  txt += &#039; Counts Min/Max: &#039; + pi.min_range+&#039;% -- &#039;+pi.max_range+&#039;%&#039;;
     
  return txt;
}

function download_data(type, download_type, ts) {
    var html = &#039;&#039;;
    var args = &#039;ts=&#039;+ts;
    var xmlhttp = new XMLHttpRequest(); 
    
    // if(type == &#039;metadata&#039;){
    //   target = &#039;/user_data/download_file&#039;  
    //   args += &#039;&amp;file_type=&#039;+type;  
    //   args += &quot;&amp;download_type=&quot;+download_type; 
    // } else 
    if(type == &#039;fasta&#039;){
      target = &#039;/user_data/download_file&#039;
      args += &#039;&amp;file_type=&#039;+type;
      args += &quot;&amp;download_type=&quot;+download_type;
    }else if(type == &#039;matrix&#039;){    
      target = &#039;/user_data/download_file&#039;
      args += &#039;&amp;file_type=&#039;+type;
      args += &quot;&amp;download_type=&quot;+download_type;
    
     // else if(type == &#039;csv&#039;){    
     //  target = &#039;/user_data/download_file&#039;
     //  args += &#039;&amp;file_type=&#039;+type;
     //  args += &quot;&amp;download_type=&quot;+download_type;
    } else if(type == &#039;frequency&#039;){    
      target = &#039;/user_data/download_file&#039;
      args += &#039;&amp;file_type=&#039;+type;
    }
    else{
      target = &#039;/user_data/copy_file_for_download&#039;
      args += &#039;&amp;file_type=&#039;+type;
    }
    
   
    xmlhttp.open(&quot;POST&quot;, target, true);
    xmlhttp.setRequestHeader(&quot;Content-type&quot;,&quot;application/x-www-form-urlencoded&quot;);
    xmlhttp.onreadystatechange = function() {
      if (xmlhttp.readyState == 4 ) {
         var filename = xmlhttp.responseText; 
         //html += &quot;&lt;div class=&#039;pull-right&#039;&gt;Your file is being compiled and can be downloaded from the&quot;
         //html += &quot;&lt;br&gt;&lt;a href=&#039;/user_data/file_retrieval&#039;&gt;file retrieval page when ready.&lt;/a&gt;&lt;/div&gt;&quot;
         //document.getElementById(&#039;download_confirm_id&#039;).innerHTML = html;
         html = &#039;Saved!\n\n(File available from the &quot;File Retrieval&quot; button on the &quot;Your Data&quot; page)&#039;
         alert(html)
      }
    };
    xmlhttp.send(args);   
}

//
//
//
function save_configuration(ds_local, user){
  
  if(user==&#039;guest&#039;){
      alert(&quot;The &#039;guest&#039; user is not permitted to save datasets.&quot;);
      return;
    }
  args=&#039;&#039;
  var xmlhttp = new XMLHttpRequest(); 
  xmlhttp.open(&quot;POST&quot;, &#039;/visuals/save_config&#039;, true);
    xmlhttp.setRequestHeader(&quot;Content-type&quot;,&quot;application/x-www-form-urlencoded&quot;);
    xmlhttp.onreadystatechange = function() {
      if (xmlhttp.readyState == 4 ) {
         var response = xmlhttp.responseText; 
         document.getElementById(&#039;save_config_confirmation&#039;).innerHTML = response
         
      }
    };
    xmlhttp.send(args);   
}

function reload_view_form(){
  
  form = document.getElementById(&#039;reload_form_id&#039;);
  form.submit();
  return null
}


function new_window_skeleton(html){

  txt = &#039;&lt;html lang=&quot;en&quot;&gt;&#039;+&quot;\n&quot;
  txt += &quot;&lt;HEAD&gt;&quot;+&quot;\n&quot;
  txt +=&quot;&lt;title&gt;VAMPS: Visuals Select&lt;/title&gt;&quot;+&quot;\n&quot;
  txt +=&#039;&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;/stylesheets/style.css&quot;&gt;&#039;+&quot;\n&quot;
  txt +=&#039;&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;/stylesheets/visualization.css&quot;&gt;&#039;+&quot;\n&quot;
  txt +=&#039;&lt;link rel=&quot;stylesheet&quot; href=&quot;/stylesheets/bootstrap.min.css&quot; &gt;&#039;+&quot;\n&quot;
  txt +=&#039;&lt;link rel=&quot;stylesheet&quot; href=&quot;/stylesheets/bootstrap-theme.min.css&quot;&gt;&#039;+&quot;\n&quot;
  txt +=&#039;&lt;link href=&quot;/stylesheets/bootstrap-responsive.css&quot; rel=&quot;stylesheet&quot; \&gt;&#039;+&quot;\n&quot;
  txt +=&quot;&lt;/HEAD&gt;&quot;+&quot;\n&quot;
  txt +=&quot;&lt;BODY&gt;&quot;+&quot;\n&quot;
  txt +=&quot;&lt;div style=&#039;border:1px solid grey;padding:5px;background:lightgreen;&#039;&gt;&quot;
  txt +=&quot;&lt;table border=&#039;0&#039;&gt;&quot;
  var n = 0;
  var cols = 2;
  for(item in pi_local){
    if(item !== &#039;metadata&#039; &amp;&amp; item !== &#039;ts&#039;){
      txt += &quot;&lt;td align=&#039;right&#039; style=&#039;padding-left:3px;&#039;&gt;&quot;+item+&quot;:&lt;/td&gt;&lt;td&gt;&amp;nbsp;&quot;+pi_local[item]+&quot;&lt;/td&gt;&quot;
      if( n % cols === (cols - 1) ) {  
          txt += &quot;&lt;/tr&gt;&lt;tr&gt;&quot;
      }
      n += 1;
    }
  }
  txt +=&quot;&lt;/table&gt;&quot; +&quot;\n&quot;;
  txt +=&quot;&lt;/div&gt;&quot; +&quot;\n&quot;;
  txt +=html+&quot;\n&quot;
  txt +=&quot;&lt;div id=&#039;counts_tooltip_div&#039; class=&#039;&#039;&gt;&lt;/div&gt;&quot; +&quot;\n&quot;;
  txt +=&quot;&lt;div id=&#039;piebarcharts_tooltip_div&#039; class=&#039;&#039;&gt;&lt;/div&gt;&quot; +&quot;\n&quot;;
  txt +=&quot;&lt;script type=&#039;text/javascript&#039; src=&#039;/javascripts/jquery-2.1.1.min.js&#039;&gt;&lt;/script&gt;&quot; +&quot;\n&quot;;
  txt +=&quot;&lt;script type=&#039;text/javascript&#039; src=&#039;/javascripts/jquery-ui.min.js&#039;&gt;&lt;/script&gt;&quot;+&quot;\n&quot;
  txt +=&quot;&lt;script type=&#039;text/javascript&#039; src=&#039;/javascripts/bootstrap.min.js&#039;&gt;&lt;/script&gt;&quot;+&quot;\n&quot;
  txt +=&#039;&lt;script type=&quot;text/javascript&quot; src=&quot;/javascripts/tablesort.min.js&quot;&gt;&lt;/script&gt;&#039;+&quot;\n&quot;
  txt +=&#039;&lt;script type=&quot;text/javascript&quot; src=&quot;/javascripts/jquery.scrollTo.min.js&quot;&gt;&lt;/script&gt;&#039;+&quot;\n&quot;
  txt +=&#039;&lt;script type=&quot;text/javascript&quot; src=&quot;/javascripts/jquery.tablednd.js&quot;&gt;&lt;/script&gt;&#039;+&quot;\n&quot;
  txt +=&#039;&lt;script type=&quot;text/javascript&quot; src=&quot;/javascripts/d3.min.js&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt;&#039;+&quot;\n&quot;
  txt +=&#039;&lt;script type=&quot;text/javascript&quot; src=&quot;/javascripts/d3pie.min.js&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt;&#039;+&quot;\n&quot;
  txt +=&#039;&lt;script type=&quot;text/javascript&quot; src=&quot;/javascripts/d3.phylogram.js&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt;&#039;+&quot;\n&quot;
  txt +=&#039;&lt;script type=&quot;text/javascript&quot; src=&quot;/javascripts/d3.phylonator.js&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt;&#039;+&quot;\n&quot;
  txt +=&#039;&lt;script type=&quot;text/javascript&quot; src=&quot;/javascripts/newick.js&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt;&#039;+&quot;\n&quot;
  txt +=&#039;&lt;script type=&quot;text/javascript&quot; src=&quot;/javascripts/drag_rows.js&quot;&gt;&lt;/script&gt;&#039;+&quot;\n&quot;
  txt +=&#039;&lt;script type=&quot;text/javascript&quot; src=&quot;/javascripts/global.js&quot;&gt;&lt;/script&gt;&#039;+&quot;\n&quot;
  txt +=&#039;&lt;script type=&quot;text/javascript&quot; src=&quot;/javascripts/common_selection.js&quot;&gt;&lt;/script&gt;&#039;+&quot;\n&quot;
  txt +=&#039;&lt;script type=&quot;text/javascript&quot; src=&quot;/javascripts/view_selection.js&quot;&gt;&lt;/script&gt;&#039;+&quot;\n&quot;
  txt +=&#039;&lt;script type=&quot;text/javascript&quot; src=&quot;/javascripts/bootstrap-select.js&quot;&gt;&lt;/script&gt;&#039;+&quot;\n&quot;
  txt +=&#039;&lt;script type=&quot;text/javascript&quot; src=&quot;/javascripts/jquery.flot.min.js&quot;&gt;&lt;/script&gt;&#039;+&quot;\n&quot;
  txt +=&quot;&lt;/BODY&gt;&quot;+&quot;\n&quot;
  txt +=&quot;&lt;/HTML&gt;&quot;+&quot;\n&quot;
  // code for tooltips
  txt +=&quot;&lt;script&gt;&quot;
  txt +=&quot;var $liveTip = $(&#039;&lt;div id=&#039;livetip_chart&#039;&gt;&lt;/div&gt;&#039;).hide().appendTo(&#039;body&#039;),$win = $(window),showTip;&quot;+&quot;\n&quot;
  txt +=&quot;var tip = {title: &#039;&#039;, offset: 12,delay: 50,position: function(event) {var positions = {x: event.pageX, y: event.pageY};var dimensions = {x: [$win.width(),$liveTip.outerWidth()], y: [$win.scrollTop() + $win.height(),$liveTip.outerHeight()]};for ( var axis in dimensions ) {if (dimensions[axis][0] &lt;dimensions[axis][1] + positions[axis] + this.offset) {positions[axis] -= dimensions[axis][1] + this.offset;} else {positions[axis] += this.offset;}}$liveTip.css({top: positions.y,left: positions.x});}};&quot;+&quot;\n&quot;
  txt +=&quot;$(&#039;body&#039;).delegate(&#039;.tooltip_viz&#039;, &#039;mouseover mouseout mousemove&#039;, function (event) {var link = this,html = &#039;&#039;;$link = $(this);if (event.type == &#039;mouseover&#039;) {tip.id = link.id;link.id = &#039;&#039;;id_items = tip.id.split(&#039;-|-&#039;);html = &#039;&lt;table&gt;&lt;tr&gt;&#039;;if(id_items[0] == &#039;dheatmap&#039;) {html += &#039;&lt;td&gt;&#039;+id_items[1]+&#039;&lt;/td&gt;&#039;;html += &#039;&lt;/tr&gt;&lt;tr&gt;&#039;;html += &#039;&lt;td&gt;&#039;+id_items[2]+&#039;&lt;/td&gt;&#039;;html += &#039;&lt;/tr&gt;&lt;tr&gt;&#039;;html += &#039;&lt;td&gt;Distance: &#039;+id_items[3]+&#039;&lt;/td&gt;&#039;;}else if(id_items[0] == &#039;frequencies&#039;){html += &#039;&lt;td&gt;&#039;+id_items[1]+&#039;&lt;/td&gt;&#039;;html += &#039;&lt;/tr&gt;&lt;tr&gt;&#039;;html += &#039;&lt;td&gt;&#039;+id_items[2]+&#039;&lt;/td&gt;&#039;;html += &#039;&lt;/tr&gt;&lt;tr&gt;&#039;;html += &#039;&lt;td&gt;Count: &#039;+id_items[3]+&#039; (&#039;+id_items[4]+&#039;%)&lt;/td&gt;&#039;;}else{ html += &#039;&lt;td&gt;&#039;+id_items[1]+&#039;&lt;/td&gt;&#039;;    html += &#039;&lt;/tr&gt;&lt;tr&gt;&#039;;html += &#039;&lt;td&gt;Count: &#039;+id_items[2]+&#039; (&#039;+id_items[3]+&#039;%)&lt;/td&gt;&#039;;}html += &#039;&lt;/tr&gt;&lt;table&gt;&#039;;showTip = setTimeout(function() {$link.data(&#039;tipActive&#039;, true);tip.position(event);$liveTip.html(&#039;&lt;div&gt;&#039; + html  + &#039;&lt;/div&gt;&#039;).fadeOut(0).fadeIn(200);}, tip.delay);}if (event.type == &#039;mouseout&#039;) {link.id = tip.id || link.id;if ($link.data(&#039;tipActive&#039;)) {$link.removeData(&#039;tipActive&#039;);$liveTip.hide();} else {clearTimeout(showTip); }}if (event.type == &#039;mousemove&#039; &amp;&amp; $link.data(&#039;tipActive&#039;)) { tip.position(event);}});&quot;+&quot;\n&quot;
  txt +=&quot;$(&#039;body&#039;).delegate(&#039;.tooltip_viz_help&#039;, &#039;mouseover mouseout mousemove&#039;, function (event) {var link = this,html = &#039;&#039;;$link = $(this);if (event.type == &#039;mouseover&#039;) {tip.id = link.id;link.id = &#039;&#039;;if(tip.id==&#039;&#039;){return;}id_items = tip.id.split(&#039;-|-&#039;);html = &#039;&lt;table&gt;&#039;;html += &#039;&lt;tr&gt;&lt;td&gt;Requirements:&lt;/td&gt;&lt;/tr&gt;&#039;;for(var i=0;i&lt;=id_items.length-1;i++){html += &#039;&lt;tr&gt;&lt;td&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&#039;+id_items[i]+&#039;&lt;/td&gt;&lt;/tr&gt;&#039;;}html += &#039;&lt;table&gt;&#039;;showTip = setTimeout(function() {$link.data(&#039;tipActive&#039;, true);tip.position(event);$liveTip.html(&#039;&lt;div&gt;&#039; + html  + &#039;&lt;/div&gt;&#039;).fadeOut(0).fadeIn(200); }, tip.delay);}if (event.type == &#039;mouseout&#039;) {link.id = tip.id || link.id;if ($link.data(&#039;tipActive&#039;)) {$link.removeData(&#039;tipActive&#039;);$liveTip.hide();} else {clearTimeout(showTip);}}if (event.type == &#039;mousemove&#039; &amp;&amp; $link.data(&#039;tipActive&#039;)) {tip.position(event);}});&quot;+&quot;\n&quot;
  txt +=&quot;&lt;/script&gt;&quot;
  return txt
}</textarea>
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p>.</p>
  </div>
</footer>

<script type="text/html" id="complexity-popover-template">
  <div class="complexity-notice">
    Complexity : {{ complexity.cyclomatic }} <br>
    Length : {{ complexity.halstead.length }} <br>
    Difficulty : {{ complexity.halstead.difficulty.toFixed(2) }} <br>
    Est # bugs : {{ complexity.halstead.bugs.toFixed(2) }}<br>
  </div>
</script>

<script type="text/javascript" src="../../assets/scripts/bundles/core-bundle.js"></script>
<script type="text/javascript" src="../../assets/scripts/bundles/codemirror.js"></script>
<script type="text/javascript" src="../../assets/scripts/codemirror.markpopovertext.js"></script>
<script type="text/javascript" src="report.js"></script>
<script type="text/javascript" src="report.history.js"></script>
<script type="text/javascript" src="../../assets/scripts/plato-file.js"></script>
</body>
</html>
