<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Plato - public/javascripts/view_selection.js</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link href="../../assets/css/vendor/morris.css" rel="stylesheet">
  <link href="../../assets/css/vendor/bootstrap.css" rel="stylesheet">
  <link href="../../assets/css/vendor/font-awesome.css" rel="stylesheet">
  <link href="../../assets/css/vendor/codemirror.css" rel="stylesheet">
  <link href="../../assets/css/plato.css" rel="stylesheet">
  <link href="../../assets/css/plato-file.css" rel="stylesheet">

</head>

<body>

<div class="navbar navbar-fixed-top">
  <div class="container">
    <a class="navbar-brand" href="http://github.com/es-analysis/plato">Plato on Github</a>
    <ul class="nav navbar-nav">
      <li>
        <a href="../../index.html">Report Home</a>
      </li>
    </ul>
  </div>
</div>

<div class="jumbotron">
  <div class="container">
    <h1>public/javascripts/view_selection.js</h1>
  </div>
</div>

<div class="container aggregate-stats">
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Maintainability <a href="http://blogs.msdn.com/b/codeanalysis/archive/2007/11/20/maintainability-index-range-and-meaning.aspx"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="A value between 0 and 100 that represents the relative ease of maintaining the code. A high value means better maintainability." data-original-title="Maintainability Index"  data-container="body"></i></a></h2>
      <p class="stat">64.16</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Lines of code <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h2>
      <p class="stat">1174</p>
    </div>
  </div>
  <div class="row historical">
    <div class="col-md-6">
      <p id="chart_historical_maint" class="chart"></p>
    </div>
    <div class="col-md-6">
      <p id="chart_historical_sloc" class="chart"></p>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Difficulty  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="The difficulty measure is related to the difficulty of the program to write or understand." data-original-title="Difficulty" data-container="body"></i></a></h2>
      <p class="stat">77.24</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Estimated Errors  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Halstead's delivered bugs is an estimate for the number of errors in the implementation." data-original-title="Delivered Bugs" data-container="body"></i></a></h2>
      <p class="stat">12.89</p>
    </div>
  </div>
</div>

<div class="container charts">
  <div class="row">
    <h2 class="header">Function weight</h2>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h3 class="chart-header">By Complexity <a href="http://en.wikipedia.org/wiki/Cyclomatic_complexity"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="This metric counts the number of distinct paths through a block of code. Lower values are better." data-original-title="Cyclomatic Complexity" data-container="body"></i></a></h3>
      <div id="fn-by-complexity" class="stat"></div>
    </div>
    <div class="col-md-6">
      <h3 class="chart-header">By SLOC  <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h3>
      <div id="fn-by-sloc" class="stat"></div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <textarea id="file-source" class="col-md-12">$(&quot;#metadata_local_table_div&quot;).on(&quot;click&quot;, &quot;#metadata_table&quot;, function () {
    new Tablesort(document.getElementById(&#039;metadata_table&#039;));
});


// code for tooltips



var $liveTip = $(&#039;&lt;div id=&quot;livetip_chart&quot;&gt;&lt;/div&gt;&#039;).hide().appendTo(&#039;body&#039;),
    $win = $(window),
    showTip;

var tip = {
  title: &#039;&#039;,
  offset: 12,
  delay: 300,
  position: function(event) {
    var positions = {x: event.pageX, y: event.pageY};
    var dimensions = {
      x: [
        $win.width(),
        $liveTip.outerWidth()
      ],
      y: [
        $win.scrollTop() + $win.height(),
        $liveTip.outerHeight()
      ]
    };
 
    for ( var axis in dimensions ) {
 
      if (dimensions[axis][0] &lt;dimensions[axis][1] + positions[axis] + this.offset) {
        positions[axis] -= dimensions[axis][1] + this.offset;
      } else {
        positions[axis] += this.offset;
      }
 
    }
 
    $liveTip.css({
      top: positions.y,
      left: positions.x
    });
  }
};


$(&quot;body&quot;).delegate(&quot;.tooltip&quot;, &quot;mouseover mouseout mousemove&quot;, function (event) {
      var link = this,
      html = &#039;&#039;;
      $link = $(this);
     
      if (event.type == &#039;mouseover&#039;) {
        tip.id = link.id;
        link.id = &#039;&#039;;
        id_items = tip.id.split(&#039;-|-&#039;);
        html = &quot;&lt;table&gt;&lt;tr&gt;&quot;;
        if(id_items[0] == &#039;dheatmap&#039;) {
          html += &quot;&lt;td&gt;&quot;+id_items[1]+&quot;&lt;/td&gt;&quot;;
          html += &quot;&lt;/tr&gt;&lt;tr&gt;&quot;;
          html += &quot;&lt;td&gt;&quot;+id_items[2]+&quot;&lt;/td&gt;&quot;;
          html += &quot;&lt;/tr&gt;&lt;tr&gt;&quot;;
          html += &quot;&lt;td&gt;Distance: &quot;+id_items[3]+&quot;&lt;/td&gt;&quot;;
        }else if(id_items[0] == &#039;frequencies&#039;){
          html += &quot;&lt;td&gt;&quot;+id_items[1]+&quot;&lt;/td&gt;&quot;;
          html += &quot;&lt;/tr&gt;&lt;tr&gt;&quot;;
          html += &quot;&lt;td&gt;&quot;+id_items[2]+&quot;&lt;/td&gt;&quot;;
          html += &quot;&lt;/tr&gt;&lt;tr&gt;&quot;;
          html += &quot;&lt;td&gt;Count: &quot;+id_items[3]+&quot; (&quot;+id_items[4]+&quot;%)&lt;/td&gt;&quot;;
        }else{  // barcharts and piecharts            
          html += &quot;&lt;td&gt;&quot;+id_items[1]+&quot;&lt;/td&gt;&quot;;
          html += &quot;&lt;/tr&gt;&lt;tr&gt;&quot;;
          html += &quot;&lt;td&gt;Count: &quot;+id_items[2]+&quot; (&quot;+id_items[3]+&quot;%)&lt;/td&gt;&quot;;
        }
        html += &quot;&lt;/tr&gt;&lt;table&gt;&quot;;

        showTip = setTimeout(function() {
     
          $link.data(&#039;tipActive&#039;, true);
          
          tip.position(event);
     //alert(event.pageX)
          $liveTip
          .html(&#039;&lt;div&gt;&#039; + html  + &#039;&lt;/div&gt;&#039;)
          .fadeOut(0)
          .fadeIn(200);
     
        }, tip.delay);
      }
     
      if (event.type == &#039;mouseout&#039;) {
        link.id = tip.id || link.id;
        if ($link.data(&#039;tipActive&#039;)) {
          $link.removeData(&#039;tipActive&#039;);
          $liveTip.hide();
        } else {
          clearTimeout(showTip);
        }
      }
     
      if (event.type == &#039;mousemove&#039; &amp;&amp; $link.data(&#039;tipActive&#039;)) {
        tip.position(event);
      }
              
});              
          


// COUNTS
var tax_counts_link = document.getElementById(&#039;counts_table_link_id&#039;);
var tax_counts_btn = document.getElementById(&#039;counts_table_hide_btn&#039;);
var tax_counts_div = document.getElementById(&#039;tax_table_div&#039;);
if (typeof tax_counts_link !==&quot;undefined&quot;) {
  tax_counts_link.addEventListener(&#039;click&#039;, function () {
      //alert(tax_table_created)
      if(typeof tax_table_created == &quot;undefined&quot;){
        get_user_input(&#039;counts_table&#039;, pi_local.ts);
      }else{
        if(tax_counts_btn.value == &#039;close&#039;){
          toggle_visual_element(tax_counts_div,&#039;show&#039;,tax_counts_btn);
        }else{
          toggle_visual_element(tax_counts_div,&#039;hide&#039;,tax_counts_btn);
        }
      }
  });
}
if (typeof tax_counts_btn !==&quot;undefined&quot;) {
  tax_counts_btn.addEventListener(&#039;click&#039;, function () {
      //alert(&#039;here in tt&#039;)
      if(tax_counts_btn.value == &#039;close&#039;){
        toggle_visual_element(tax_counts_div,&#039;show&#039;,tax_counts_btn);
      }else{
        toggle_visual_element(tax_counts_div,&#039;hide&#039;,tax_counts_btn);
      }
      
  });
}
//
// METADATA
//
var metadata_link = document.getElementById(&#039;metadata_table_link_id&#039;);
var metadata_btn = document.getElementById(&#039;metadata_table_hide_btn&#039;);
var metadata_div = document.getElementById(&#039;metadata_local_table_div&#039;);
if (typeof metadata_link !==&quot;undefined&quot;) {
  metadata_link.addEventListener(&#039;click&#039;, function () {
      if(typeof metadata_table_created == &quot;undefined&quot;){
        get_user_input(&#039;metadata_table&#039;, pi_local.ts);
      }else{
        if(metadata_btn.value == &#039;close&#039;){
          toggle_visual_element(metadata_div,&#039;show&#039;,metadata_btn);
        }else{
          toggle_visual_element(metadata_div,&#039;hide&#039;,metadata_btn);
        }
      }
      
  });
}
if (typeof metadata_btn !==&quot;undefined&quot;) {
  metadata_btn.addEventListener(&#039;click&#039;, function () {
      //alert(&#039;here in tt&#039;)
      if(metadata_btn.value == &#039;close&#039;){
        toggle_visual_element(metadata_div,&#039;show&#039;,metadata_btn);
      }else{
        toggle_visual_element(metadata_div,&#039;hide&#039;,metadata_btn);
      }
      
  });
}
//
// PIECHARTS
//
var piecharts_link = document.getElementById(&#039;piecharts_link_id&#039;);
var piecharts_btn = document.getElementById(&#039;piecharts_hide_btn&#039;);
var piecharts_div = document.getElementById(&#039;piecharts_div&#039;);
if (typeof piecharts_link !==&quot;undefined&quot;) {
  piecharts_link.addEventListener(&#039;click&#039;, function () {
      if(typeof piecharts_created == &quot;undefined&quot;){
        get_user_input(&#039;piecharts&#039;, pi_local.ts);
      }else{
        if(piecharts_btn.value == &#039;close&#039;){
          toggle_visual_element(piecharts_div,&#039;show&#039;,piecharts_btn);
        }else{
          toggle_visual_element(piecharts_div,&#039;hide&#039;,piecharts_btn);
        }
      }
      
  });
}
if (typeof piecharts_btn !==&quot;undefined&quot;) {
  piecharts_btn.addEventListener(&#039;click&#039;, function () {
      //alert(&#039;here in tt&#039;)
      if(piecharts_btn.value == &#039;close&#039;){
        toggle_visual_element(piecharts_div,&#039;show&#039;,piecharts_btn);
      }else{
        toggle_visual_element(piecharts_div,&#039;hide&#039;,piecharts_btn);
      }
      
  });
}
//
// BARCHARTS
//
var barchart_link = document.getElementById(&#039;barcharts_link_id&#039;);
var barcharts_btn = document.getElementById(&#039;barcharts_hide_btn&#039;);
var barcharts_div = document.getElementById(&#039;barcharts_div&#039;);
if (typeof barchart_link !==&quot;undefined&quot;) {
  barchart_link.addEventListener(&#039;click&#039;, function () {
      if(typeof barcharts_created == &quot;undefined&quot;){
        get_user_input(&#039;barcharts&#039;, pi_local.ts);
      }else{
        if(barcharts_btn.value == &#039;close&#039;){        
          toggle_visual_element(barcharts_div,&#039;show&#039;,barcharts_btn);
        }else{
          toggle_visual_element(barcharts_div,&#039;hide&#039;,barcharts_btn);
        }
      }
      
  });
}
if (typeof barcharts_btn !==&quot;undefined&quot;) {
  barcharts_btn.addEventListener(&#039;click&#039;, function () {
      //alert(&#039;here in tt&#039;)
      if(barcharts_btn.value == &#039;close&#039;){        
        toggle_visual_element(barcharts_div,&#039;show&#039;,barcharts_btn);
      }else{
        toggle_visual_element(barcharts_div,&#039;hide&#039;,barcharts_btn);
      }
      
  });
}
//
// DISTANCE HEATMAP
//
var dheatmap_link = document.getElementById(&#039;dheatmap_link_id&#039;);
var dheatmap_btn = document.getElementById(&#039;dheatmap_hide_btn&#039;);
var dheatmap_div = document.getElementById(&#039;dheatmap_div&#039;);
if (typeof dheatmap_link !==&quot;undefined&quot;) {
  dheatmap_link.addEventListener(&#039;click&#039;, function () {
      if(typeof dheatmap_created == &quot;undefined&quot;){
        get_user_input(&#039;dheatmap&#039;, pi_local.ts);
      }else{
        if(dheatmap_btn.value == &#039;close&#039;){        
          toggle_visual_element(dheatmap_div,&#039;show&#039;,dheatmap_btn);
        }else{
          toggle_visual_element(dheatmap_div,&#039;hide&#039;,dheatmap_btn);
        }
      }
      
  });
}
if (typeof dheatmap_btn !== &quot;undefined&quot;) {
  dheatmap_btn.addEventListener(&#039;click&#039;, function () {
      //alert(&#039;here in tt&#039;)
      if(dheatmap_btn.value == &#039;close&#039;){        
        toggle_visual_element(dheatmap_div,&#039;show&#039;,dheatmap_btn);
      }else{
        toggle_visual_element(dheatmap_div,&#039;hide&#039;,dheatmap_btn);
      }
      
  });
}
//
// FREQUENCY HEATMAP
//
var fheatmap_link = document.getElementById(&#039;fheatmap_link_id&#039;);
var fheatmap_btn = document.getElementById(&#039;fheatmap_hide_btn&#039;);
var fheatmap_div = document.getElementById(&#039;fheatmap_div&#039;);
if (typeof fheatmap_link !==&quot;undefined&quot;) {
  fheatmap_link.addEventListener(&#039;click&#039;, function () {
      if(typeof fheatmap_created == &quot;undefined&quot;){
        get_user_input(&#039;fheatmap&#039;, pi_local.ts);
      }else{
        if(fheatmap_btn.value == &#039;close&#039;){        
          toggle_visual_element(fheatmap_div,&#039;show&#039;,fheatmap_btn);
        }else{
          toggle_visual_element(fheatmap_div,&#039;hide&#039;,fheatmap_btn);
        }
      }      
  });
}
if (typeof fheatmap_btn !== &quot;undefined&quot;) {
  fheatmap_btn.addEventListener(&#039;click&#039;, function () {
      //alert(&#039;here in tt&#039;)
      if(fheatmap_btn.value == &#039;close&#039;){        
        toggle_visual_element(fheatmap_div,&#039;show&#039;,fheatmap_btn);
      }else{
        toggle_visual_element(fheatmap_div,&#039;hide&#039;,fheatmap_btn);
      }
      
  });
}
//
// DENDROGRAM  D3
//
var dendrogram_link = document.getElementById(&#039;dendrogram_link_id&#039;);
var dendrogram_btn = document.getElementById(&#039;dendrogram_hide_btn&#039;);
var dendrogram_div = document.getElementById(&#039;dendrogram_div&#039;);
if (typeof dendrogram_link !==&quot;undefined&quot;) {
  dendrogram_link.addEventListener(&#039;click&#039;, function () {
      if(typeof dendrogram_created == &quot;undefined&quot;){
        get_user_input(&#039;dendrogram&#039;, pi_local.ts);
      }else{
        if(dendrogram_btn.value == &#039;close&#039;){        
          toggle_visual_element(dendrogram_div,&#039;show&#039;,dendrogram_btn);
        }else{
          toggle_visual_element(dendrogram_div,&#039;hide&#039;,dendrogram_btn);
        }
      }
      
  });
}
if (typeof dendrogram_btn !== &quot;undefined&quot;) {
  dendrogram_btn.addEventListener(&#039;click&#039;, function () {
      //alert(&#039;here in tt&#039;)
      if(dendrogram_btn.value == &#039;close&#039;){        
        toggle_visual_element(dendrogram_div,&#039;show&#039;,dendrogram_btn);
      }else{
        toggle_visual_element(dendrogram_div,&#039;hide&#039;,dendrogram_btn);
      }      
  });
}
//
// DENDROGRAM PNG
//
var dendrogram_pdf_link = document.getElementById(&#039;dendrogram_pdf_link_id&#039;);
var dendrogram_pdf_btn = document.getElementById(&#039;dendrogram_pdf_hide_btn&#039;);
var dendrogram_pdf_div = document.getElementById(&#039;dendrogram_pdf_div&#039;);
if (typeof dendrogram_pdf_link !==&quot;undefined&quot;) {
  dendrogram_pdf_link.addEventListener(&#039;click&#039;, function () {
      if(typeof dendrogram_pdf_created == &quot;undefined&quot;){
        get_user_input(&#039;dendrogram_pdf&#039;, pi_local.ts);
      }else{
        if(dendrogram_pdf_btn.value == &#039;close&#039;){        
          toggle_visual_element(dendrogram_pdf_div,&#039;show&#039;,dendrogram_pdf_btn);
        }else{
          toggle_visual_element(dendrogram_pdf_div,&#039;hide&#039;,dendrogram_pdf_btn);
        }
      }
      
  });
}
if (typeof dendrogram_pdf_btn !== &quot;undefined&quot;) {
  dendrogram_pdf_btn.addEventListener(&#039;click&#039;, function () {
      //alert(&#039;here in tt&#039;)
      if(dendrogram_pdf_btn.value == &#039;close&#039;){        
        toggle_visual_element(dendrogram_pdf_div,&#039;show&#039;,dendrogram_pdf_btn);
      }else{
        toggle_visual_element(dendrogram_png_div,&#039;hide&#039;,dendrogram_pdf_btn);
      }      
  });
}
//
// PCOA
//
var pcoa_link = document.getElementById(&#039;pcoa_link_id&#039;);
var pcoa_btn = document.getElementById(&#039;pcoa_hide_btn&#039;);
var pcoa_div = document.getElementById(&#039;pcoa_div&#039;);
if (typeof pcoa_link !==&quot;undefined&quot;) {
  pcoa_link.addEventListener(&#039;click&#039;, function () {
      if(typeof pcoa_created == &quot;undefined&quot;){
        get_user_input(&#039;pcoa&#039;, pi_local.ts);
      }else{
        if(pcoa_btn.value == &#039;close&#039;){        
          toggle_visual_element(pcoa_div,&#039;show&#039;,pcoa_btn);
        }else{
          toggle_visual_element(pcoa_div,&#039;hide&#039;,pcoa_btn);
        }
      }      
  });
}
if (typeof pcoa_btn !== &quot;undefined&quot;) {
  pcoa_btn.addEventListener(&#039;click&#039;, function () {
      //alert(&#039;here in tt&#039;)
      if(pcoa_btn.value == &#039;close&#039;){        
        toggle_visual_element(pcoa_div,&#039;show&#039;,pcoa_btn);
      }else{
        toggle_visual_element(pcoa_div,&#039;hide&#039;,pcoa_btn);
      }
      
  });
}
//
// GEOSPATIAL
//
var geospatial_link = document.getElementById(&#039;geospatial_link_id&#039;);
var geospatial_btn = document.getElementById(&#039;geospatial_hide_btn&#039;);
var geospatial_div = document.getElementById(&#039;map-canvas&#039;);
if (typeof geospatial_link !==&quot;undefined&quot;) {
  //google.maps.event.addDomListener(window, &#039;load&#039;, initialize);

  geospatial_link.addEventListener(&#039;click&#039;, function () {
      if(typeof geospatial_created == &quot;undefined&quot;){
          get_user_input(&#039;geospatial&#039;, pi_local.ts);
      }else{
        if(geospatial_btn.value == &#039;close&#039;){        
          toggle_visual_element(geospatial_div,&#039;show&#039;,geospatial_btn);
        }else{
          toggle_visual_element(geospatial_div,&#039;hide&#039;,geospatial_btn);
        }
      }      
  });
}
if (typeof geospatial_btn !== &quot;undefined&quot;) {
  geospatial_btn.addEventListener(&#039;click&#039;, function () {
      //alert(&#039;here in tt&#039;)
      if(geospatial_btn.value == &#039;close&#039;){        
        toggle_visual_element(geospatial_div,&#039;show&#039;,geospatial_btn);
      }else{
        toggle_visual_element(geospatial_div,&#039;hide&#039;,geospatial_btn);
      }
      
  });
}

//
//
//
// TEST
//
test_link = document.getElementById(&#039;test_page_link_id&#039;);
if (typeof test_link !==&quot;undefined&quot;) {
  test_link.addEventListener(&#039;click&#039;, function () {
      //alert(&#039;here in pc&#039;)
      create_test_page(pi_local.ts);
  });
}
function create_test_page(ts) {
  
    var opened = window.open(&quot;&quot;);
    opened.document.write(&quot;&lt;html&gt;&lt;head&gt;&lt;title&gt;My title&lt;/title&gt;&lt;/head&gt;&lt;body&gt;open in another page:  test&lt;/body&gt;&lt;/html&gt;&quot;);

}
save_dataset_btn = document.getElementById(&#039;save_dataset_btn&#039;);
if (typeof save_dataset_btn !==&quot;undefined&quot;) {
  save_dataset_btn.addEventListener(&#039;click&#039;, function () {
      alert(&#039;here in pc&#039;)
      //create_test_page(pi_local.ts);
  });
}

function create_test_page(ts) {
//
//
// DOWNLOAD
//
// download_metadata_id = document.getElementById(&#039;download_metadata_id&#039;);
// if (typeof download_metadata_id !==&quot;undefined&quot;) {
//   download_metadata_id.addEventListener(&#039;click&#039;, function () {
      
//       var timestamp = +new Date();  // millisecs since the epoch!
//       var user = user || &#039;no-user&#039;;
//       timestamp = user + &#039;_&#039; + timestamp;
//       var out_file = &#039;downloads/&#039;+timestamp+&#039;.metadata.gz&#039;;
//       console.log(out_file)
//       var file = fs.createWriteStream(out_file);
//       //var request = http.get(&quot;http://i3.ytimg.com/vi/J---aiyznGQ/mqdefault.jpg&quot;, function(response) {
//       //  response.pipe(file);
//       //});
//   });
// }
// download_fasta_id = document.getElementById(&#039;download_fasta_id&#039;);
// if (typeof download_fasta_id !==&quot;undefined&quot;) {
//   download_fasta_id.addEventListener(&#039;click&#039;, function () {
      
//       var timestamp = +new Date();  // millisecs since the epoch!
//       var user = user || &#039;no-user&#039;;
//       timestamp = user + &#039;_&#039; + timestamp;
//       var out_file = &#039;downloads/&#039;+timestamp+&#039;.metadata.gz&#039;;
//       console.log(out_file)
//       var file = fs.createWriteStream(out_file);
//       //var request = http.get(&quot;http://i3.ytimg.com/vi/J---aiyznGQ/mqdefault.jpg&quot;, function(response) {
//       //  response.pipe(file);
//       //});
//   });
// }
//
// visual choices 
//
test_link = document.getElementsByName(&#039;normalization&#039;);


}





function toggle_visual_element(table_div, tog, btn){
  if(tog == &#039;show&#039;) {
    table_div.style.display = &#039;none&#039;;
    btn.value = &#039;open&#039;;
  }else{
    table_div.style.display = &#039;block&#039;;
    btn.value = &#039;close&#039;;
  }
}


function get_user_input(visual, ts) {
   
    if(visual === &#039;counts_table&#039;){
      create_counts_table();      
    }else if(visual === &#039;metadata_table&#039;){
      create_metadata_table();
    }else if(visual === &#039;piecharts&#039;){
      create_piecharts(ts)
    }else if(visual === &#039;barcharts&#039;){
      create_barcharts(ts)
    }else if(visual === &#039;dheatmap&#039;){
      create_dheatmap(ts)
    }else if(visual === &#039;dendrogram&#039;){
      create_dendrogram(ts,&#039;svg&#039;)
    }else if(visual === &#039;dendrogram_pdf&#039;){
      create_dendrogram(ts,&#039;pdf&#039;)
    }else if(visual === &#039;pcoa&#039;){
      create_pcoa(ts)
    }else if(visual === &#039;fheatmap&#039;){
      create_fheatmap(ts)
    }else if(visual === &#039;geospatial&#039;){
      create_geospatial(ts)
    }else{

    }
}
//
// TAX TABLE
//
function create_counts_table() {
      
      tax_table_created = true;
      var info_line = create_header(&#039;ftable&#039;, pi_local);
      document.getElementById(&#039;counts_table_title&#039;).innerHTML = info_line;
      document.getElementById(&#039;pre_counts_table_div&#039;).style.display = &#039;block&#039;;
      var tax_counts_div = document.getElementById(&#039;tax_table_div&#039;);
      var html = &#039;&#039;;
         
      html += &quot;&lt;/table&gt;  &quot;;
      html += &quot;&lt;/span&gt;&quot;;

      html += &quot;&lt;table border=&#039;1&#039; class=&#039;single_border small_font counts_table&#039; &gt;&quot;;
      html += &quot;&lt;tr&gt;&lt;td&gt;&lt;/td&gt;&quot;;
      for (var n in mtx_local.columns) {
        html += &quot;&lt;td class=&#039;&#039;&gt;&quot;+mtx_local.columns[n].name +&quot;&lt;/td&gt;&quot;;
      }
      html += &quot;&lt;/tr&gt;&quot;;
      
      for (var i in mtx_local.rows){
        html += &quot;&lt;tr class=&#039;chart_row&#039;&gt;&quot;;
        html += &quot;&lt;td class=&#039;right_justify&#039;&gt;&quot;+mtx_local.rows[i].name +&quot;&lt;/td&gt;&quot;;
        for (var d in mtx_local.data[i]) {
          var cnt = mtx_local.data[i][d];
          var pct =  (cnt * 100 / mtx_local.column_totals[d]).toFixed(2);
          var id  = &#039;frequencies-|-&#039;+mtx_local.rows[i].name+&#039;-|-&#039;+mtx_local.columns[d].name+&#039;-|-&#039;+cnt.toString()+&#039;-|-&#039;+pct.toString();
          html += &quot;&lt;td id=&#039;&quot;+id+&quot;&#039; class=&#039;tooltip right_justify&#039;&gt;&quot;+cnt+&#039;&lt;/td&gt;&#039;;
          
        }
        html += &quot;&lt;/tr&gt;&quot;;
      }
      // TOTALS
      html += &quot;&lt;tr&gt;&quot;;
      html += &quot;&lt;td class=&#039;right_justify&#039;&gt;&lt;strong&gt;Sums:&lt;/strong&gt;&lt;/td&gt;&quot;;
      for (var m in mtx_local.column_totals){
        html += &quot;&lt;td class=&#039;right_justify&#039;&gt;&quot; + mtx_local.column_totals[m] + &quot;&lt;/td&gt;&quot;;
      }
      html += &quot;&lt;/tr&gt;&quot;;
      html += &quot;&lt;/table&gt;&quot;;

      //document.getElementById(&#039;counts_tooltip_div&#039;).innerHTML = tooltip_tbl;
      tax_counts_div.innerHTML = html;


     
};

//
//  CREATE METADATA TABLE
//
function create_metadata_table() {
     
      metadata_table_created = true;
      var info_line = create_header(&#039;mtable&#039;, pi_local);
      var metadata_div = document.getElementById(&#039;metadata_local_table_div&#039;);
      document.getElementById(&#039;pre_metadata_table_div&#039;).style.display = &#039;block&#039;;
      var html = &#039;&#039;;
      html += &quot;&lt;table border=&#039;1&#039; id=&#039;metadata_table&#039; class=&#039;single_border small_font md_table&#039; &gt;&quot;;
      html += &quot;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;Dataset (sortable)&lt;/th&gt;&lt;th&gt;Name (sortable)&lt;/th&gt;&lt;th&gt;Value (sortable)&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&quot;;
      
      for (var ds in md_local) {

          for (var k in md_local[ds]) {
            html += &quot;&lt;tr&gt;&quot;;
            html += &quot;&lt;td&gt;&quot;+ds+&quot;&lt;/td&gt;&quot;;
            md_item = k;
            md_val = md_local[ds][k];
            html += &quot;&lt;td&gt;&quot;+md_item+&quot;&lt;/td&gt;&lt;td&gt;&quot;+md_val+&quot;&lt;/td&gt;&quot;;
            html += &quot;&lt;/tr&gt;&quot;;
          }        
      }
      html += &quot;&lt;/tbody&gt;&lt;/table&gt;&quot;;

      //alert(md_local[0].env_matter)
      metadata_div.innerHTML = html;
};

//
//  CREATE Dendrogram
//

function create_dendrogram(ts, image_type) {
      //alert(&#039;im DEND&#039;)
      
      var info_line = create_header(&#039;dend&#039;, pi_local);

      if(image_type == &#039;pdf&#039;){
        dendrogram_pdf_created = true;
        var dend_div = document.getElementById(&#039;dendrogram_pdf_div&#039;);
        document.getElementById(&#039;pre_dendrogram_pdf_div&#039;).style.display = &#039;block&#039;;
        document.getElementById(&#039;dendrogram_pdf_title&#039;).innerHTML = info_line;
      }else{  // svg
        dendrogram_created = true;
        var dend_div = document.getElementById(&#039;dendrogram_div&#039;);
        document.getElementById(&#039;pre_dendrogram_div&#039;).style.display = &#039;block&#039;;
        document.getElementById(&#039;dendrogram_title&#039;).innerHTML = info_line;
      }
      
      
      //var dist = cnsts.DISTANCECHOICES.choices.id[]
      
      
      
      
      var html = &#039;&#039;
      var args =  &quot;metric=&quot;+pi_local.selected_distance;
      args += &quot;&amp;ts=&quot;+ts;
      args += &quot;&amp;image_type=&quot;+image_type;
      
      var xmlhttp = new XMLHttpRequest();  
      xmlhttp.open(&quot;POST&quot;, &#039;/visuals/dendrogram&#039;, true);
      xmlhttp.setRequestHeader(&quot;Content-type&quot;,&quot;application/x-www-form-urlencoded&quot;);
      xmlhttp.onreadystatechange = function() {

        if (xmlhttp.readyState == 4 ) {
           var htmlstring = xmlhttp.responseText;
           html = &quot;&lt;div id=&#039;&#039; &gt;&quot;+htmlstring+&quot;&lt;/div&gt;&quot;
           dend_div.innerHTML = html;
        }
      };
      xmlhttp.send(args);
 
};


//
//  CREATE PCoA
//
function create_pcoa(ts) {
      //alert(&#039;JS PCoA&#039;)
      pcoa_created = true;
      var pcoa_div = document.getElementById(&#039;pcoa_div&#039;);
      //var dist = cnsts.DISTANCECHOICES.choices.id[]
      var info_line = create_header(&#039;pcoa&#039;, pi_local);
      document.getElementById(&#039;pcoa_title&#039;).innerHTML = info_line;
      

      var html = &#039;&#039;
      var args =  &quot;metric=&quot;+pi_local.selected_distance;
      args += &quot;&amp;ts=&quot;+ts;
      document.getElementById(&#039;pre_pcoa_div&#039;).style.display = &#039;block&#039;;
       // get distance matrix via AJAX
      var xmlhttp = new XMLHttpRequest();  
      xmlhttp.open(&quot;POST&quot;, &#039;/visuals/pcoa&#039;, true);
      xmlhttp.setRequestHeader(&quot;Content-type&quot;,&quot;application/x-www-form-urlencoded&quot;);
      xmlhttp.onreadystatechange = function() {

        if (xmlhttp.readyState == 4 ) {
           var htmlstring = xmlhttp.responseText;
           pcoa_div.innerHTML = htmlstring;
        }
      };
      xmlhttp.send(args);
      
};
//
//  CREATE DIST HEATMAP
//
function create_dheatmap(ts) {
      //alert(&#039;im HM&#039;)
      dheatmap_created = true;
      var dhm_div = document.getElementById(&#039;dheatmap_div&#039;);
      //var dist = cnsts.DISTANCECHOICES.choices.id[]
      var info_line = create_header(&#039;dhm&#039;, pi_local);
      document.getElementById(&#039;dheatmap_title&#039;).innerHTML = info_line;
      
      var html = &#039;&#039;
      var args =  &quot;metric=&quot;+pi_local.selected_distance;
      args += &quot;&amp;ts=&quot;+ts;
      document.getElementById(&#039;pre_dheatmap_div&#039;).style.display = &#039;block&#039;;
       // get distance matrix via AJAX
      var xmlhttp = new XMLHttpRequest();  
      xmlhttp.open(&quot;POST&quot;, &#039;/visuals/heatmap&#039;, true);
      xmlhttp.setRequestHeader(&quot;Content-type&quot;,&quot;application/x-www-form-urlencoded&quot;);
      xmlhttp.onreadystatechange = function() {
        if (xmlhttp.readyState == 4 ) {
           var htmlstring = xmlhttp.responseText;           
           dhm_div.innerHTML = htmlstring;
        }
      };
      xmlhttp.send(args);      
};
//
//  CREATE FREQUENCY HEATMAP
//
function create_fheatmap(ts) {
      //alert(&#039;im HM&#039;)
      fheatmap_created = true;
      var fhm_div = document.getElementById(&#039;fheatmap_div&#039;);
      //var dist = cnsts.DISTANCECHOICES.choices.id[]
      var info_line = create_header(&#039;fhm&#039;, pi_local);
      document.getElementById(&#039;fheatmap_title&#039;).innerHTML = info_line;
      
      var html = &#039;&#039;
      var args =  &quot;metric=&quot;+pi_local.selected_distance;
      args += &quot;&amp;ts=&quot;+ts;
      document.getElementById(&#039;pre_fheatmap_div&#039;).style.display = &#039;block&#039;;
      var xmlhttp = new XMLHttpRequest();  
      xmlhttp.open(&quot;POST&quot;, &#039;/visuals/frequency_heatmap&#039;, true);
      xmlhttp.setRequestHeader(&quot;Content-type&quot;,&quot;application/x-www-form-urlencoded&quot;);
      xmlhttp.onreadystatechange = function() {
        if (xmlhttp.readyState == 4 ) {
           var htmlstring = xmlhttp.responseText;           
           fhm_div.innerHTML = htmlstring;
        }
      };
      xmlhttp.send(args);   
      
};
//
//  CREATE GEOSPATIAL
//
function create_geospatial(ts) {
      //alert(&#039;in GEO&#039;)
      geospatial_created = true;
      var geo_div = document.getElementById(&#039;map-canvas&#039;);
      //var dist = cnsts.DISTANCECHOICES.choices.id[]
      
      var info_line = create_header(&#039;geo&#039;, pi_local);
      
      document.getElementById(&#039;geospatial_title&#039;).innerHTML = info_line;
       
      document.getElementById(&#039;pre_geospatial_div&#039;).style.display = &#039;block&#039;;
      
      var markers = [];
      var lat_lon_collector = {};
      var latlon;
      
      for (var ds in md_local) {
          var lat = &#039;&#039;
          var lon = &#039;&#039;
          for (var k in md_local[ds]) {
            md_item = k;
            if(md_item == &#039;latitude&#039;) {
              lat = Number(md_local[ds][k]);
            }
            if(md_item == &#039;longitude&#039;){              
              lon = Number(md_local[ds][k]);
            }           
            
          } 
          
          if(typeof lat == &#039;number&#039; &amp;&amp; typeof lon == &#039;number&#039;){
            latlon = lat.toString() +&#039;;&#039;+ lon.toString();
            if (latlon in lat_lon_collector) {
              newds = lat_lon_collector[latlon] + &quot;&lt;br&gt;&quot; + ds
              lat_lon_collector[latlon] = newds;
            }else{
              lat_lon_collector[latlon] = ds;
            }            
          }
      }
      var z = 1;

      for(latlon in lat_lon_collector){
        //alert(latlon)
        ds = lat_lon_collector[latlon];
        var latlons =  latlon.split(&#039;;&#039;);
        markers.push([ds,latlons[0],latlons[1],z]);
        z+=1; 

      }

      if(markers.length == 0){
          geospatial_div.innerHTML=&#039;No Lat/Lon Data Found/Selected&#039;;
      }else{
        var center = new google.maps.LatLng(markers[0][2],markers[0][1]); // wants lon, lat order

        var mapCanvas = document.getElementById(&#039;map-canvas&#039;);
          var mapOptions = {
            center:center,
            zoom: 5,
            //zoom: 2,
            mapTypeId: google.maps.MapTypeId.ROADMAP
          }
        var map = new google.maps.Map(mapCanvas, mapOptions);
        var infowindow =  new google.maps.InfoWindow({
          content: &#039;&#039;
        });

        setMarkers(map, markers, infowindow);
      }  
};

function bindInfoWindow(marker, map, infowindow, html) { 
  google.maps.event.addListener(marker, &#039;click&#039;, function() { 
    infowindow.setContent(html); 
    infowindow.open(map, marker); 
  }); 
} 
function setMarkers(map, locations,infowindow) {
  for (var i = 0; i &lt; locations.length; i++) {
    // create a marker
    var ds = locations[i];
    var myLatLng = new google.maps.LatLng(ds[2], ds[1]); // wants lon, lat order
    var marker = new google.maps.Marker({
      title: ds[0].title,
      position: myLatLng,
      map: map
    });
    
    // add an event listener for this marker
    bindInfoWindow(marker, map, infowindow, &quot;&lt;p&gt;&quot; + ds[0] + &quot;&lt;/p&gt;&quot;); 

  }

}
//
//  CREATE PIECHARTS
//
function create_piecharts(ts) {
     
    piecharts_created = true;
    
    var info_line = create_header(&#039;pies&#039;, pi_local);
    document.getElementById(&#039;piecharts_title&#039;).innerHTML = info_line;
    document.getElementById(&#039;pre_piecharts_table_div&#039;).style.display = &#039;block&#039;;
    //d3.select(&#039;svg&#039;).remove();
    var counts_per_ds = [];
    var tmp={};
    for(var i in mtx_local.columns){
      tmp[mtx_local.columns[i].name]=[]; // datasets
    }
    for(var x in mtx_local.data){
      for(var i in mtx_local.columns){
        tmp[mtx_local.columns[i].name].push(mtx_local.data[x][i]);
      }
    }
    var myjson_obj={};
    myjson_obj.names=[];
    myjson_obj.values=[];
    for(var x in tmp) {
        counts_per_ds.push(tmp[x]);
        myjson_obj.names.push(x);
        myjson_obj.values.push(tmp[x]);
    }
    //alert(myjson_obj.names);
    var unit_list = [];
    for(o in mtx_local.rows){
        unit_list.push(mtx_local.rows[o].name);
    }
    
    
    var colors = get_colors(unit_list);
    var pies_per_row = 4;
    var m = 20; // margin
    var r = 320/pies_per_row; // five pies per row
    var image_w = 2*(r+m)*pies_per_row;
    var image_h = Math.ceil(counts_per_ds.length / 4 ) * ( 2 * ( r + m ) )+ 30;
    var arc = d3.svg.arc()
        .innerRadius(r / 2)
        .outerRadius(r);
    //var counts_per_ds = [[100,20,5],[20,20,20]];
    //for(i in counts_per_ds){
    var svgContainer = d3.select(&quot;#piecharts_div&quot;).append(&quot;svg&quot;)
        .attr(&quot;width&quot;,image_w)
        .attr(&quot;height&quot;,image_h);
    
    var pies = svgContainer.selectAll(&quot;svg&quot;)
        .data(myjson_obj.values)
        .enter().append(&quot;g&quot;)
        .attr(&quot;transform&quot;, function(d, i){
            
            var modulo_i = i+1;
            var d = r+m;
            var h_spacer = d*2*(i % pies_per_row);
            var v_spacer = d*2*Math.floor(i / pies_per_row);
            return &quot;translate(&quot; + (d + h_spacer) + &quot;,&quot; + (d + v_spacer) + &quot;)&quot;;
        })
        .append(&quot;a&quot;)
        .attr(&quot;xlink:xlink:href&quot;, function(d,i) { return &#039;piechart_single?ds=&#039;+myjson_obj.names[i]+&#039;&amp;ts=&#039;+ts;} );

    pies.selectAll(&quot;path&quot;)
        .data(d3.layout.pie())
        .enter().append(&quot;path&quot;)
        .attr(&quot;d&quot;, d3.svg.arc()
        .innerRadius(0)
        .outerRadius(r))
        .attr(&quot;id&quot;,function(d,i) {
            var cnt = d.value;
            var total = 0;
            for(k in this.parentNode.__data__){
              total += this.parentNode.__data__[k];
            }           
            
            var ds = &#039;&#039;; // PLACEHOLDER for TT
            var pct = (cnt * 100 / total).toFixed(2);
            var id = &#039;piecharts-|-&#039;+unit_list[i]+&#039;-|-&#039;+cnt.toString()+&#039;-|-&#039;+pct;
            //alert(unit_list[i]+&#039;-|-&#039;+cnt.toString()+&#039;-|-&#039;+total+&#039;-|-&#039;+pct)
            return id; // ip of each rectangle should be datasetname-|-unitname-|-count
           
        })
        .attr(&quot;class&quot;,&quot;tooltip&quot;)
        .style(&quot;fill&quot;, function(d, i) {
            return colors[i];
        });

    d3.selectAll(&quot;g&quot;)
      .data(myjson_obj.names)
      .append(&quot;text&quot;)
      .attr(&quot;dx&quot;, -(r+m))
      .attr(&quot;dy&quot;, r+m)
      .attr(&quot;text-anchor&quot;, &quot;left&quot;)
      .attr(&quot;font-size&quot;,&quot;9px&quot;)
      .text(function(d, i) {
          return d;
      });
   

};



//
//  CREATE BARCHARTS
//
function create_barcharts(ts) {

        
        barcharts_created = true;
        var info_line = create_header(&#039;bars&#039;, pi_local);
        
        document.getElementById(&#039;barcharts_title&#039;).innerHTML = info_line;
        document.getElementById(&#039;pre_barcharts_table_div&#039;).style.display = &#039;block&#039;;


        data = [];
        for (var p in mtx_local.columns){
          tmp={};
          tmp.DatasetName = mtx_local.columns[p].name;
          for (var t in mtx_local.rows){
            tmp[mtx_local.rows[t].name] = mtx_local.data[t][p];
          }
          data.push(tmp);
        }

      
        var unit_list = [];
        // TODO: &quot;&#039;o&#039; is already defined.&quot;
        for (var o in mtx_local.rows){
          unit_list.push(mtx_local.rows[o].name);
        }
        

        var ds_count = mtx_local.shape[1];      
        var bar_height = 15;
        var props = get_image_properties(bar_height, ds_count); 
        //console.log(props)
        var color = d3.scale.ordinal()                  
          .range( get_colors(unit_list) );

        color.domain(d3.keys(data[0]).filter(function(key) { return key !== &quot;DatasetName&quot;; }));

        

        data.forEach(function(d) {
          var x0 = 0;
          d.unitObj = color.domain().map(function(name) { 
            return { name: name, x0: x0, x1: x0 += +d[name] }; 
          });
          //console.log(d.unitObj);
          d.total = d.unitObj[d.unitObj.length - 1].x1;
          //console.log(d.total);
        });


        data.forEach(function(d) {
          // normalize to 100%
          tot = d.total;
          d.unitObj.forEach(function(o) {
              //console.log(o);
              o.x0 = (o.x0*100)/tot;
              o.x1 = (o.x1*100)/tot;
          });
        });
      
        
        create_svg_object(props, color, data, ts);
        
};

//////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////
function get_image_properties(bar_height, ds_count) {
  var props = {};
  
  //props.margin = {top: 20, right: 20, bottom: 300, left: 50};
  props.margin = {top: 20, right: 100, bottom: 20, left: 300};
  
  var plot_width = 650;
  var gap = 2;  // gap on each side of bar
  props.width = plot_width + props.margin.left + props.margin.right;
  props.height = (ds_count * (bar_height + 2 * gap)) + 125;
  
  props.x = d3.scale.linear() .rangeRound([0, plot_width]);
    
  props.y = d3.scale.ordinal()
      .rangeBands([0, (bar_height + 2 * gap) * ds_count]);
    
  props.xAxis = d3.svg.axis()
          .scale(props.x)
          .orient(&quot;top&quot;);
  
  props.yAxis = d3.svg.axis()
          .scale(props.y)
          .orient(&quot;left&quot;);
          
              
  return props;
}
//
//
//
function create_svg_object(props, color, data, ts) {
       //d3.select(&#039;svg&#039;).remove();
      
      var svg = d3.select(&quot;#barcharts_div&quot;).append(&quot;svg&quot;)
                  .attr(&quot;width&quot;,  props.width)
                  .attr(&quot;height&quot;, props.height)
                .append(&quot;g&quot;)
                  .attr(&quot;transform&quot;, &quot;translate(&quot; + props.margin.left + &quot;,&quot; + props.margin.top + &quot;)&quot;);
      
      
      // axis legends -- would like to rotate dataset names
      props.y.domain(data.map(function(d) { return d.DatasetName; }));
      props.x.domain([0, 100]);

      svg.append(&quot;g&quot;)
          .attr(&quot;class&quot;, &quot;y axis&quot;)
          .call(props.yAxis)
          .selectAll(&quot;text&quot;)  
             .style(&quot;text-anchor&quot;, &quot;end&quot;)
             .attr(&quot;dx&quot;, &quot;-.5em&quot;)
             .attr(&quot;dy&quot;, &quot;1.4em&quot;); 
             
             
      svg.append(&quot;g&quot;)
          .attr(&quot;class&quot;, &quot;x axis&quot;)
          .call(props.xAxis)
        .append(&quot;text&quot;)
          .attr(&quot;x&quot;, 650)
          .attr(&quot;dy&quot;, &quot;.8em&quot;)
          .style(&quot;text-anchor&quot;, &quot;end&quot;)
          .text(&quot;Percent&quot;);
     
     
      

      // var datasetBar = svg.selectAll(&quot;a&quot;)
      //     .data(data)
      //   .enter().append(&quot;a&quot;)
      //   .attr(&quot;xlink:href&quot;,  &#039;http://www.google.com&#039; )
      //   .append(&quot;g&quot;)
      //     .attr(&quot;class&quot;, &quot;g&quot;)
      //     .attr(&quot;transform&quot;, function(d) { return  &quot;translate(0, &quot; + props.y(d.DatasetName) + &quot;)&quot;; })
       var datasetBar = svg.selectAll(&quot;.bar&quot;)
          .data(data)
        .enter() .append(&quot;g&quot;)
          .attr(&quot;class&quot;, &quot;g&quot;)
          .attr(&quot;transform&quot;, function(d) { return  &quot;translate(0, &quot; + props.y(d.DatasetName) + &quot;)&quot;; })  
          .append(&quot;a&quot;)
        .attr(&quot;xlink:xlink:href&quot;,  function(d) { return &#039;piechart_single?ds=&#039;+d.DatasetName+&#039;&amp;ts=&#039;+ts;} );

      datasetBar.selectAll(&quot;rect&quot;)
     //     .append(&quot;a&quot;)
     //   .attr(&quot;xlink:href&quot;,  &#039;http://www.google.com&#039;)
          .data(function(d) { return d.unitObj; })
        .enter()
        .append(&quot;rect&quot;)
          .attr(&quot;x&quot;, function(d) { return props.x(d.x0); })
          .attr(&quot;y&quot;, 15)  // adjust where first bar starts on x-axis
          .attr(&quot;width&quot;, function(d) { return props.x(d.x1) - props.x(d.x0); })
          .attr(&quot;height&quot;,  18)
          .attr(&quot;id&quot;,function(d) { 
            var cnt =  this.parentNode.__data__[d.name];
            var total = this.parentNode.__data__[&#039;total&#039;];
            //console.log(this._parentNode.__data__[&#039;total&#039;]);
            var ds = &#039;&#039;; // PLACEHOLDER for TT
            var pct = (cnt * 100 / total).toFixed(2);
            var id = &#039;barcharts-|-&#039; + d.name + &#039;-|-&#039;+ cnt.toString() + &#039;-|-&#039; + pct; 
            return id;    // ip of each rectangle should be datasetname-|-unitname-|-count
            //return this._parentNode.__data__.DatasetName + &#039;-|-&#039; + d.name + &#039;-|-&#039; + cnt.toString() + &#039;-|-&#039; + pct;    // ip of each rectangle should be datasetname-|-unitname-|-count
          }) 

          .attr(&quot;class&quot;,&quot;tooltip&quot;)
          .style(&quot;fill&quot;,   function(d) { return color(d.name); });


       //rect.append(&quot;svg:a&quot;).attr(&quot;xlink:href&quot;,  &#039;http://www.google.com&#039;)
}


function create_header(viz, pi) {
  
  var txt;
  //viz_possibles = [&#039;bars&#039;,&#039;pies&#039;,&#039;geo&#039;,&#039;dhm&#039;,&#039;fhm&#039;,&#039;dend-svg&#039;,&#039;dend-pdf&#039;,&#039;pcoa&#039;,&#039;ftable&#039;,&#039;mtable&#039;];
  
    if(viz == &#039;geo&#039;){
      txt = &#039;Geospatial -- &#039;;
      txt += &#039; Metric: &#039; + pi.selected_distance+&#039;; &#039;;  
    }else if(viz == &#039;bars&#039;){
      txt = &#039;Barcharts -- &#039;;
    }else if(viz == &#039;pies&#039;){
      txt = &#039;Barcharts -- &#039;;
    }else if(viz == &#039;dhm&#039;){
      txt = &#039;Distance Heatmap -- &#039;;
      txt += &#039; Metric: &#039; + pi.selected_distance+&#039;; &#039;;  
    }else if(viz == &#039;fhm&#039;){
      txt = &#039;Frequency Heatmap -- &#039;;
      txt += &#039; Metric: &#039; + pi.selected_distance+&#039;; &#039;;  
    }else if(viz == &#039;dend&#039;){
      txt = &#039;Dendrogram -- &#039;;
      txt += &#039; Metric: &#039; + pi.selected_distance+&#039;; &#039;;  
    }else if(viz == &#039;pcoa&#039;){
      txt = &#039;PCoA -- &#039;;
      txt += &#039; Metric: &#039; + pi.selected_distance+&#039;; &#039;;  
    }else if(viz == &#039;ftable&#039;){
      txt = &#039;Frequency Table -- &#039;;
    }else if(viz == &#039;mtable&#039;){
      txt = &#039;Metadata Table -- &#039;;
    }else{
      txt = &#039;ERROR in fxn create_headers &#039;+viz;
    }
  txt += &#039; Normalization: &#039; + pi.normalization+&#039;; &#039;;
  txt += &#039; Counts Min/Max: &#039; + pi.min_range+&#039;% -- &#039;+pi.max_range+&#039;%&#039;;
     
  return txt;
}
function get_colors(unit_names){
  var colors = [];
  for(var n in unit_names){
    //alert(unit_names[n]);
    col = string_to_color_code(unit_names[n]);
    //console.log(col);
    colors.push(col);
  }
  return colors;
}
function string_to_color_code(str){
    var hash = 0;
    for(var i=0; i &lt; str.length; i++) {
      hash = str.charCodeAt(i) + ((hash &lt;&lt; 3) - hash);
    }
    var color = Math.abs(hash).toString(16).substring(0, 6);
    return &quot;#&quot; + &#039;000000&#039;.substring(0, 6 - color.length) + color;
}</textarea>
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p>.</p>
  </div>
</footer>

<script type="text/html" id="complexity-popover-template">
  <div class="complexity-notice">
    Complexity : {{ complexity.cyclomatic }} <br>
    Length : {{ complexity.halstead.length }} <br>
    Difficulty : {{ complexity.halstead.difficulty.toFixed(2) }} <br>
    Est # bugs : {{ complexity.halstead.bugs.toFixed(2) }}<br>
  </div>
</script>

<script type="text/javascript" src="../../assets/scripts/bundles/core-bundle.js"></script>
<script type="text/javascript" src="../../assets/scripts/bundles/codemirror.js"></script>
<script type="text/javascript" src="../../assets/scripts/codemirror.markpopovertext.js"></script>
<script type="text/javascript" src="report.js"></script>
<script type="text/javascript" src="report.history.js"></script>
<script type="text/javascript" src="../../assets/scripts/plato-file.js"></script>
</body>
</html>
