<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Plato - routes/visuals/old/routes_pie_charts.js</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link href="../../assets/css/vendor/morris.css" rel="stylesheet">
  <link href="../../assets/css/vendor/bootstrap.css" rel="stylesheet">
  <link href="../../assets/css/vendor/font-awesome.css" rel="stylesheet">
  <link href="../../assets/css/vendor/codemirror.css" rel="stylesheet">
  <link href="../../assets/css/plato.css" rel="stylesheet">
  <link href="../../assets/css/plato-file.css" rel="stylesheet">

</head>

<body>

<div class="navbar navbar-fixed-top">
  <div class="container">
    <a class="navbar-brand" href="http://github.com/es-analysis/plato">Plato on Github</a>
    <ul class="nav navbar-nav">
      <li>
        <a href="../../index.html">Report Home</a>
      </li>
    </ul>
  </div>
</div>

<div class="jumbotron">
  <div class="container">
    <h1>routes/visuals/old/routes_pie_charts.js</h1>
  </div>
</div>

<div class="container aggregate-stats">
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Maintainability <a href="http://blogs.msdn.com/b/codeanalysis/archive/2007/11/20/maintainability-index-range-and-meaning.aspx"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="A value between 0 and 100 that represents the relative ease of maintaining the code. A high value means better maintainability." data-original-title="Maintainability Index"  data-container="body"></i></a></h2>
      <p class="stat">63.21</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Lines of code <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h2>
      <p class="stat">235</p>
    </div>
  </div>
  <div class="row historical">
    <div class="col-md-6">
      <p id="chart_historical_maint" class="chart"></p>
    </div>
    <div class="col-md-6">
      <p id="chart_historical_sloc" class="chart"></p>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Difficulty  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="The difficulty measure is related to the difficulty of the program to write or understand." data-original-title="Difficulty" data-container="body"></i></a></h2>
      <p class="stat">31.05</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Estimated Errors  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Halstead's delivered bugs is an estimate for the number of errors in the implementation." data-original-title="Delivered Bugs" data-container="body"></i></a></h2>
      <p class="stat">2.43</p>
    </div>
  </div>
</div>

<div class="container charts">
  <div class="row">
    <h2 class="header">Function weight</h2>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h3 class="chart-header">By Complexity <a href="http://en.wikipedia.org/wiki/Cyclomatic_complexity"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="This metric counts the number of distinct paths through a block of code. Lower values are better." data-original-title="Cyclomatic Complexity" data-container="body"></i></a></h3>
      <div id="fn-by-complexity" class="stat"></div>
    </div>
    <div class="col-md-6">
      <h3 class="chart-header">By SLOC  <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h3>
      <div id="fn-by-sloc" class="stat"></div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <textarea id="file-source" class="col-md-12">var fpath = require(&#039;path&#039;);
var fs = require(&#039;fs&#039;);
var path = require(&#039;path&#039;);
var COMMON  = require(&#039;./routes_common&#039;);
var d3 = require(&quot;d3&quot;);
var xmldom = require(&#039;xmldom&#039;);


module.exports = {

		//
		//  CREATE PIECHARTS HTML
		//
		create_piecharts_html: function( timestamp, res, mtx ) {
			

  		var counts_per_ds = [];
  		var tmp={};
  		for(var i in mtx.columns){
  			tmp[mtx.columns[i].name]=[]; // datasets
  		}
			for(var x in mtx.data){
  			for(var i in mtx.columns){
  				tmp[mtx.columns[i].name].push(mtx.data[x][i]);
  			}  			
  		}
  		var myjson_obj={};
  		myjson_obj.names=[];
  		myjson_obj.values=[];
  		for(var x in tmp) {
  			counts_per_ds.push(tmp[x]);
  			myjson_obj.names.push(x);
  			myjson_obj.values.push(tmp[x]);
  		}
  		
			//console.log(myjson_obj);

  		var unit_list = [];
			for(o in mtx.rows){
				unit_list.push(mtx.rows[o].name);
			}
			var colors = get_colors(unit_list);
			var pies_per_row = 6;
			//iw = 800
			var image_w = 800;
			var m = 20;  // margin
			//var r = 320/pies_per_row; // 4 ppr
			var r = (((image_w - m)/pies_per_row) - (2*m)) / 2
	    //var r = 280/pies_per_row; // radius: 6 ppr
	    //var r = 240/pies_per_row; // radius: 8 ppr
	    //var image_w = ((m+(2*r))*pies_per_row)+m
	    //var image_w = 2*(r+m)*pies_per_row;
	    
	    var image_h = Math.ceil(counts_per_ds.length / 4 ) * ( 2 * ( r + m ) )+ 30;

		  
			var arc = d3.svg.arc()
                .innerRadius(r / 2)
                .outerRadius(r);

			var pie = d3.layout.pie();
				   
			var svgContainer = d3.select(&quot;body&quot;).append(&quot;svg&quot;)
                                  .attr(&quot;width&quot;,image_w)
                                  .attr(&quot;height&quot;,image_h);
			
			var pies = 	svgContainer.selectAll(&quot;svg&quot;)
			//var svg = d3.select(&quot;body&quot;).selectAll(&quot;svg&quot;)
			    .data(myjson_obj.values)

			  .enter().append(&quot;g&quot;)			    
			    .attr(&quot;transform&quot;, function(d, i){
			    		//console.log(i);
			    		var modulo_i = i+1;
			    		var d = r+m;
			    		var h_spacer = d*2*(i % pies_per_row);
			    		var v_spacer = d*2*Math.floor(i / pies_per_row);			    					    		
			    		return &quot;translate(&quot; + (d + h_spacer) + &quot;,&quot; + (d + v_spacer) + &quot;)&quot;;	
			    })
				.append(&quot;a&quot;)

		    	.attr(&quot;xlink:xlink:href&quot;,  function(d,i) { return &#039;piechart_single?ds=&#039;+myjson_obj.names[i]+&#039;&amp;ts=&#039;+timestamp;} );
			

			pies.selectAll(&quot;path&quot;)
			    //.data(d3.layout.pie().sort(null))
			    .data(d3.layout.pie())
			  .enter().append(&quot;path&quot;)
			    .attr(&quot;d&quot;, d3.svg.arc()
			    .innerRadius(0)
			    .outerRadius(r))
			    .attr(&quot;id&quot;,function(d,i) { 
		      	var cnt =  d.value;
		      	//var total = this._parentNode.__data__[&#039;total&#039;];
		      	
		      	var total = 0;
		      	for(k in this._parentNode.__data__){
		      		total += this._parentNode.__data__[k];
		      	}
		      	//console.log(this._parentNode);
		      	var pct = (cnt * 100 / total).toFixed(2);
		       	return unit_list[i]+&#039;-|-&#039;+cnt.toString()+&#039;-|-&#039;+pct;    // ip of each rectangle should be datasetname-|-unitname-|-count
		       	//return this._parentNode.__data__.DatasetName + &#039;-|-&#039; + d.name + &#039;-|-&#039; + cnt.toString() + &#039;-|-&#039; + pct;    // ip of each rectangle should be datasetname-|-unitname-|-count
					}) 
		      .attr(&quot;class&quot;,&quot;tooltip&quot;)
			    .style(&quot;fill&quot;, function(d, i) { 
			    	//console.log(d);
			    	return colors[i]; 
			    });

			  // add dataset text
			  d3.selectAll(&quot;g&quot;)
			  	.data(myjson_obj.names)
			  	
			  	.append(&quot;text&quot;)
			  	.attr(&quot;dx&quot;, -(r+m))
			  	.attr(&quot;dy&quot;, r+m)			  	
        	.attr(&quot;text-anchor&quot;, &quot;left&quot;)
        	.attr(&quot;font-size&quot;,&quot;9px&quot;)
        	.append(&#039;tspan&#039;)
			  	.text(function(d, i) {
			  		s = d.split(&#039;--&#039;)
			  		return &#039;Project: &#039;+s[0];
			  	})
			  	.append(&#039;tspan&#039;)
			  	.text(function(d, i) {
			  		//console.log(&#039;xxy&#039;);
			  		//console.log(d);
			  		s = d.split(&#039;--&#039;)
			  		return &#039;Dataset: &#039;+s[1];
			  	}).attr(&#039;x&#039;, &#039;-60&#039;).attr(&#039;dy&#039;, &#039;15&#039;)

			  	 
					//console.log(svg.node());
					//console.log((new xmldom.XMLSerializer()).serializeToString(d3.select(&#039;svg&#039;)));

				  var svgGraph = d3.selectAll(&#039;svg&#039;).attr(&#039;xmlns&#039;, &#039;http://www.w3.org/2000/svg&#039;);
						
					//console.log(svgGraph[0]);
						
					//console.log(svgGraph[0][0]);
					
					var svgXML = (new xmldom.XMLSerializer()).serializeToString( svgGraph[0][0] );
					//console.log(svgXML);
					var html = &quot;&lt;div id=&#039;&#039; class=&#039;chart_div center_table&#039;&gt;&quot;+svgXML+&quot;&lt;/div&gt;&quot;;
			

				d3.select(&#039;svg&#039;).remove();
				return html;


	  }, // end fxn
	  //
	  // SINGLE PIE
	  //
	  create_single_piechart_html: function( ts, ds_name, res ) {

	  		var ds_index = chosen_id_name_hash.names.indexOf(ds_name);
	  		console.log(ds_index)
	  		var data = [];

	  		var unit_list = [];
	  		var total = 0;
	  		for(i in biom_matrix.data){
	  			data.push(biom_matrix.data[i][ds_index]);
	  			total += biom_matrix.data[i][ds_index];
	  			//data.push({name: biom_matrix.rows[i].name, cnt: biom_matrix.data[i][ds_index]});
	  			unit_list.push(biom_matrix.rows[i].name);
	  		}
	  		console.log(data);
				var width = 800,
    			height = 500,
    			radius = Math.min(width, height) / 2;
				var colors = get_colors(unit_list);
	  		//console.log(colors);

	  		var arc = d3.svg.arc()
    			.outerRadius(radius - 10)
    			.innerRadius(0);

				var pie = d3.layout.pie()
    			//.sort()
    			.value(function(d) { return d; });

    		var svg = d3.select(&quot;body&quot;).append(&quot;svg&quot;)
				    .attr(&quot;width&quot;, width)
				    .attr(&quot;height&quot;, height)
				  .append(&quot;g&quot;)
				    .attr(&quot;transform&quot;, &quot;translate(&quot; + width / 2 + &quot;,&quot; + height / 2 + &quot;)&quot;);				

				var g = svg.selectAll(&quot;.arc&quot;)
				      .data(pie(data))
				    .enter().append(&quot;g&quot;)
				      .attr(&quot;class&quot;, &quot;arc&quot;)
				     .attr(&quot;id&quot;,function(d,i) { 
		      	var cnt =  d.value;
		      	//var total = this._parentNode.__data__[&#039;total&#039;];
		      	
		      	//console.log(this._parentNode);
		      	var pct = (cnt * 100 / total).toFixed(2);
		       	return unit_list[i]+&#039;-|-&#039;+cnt.toString()+&#039;-|-&#039;+pct;    // ip of each rectangle should be datasetname-|-unitname-|-count
		       	//return this._parentNode.__data__.DatasetName + &#039;-|-&#039; + d.name + &#039;-|-&#039; + cnt.toString() + &#039;-|-&#039; + pct;    // ip of each rectangle should be datasetname-|-unitname-|-count
					}) 
		      .attr(&quot;class&quot;,&quot;tooltip&quot;)

				g.append(&quot;path&quot;)
				      .attr(&quot;d&quot;, arc)
				      .style(&quot;fill&quot;, function(d,i) { return colors[i]; });

				var svgGraph = d3.selectAll(&#039;svg&#039;).attr(&#039;xmlns&#039;, &#039;http://www.w3.org/2000/svg&#039;);
					
				var svgXML = (new xmldom.XMLSerializer()).serializeToString( svgGraph[0][0] );
					
				var html = &quot;&lt;div id=&#039;&#039; class=&#039;chart_div center_table&#039;&gt;&quot;+svgXML+&quot;&lt;/div&gt;&quot;;
			
				d3.select(&#039;svg&#039;).remove();
				return html;

		}

};

//
//
//
function get_colors(unit_names){
	var colors = [];
	for(var n in unit_names){
		//console.log(unit_names[n]);
		col=COMMON.string_to_color_code(unit_names[n]);
		//console.log(col);
		colors.push(col);
	}
	return colors;
}</textarea>
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p>.</p>
  </div>
</footer>

<script type="text/html" id="complexity-popover-template">
  <div class="complexity-notice">
    Complexity : {{ complexity.cyclomatic }} <br>
    Length : {{ complexity.halstead.length }} <br>
    Difficulty : {{ complexity.halstead.difficulty.toFixed(2) }} <br>
    Est # bugs : {{ complexity.halstead.bugs.toFixed(2) }}<br>
  </div>
</script>

<script type="text/javascript" src="../../assets/scripts/bundles/core-bundle.js"></script>
<script type="text/javascript" src="../../assets/scripts/bundles/codemirror.js"></script>
<script type="text/javascript" src="../../assets/scripts/codemirror.markpopovertext.js"></script>
<script type="text/javascript" src="report.js"></script>
<script type="text/javascript" src="report.history.js"></script>
<script type="text/javascript" src="../../assets/scripts/plato-file.js"></script>
</body>
</html>
