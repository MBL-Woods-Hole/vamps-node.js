<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Plato - routes/visuals/routes_counts_matrix.js</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link href="../../assets/css/vendor/morris.css" rel="stylesheet">
  <link href="../../assets/css/vendor/bootstrap.css" rel="stylesheet">
  <link href="../../assets/css/vendor/font-awesome.css" rel="stylesheet">
  <link href="../../assets/css/vendor/codemirror.css" rel="stylesheet">
  <link href="../../assets/css/plato.css" rel="stylesheet">
  <link href="../../assets/css/plato-file.css" rel="stylesheet">

</head>

<body>

<div class="navbar navbar-fixed-top">
  <div class="container">
    <a class="navbar-brand" href="http://github.com/es-analysis/plato">Plato on Github</a>
    <ul class="nav navbar-nav">
      <li>
        <a href="../../index.html">Report Home</a>
      </li>
    </ul>
  </div>
</div>

<div class="jumbotron">
  <div class="container">
    <h1>routes/visuals/routes_counts_matrix.js</h1>
  </div>
</div>

<div class="container aggregate-stats">
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Maintainability <a href="http://blogs.msdn.com/b/codeanalysis/archive/2007/11/20/maintainability-index-range-and-meaning.aspx"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="A value between 0 and 100 that represents the relative ease of maintaining the code. A high value means better maintainability." data-original-title="Maintainability Index"  data-container="body"></i></a></h2>
      <p class="stat">42.10</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Lines of code <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h2>
      <p class="stat">570</p>
    </div>
  </div>
  <div class="row historical">
    <div class="col-md-6">
      <p id="chart_historical_maint" class="chart"></p>
    </div>
    <div class="col-md-6">
      <p id="chart_historical_sloc" class="chart"></p>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Difficulty  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="The difficulty measure is related to the difficulty of the program to write or understand." data-original-title="Difficulty" data-container="body"></i></a></h2>
      <p class="stat">61.97</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Estimated Errors  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Halstead's delivered bugs is an estimate for the number of errors in the implementation." data-original-title="Delivered Bugs" data-container="body"></i></a></h2>
      <p class="stat">4.26</p>
    </div>
  </div>
</div>

<div class="container charts">
  <div class="row">
    <h2 class="header">Function weight</h2>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h3 class="chart-header">By Complexity <a href="http://en.wikipedia.org/wiki/Cyclomatic_complexity"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="This metric counts the number of distinct paths through a block of code. Lower values are better." data-original-title="Cyclomatic Complexity" data-container="body"></i></a></h3>
      <div id="fn-by-complexity" class="stat"></div>
    </div>
    <div class="col-md-6">
      <h3 class="chart-header">By SLOC  <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h3>
      <div id="fn-by-sloc" class="stat"></div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <textarea id="file-source" class="col-md-12">// counts_matrix.js
var path = require(&#039;path&#039;);
var fs = require(&#039;fs&#039;);
var COMMON  = require(&#039;./routes_common&#039;);
// biome format:dense: http://biom-format.org/documentation/format_versions/biom-1.0.html#example-biom-files
// {
//     &quot;id&quot;:null,
//     &quot;format&quot;: &quot;Biological Observation Matrix 0.9.1-dev&quot;,
//     &quot;format_url&quot;: &quot;http://biom-format.org/documentation/format_versions/biom-1.0.html&quot;,
//     &quot;type&quot;: &quot;OTU table&quot;,
//     &quot;generated_by&quot;: &quot;QIIME revision 1.4.0-dev&quot;,
//     &quot;date&quot;: &quot;2011-12-19T19:00:00&quot;,
//     &quot;rows&quot;:[
//             {&quot;id&quot;:&quot;GG_OTU_1&quot;, &quot;metadata&quot;:null},
//             {&quot;id&quot;:&quot;GG_OTU_2&quot;, &quot;metadata&quot;:null},
//             {&quot;id&quot;:&quot;GG_OTU_3&quot;, &quot;metadata&quot;:null},
//             {&quot;id&quot;:&quot;GG_OTU_4&quot;, &quot;metadata&quot;:null},
//             {&quot;id&quot;:&quot;GG_OTU_5&quot;, &quot;metadata&quot;:null}
//         ],
//     &quot;columns&quot;: [
//             {&quot;id&quot;:&quot;Sample1&quot;, &quot;metadata&quot;:null},
//             {&quot;id&quot;:&quot;Sample2&quot;, &quot;metadata&quot;:null},
//             {&quot;id&quot;:&quot;Sample3&quot;, &quot;metadata&quot;:null},
//             {&quot;id&quot;:&quot;Sample4&quot;, &quot;metadata&quot;:null},
//             {&quot;id&quot;:&quot;Sample5&quot;, &quot;metadata&quot;:null},
//             {&quot;id&quot;:&quot;Sample6&quot;, &quot;metadata&quot;:null}
//         ],
//     &quot;matrix_type&quot;: &quot;dense&quot;,
//     &quot;matrix_element_type&quot;: &quot;int&quot;,
//     &quot;shape&quot;: [5, 6],
//     &quot;data&quot;:  [[0,0,1,0,0,0],
//               [5,1,0,2,3,1],
//               [0,0,1,4,2,0],
//               [2,1,1,0,0,1],
//               [0,1,1,0,0,0]]
// }


module.exports = {


		get_biome_matrix: function(chosen_id_name_hash, post_items, sqlrows) {
			var date = new Date();
			
			biome_matrix = {
				id: post_items.ts,
				format: &quot;Biological Observation Matrix&quot;,
				units: post_items.unit_choice,
				generated_by:&quot;VAMPS-NodeJS Version 2.0&quot;,
				date: date.toISOString(),
				rows:[],												// taxonomy (or OTUs, MED nodes) names
				columns:[],											// ORDERED dataset names
				column_totals:[],								// ORDERED datasets count sums
				max_dataset_count:0,						// maximum dataset count
				matrix_type: &#039;dense&#039;,
    		matrix_element_type: &#039;int&#039;,
     		shape: [],									// [row_count, col_count]
     		data:  []										// ORDERED list of lists of counts: [ [],[],[] ... ]
     	};
			
			var unit_name_lookup = {};
			var ukeys = [];
			var unit_name_lookup_per_dataset = {};
		  //var unit_id_lookup = {};
			for (var r=0; r &lt; sqlrows.length; r++){

				tax = assemble_taxa(post_items.tax_depth, new_taxonomy.taxa_tree_dict_map_by_db_id_n_rank, sqlrows[r]);

		    var did  = sqlrows[r].dataset_id;
		    var cnt  = sqlrows[r].seq_count;
		    //var uid  = sqlrows[r].uid;
		    //var uname = sqlrows[r].tax;
		    var uname = tax;
		    //counts = uid_matrix[uid];
		    //biome_matrix.rows.push({id:name})
		    //biome_matrix.data.push(counts)
		    //console.log(did)
				//unit_id_lookup   = create_unit_id_lookup( uid, counts, unit_id_lookup );
				unit_name_lookup[uname] = 1;
				ukeys.push(uname);

				//unit_name_lookup_per_dataset[did][uid] = sumcounts
		  	//unit_name_lookup = create_unit_name_lookup_per_dataset( did, uname, counts, unit_name_lookup);
		  	if(did in unit_name_lookup_per_dataset) {
		  		if(uname in unit_name_lookup_per_dataset[did]) {
		  			unit_name_lookup_per_dataset[did][uname] += parseInt(cnt);
		  		}else{
		  			unit_name_lookup_per_dataset[did][uname] = parseInt(cnt);
		  		}

		  	}else{
		  		unit_name_lookup_per_dataset[did] = {};
		  		if(uname in unit_name_lookup_per_dataset[did]) {
		  			unit_name_lookup_per_dataset[did][uname] += parseInt(cnt);

		  		}else{
		  			unit_name_lookup_per_dataset[did][uname] = parseInt(cnt);
		  		}
		  	}
		   
		  }

		  var unit_name_counts={};
		  for(uname in unit_name_lookup){
		  	unit_name_counts[uname]=[];
		  }
		  for (var n in chosen_id_name_hash.ids) { // correct order
		  	did = chosen_id_name_hash.ids[n];
		  	
		  	for(uname in unit_name_lookup) {
		  		if(did in unit_name_lookup_per_dataset &amp;&amp; uname in unit_name_lookup_per_dataset[did]) {
		  			cnt = unit_name_lookup_per_dataset[did][uname];
		  			unit_name_counts[uname].push(cnt);

		  		} else {
		  			unit_name_counts[uname].push(0);
		  		}
		  	}
		  }
		  ukeys.push(uname);
		  ukeys = ukeys.filter(onlyUnique);
		  ukeys.sort();
		  //console.log(unit_name_lookup_per_dataset);
		  
		  biome_matrix 	= create_biome_matrix( biome_matrix, unit_name_counts, ukeys, chosen_id_name_hash );
		  
		  var matrix_file = &#039;../../tmp/&#039;+post_items.ts+&#039;_count_matrix.biom&#039;;
		    
 			console.log(&#039;Writing matrix file&#039;);
 			//COMMON.write_file( matrix_file, JSON.stringify(biome_matrix) );
 			COMMON.write_file( matrix_file, JSON.stringify(biome_matrix,null,2) );

			return biome_matrix;

			function onlyUnique(value, index, self) { 
		    return self.indexOf(value) === index;
			}

		},

		//
		// F I L L  I N  C O U N T S  M A T R I X
		//
		fill_in_counts_matrix: function(selection_obj, field) {
			// This function creates a counts matrix using only the dataset_ids (no names)
			// and fills it in with zeros where appropriate.
			// when returned this matrix becomes part of the selection_obj
			// FORMAT:
			// counts_matrix:{&quot;82&quot;:[4,2,2],&quot;84&quot;:[0,0,1],&quot;137&quot;:[0,0,1],&quot;214&quot;:[272,401,430]}}

		  //selection_obj = JSON.parse(selection_obj);
		  
		  var matrix = {};  
		  
		  var dataset_ids = selection_obj.dataset_ids;
		  var unit_assoc  = selection_obj.unit_assoc[field];  // TODO: change depending on user selection
		  var seq_freqs   = selection_obj.seq_freqs;      
		  //console.log(&#039;&#039;)
		  //    seq_ids  : [id1,id2,id3...],
		  //    tax_id1 : [tct1,0,tid3...],
		  //    tax_id2 : [tct4,tct5,tct6...],
		  //    tax_id3 : [tct7,tct8,0...]
		  //    ....
		  //  }

		  //var old_sid = &#039;x&#039;;
		  //var tids = [96,214,82,214,137];
		  //var vals = [2,103,8,203,3];

		  // for (i=0; i &lt; tids.length; i++) {
		  //   id = tids[i]
		  //   if (id in tmp){
		  //     tmp[id][0] += vals[i]
		  //   } else {
		  //     tmp[id] = [vals[i]]
		  //   }
		  // }
		  var counts = {};
		  var unit_id_lookup = {};
		  var unit_ids = [];
		  var unit_id;
		  var tmp;
		  
		  for (var n=0; n &lt; unit_assoc.length; n++) {

		        unit_ids = unit_assoc[n];
		        tmp = {};
		        counts[dataset_ids[n]] = {};
		        for (var i=0; i &lt; unit_ids.length; i++) {
		            unit_id = unit_ids[i];
		            unit_id_lookup[unit_id]=1;
		            if (unit_id in tmp){
		              tmp[ unit_id ] += seq_freqs[n][i];
		            } else {
		              tmp[ unit_id ] = seq_freqs[n][i];
		            }
		        }
		        counts[ dataset_ids[n] ]=tmp;
		  }
		  //console.log(JSON.stringify(counts,null,4));
		 //console.log(unit_id_lookup);
		// { &#039;82&#039;: 8, &#039;96&#039;: 2, &#039;137&#039;: 3, &#039;214&#039;: 306 }
		// { &#039;82&#039;: 4, &#039;96&#039;: 2, &#039;214&#039;: 33 }
		// { &#039;82&#039;: 1, &#039;96&#039;: 1, &#039;137&#039;: 1, &#039;214&#039;: 277 }
		// { &#039;82&#039;: 6, &#039;96&#039;: 1, &#039;137&#039;: 1, &#039;214&#039;: 596 }
		// { &#039;82&#039;: 1, &#039;84&#039;: 4, &#039;96&#039;: 2, &#039;112&#039;: 1, &#039;137&#039;: 1, &#039;214&#039;: 75 }
		// { &#039;82&#039;: 2, &#039;96&#039;: 1, &#039;112&#039;: 1, &#039;214&#039;: 331 }
		  //var mtx = &quot;\t&quot;;
		  
		  //for(did in dataset_ids) {
		  for (var uid in unit_id_lookup) {  
		    matrix[uid]=[];
		    
		    for (var d in dataset_ids) { // this is correct order
		    	did = dataset_ids[d];

		      if(uid in counts[did]){
		        c = counts[did][uid];
		      }else{
		        c = 0;
		      }
		      matrix[uid].push(c);

		    }
		  }
		  return matrix;
		},

	

};
//
//
//
function create_biome_matrix(biome_matrix, unit_name_counts, ukeys, chosen_id_name_hash ) {
	
	//console.log(ukeys);  // uname:
	//console.log(chosen_id_name_hash);
	for (var n in chosen_id_name_hash.names) {   // correct order
	    //console.log(dataset_ids[did])
	    biome_matrix.columns.push({ id: chosen_id_name_hash.names[n], metadata: {} });
	}
	// ukeys is sorted by alpha
	for(uk in ukeys) {
		
		biome_matrix.rows.push({ id: ukeys[uk], metadata: {} });
		
		biome_matrix.data.push(unit_name_counts[ukeys[uk]]);
	}

	biome_matrix.shape = [biome_matrix.rows.length, biome_matrix.columns.length];
	
	var max_count = {};
  for(n in biome_matrix.columns) {
  	console.log(biome_matrix.columns[n].id);
  	max_count[biome_matrix.columns[n].id] = 0;
  	for(d in biome_matrix.data) {
  		max_count[biome_matrix.columns[n].id] += biome_matrix.data[d][n];
  	}
  }
  var max = 0;
  for(n in chosen_id_name_hash.names) { 		// correct order
  	biome_matrix.column_totals.push(max_count[chosen_id_name_hash.names[n]]);
  	if(max_count[chosen_id_name_hash.names[n]] &gt; max){
  		max = max_count[chosen_id_name_hash.names[n]];
  	}
  }
  biome_matrix.max_dataset_count = max;
  console.log(max_count);
	return(biome_matrix);
}
//
//  CREATE UNIT ID LOOKUP
//
// function create_unit_id_lookup( uid, counts, unit_id_lookup ) {
	 	
// 	 	if(uid in unit_id_lookup) {
//       for (var c in counts) {
//         unit_id_lookup[uid][c] += counts[c]
//       }
//     }else{
//       unit_id_lookup[uid] = []
//       for (var c in counts) {
//         unit_id_lookup[uid].push(counts[c])
//       }
//     }
//     return unit_id_lookup
// }
//
//  CREATE UNIT NAME LOOKUP
//
function create_unit_name_lookup( did, name, counts, unit_name_lookup ) {
 	
 	if(name in unit_name_lookup) {
    for (var c in counts) {
      unit_name_lookup[name][c] += counts[c];
    }
  }else{
    unit_name_lookup[name] = [];
    for (var c in counts) {
      unit_name_lookup[name].push(counts[c]);
    }
  }
  return unit_name_lookup;

}
//
//
//
//function create_json_id_matrix(mtx) {
//	return JSON.stringify(mtx)+&quot;\n&quot;;
//}
//
//  CREATE CSV ID MATRIX
//
// function create_csv_id_matrix( unit_ids, dataset_ids ) {
// 		//
// 		// CSV3
// 		//
// 	  var csv = &#039;DatasetId&#039;;   // for D3.js stackbars
// 		for(var uid in unit_ids) {
// 			csv += &#039;,&#039;+uid;
// 		}
// 		csv += &quot;\n&quot;;
// 		for (var did in dataset_ids) {  // in correct order
			
// 	    csv += dataset_ids[did];
// 	    for(var uid in unit_ids){  // 
// 	    	csv += &#039;,&#039;+ unit_ids[uid][did]
// 	    }
// 	    csv += &quot;\n&quot;;
// 		}
// 		return csv;
// }
//
// CREATE TEXT MATRIX
//
function create_text_matrix( unit_names, dataset_names, dataset_ids, matrix_with_names) {

		// 
		// MTX  for input to R scripts
		//
		var mtx = &#039;&#039;;
	  for (var did in dataset_ids) {
	    console.log(dataset_ids[did]);
	    var index = dataset_names.ids.indexOf( dataset_ids[did] );
	    mtx += &quot;\t&quot; + dataset_names.names[ index ];
	    matrix_with_names.dataset_names.push(dataset_names.names[ index ]);
	  }
	  mtx += &quot;\n&quot;;
	  
	  matrix_with_names.unit_names = unit_names;
	  
	  for(var uname in unit_names) {
	    mtx += uname;
	    for (var c in unit_names[uname]) {
	      mtx += &quot;\t&quot; + unit_names[uname][c].toString();
	    }
	    mtx += &quot;\n&quot;;
	  }
	  return mtx;
}
//
//  A S S E M B L E  T A X A
//
function assemble_taxa(depth, dict, row) {
				var tax,domain,phylum,klass,order,family,genus,species,strain;
				var d_id = row.domain_id+&quot;_domain&quot;;		      	      
	      if(d_id in dict){
	      	domain = dict[d_id][&quot;taxon&quot;];
	      }else{
	      	domain = &#039;unknown&#039;;
	      }
	      tax = domain;
				if(depth === &#039;phylum&#039;) {
		      var p_id = row.phylum_id+&quot;_phylum&quot;;		
		      if(p_id in dict){
		      	phylum = dict[p_id][&quot;taxon&quot;];
		      }else{
		      	phylum = &#039;phylum_NA&#039;;
		      }
		      //console.log(domain+&#039;;&#039;+phylum)
		      tax = domain+&#039;;&#039;+phylum;
		    }else if(depth === &#039;class&#039;) {
		    	var p_id = row.phylum_id+&quot;_phylum&quot;;	
		    	var k_id = row.klass_id+&quot;_klass&quot;;	
		      if(p_id in dict){
		      	phylum = dict[p_id][&quot;taxon&quot;];
		      }else{
		      	phylum = &#039;phylum_NA&#039;;
		      }
		      if(k_id in dict){
		      	klass = dict[k_id][&quot;taxon&quot;];
		      }else{
		      	klass = &#039;class_NA&#039;;
		      }
		      //console.log(domain+&#039;;&#039;+phylum+&#039;;&#039;+klass)
		      tax = domain+&#039;;&#039;+phylum+&#039;;&#039;+klass;
		    }else if(depth === &#039;order&#039;) {
		    	var p_id = row.phylum_id+&quot;_phylum&quot;;	
		    	var k_id = row.klass_id+&quot;_klass&quot;;	
		    	var o_id = row.order_id+&quot;_order&quot;;	
		    	
		      if(p_id in dict){
		      	phylum = dict[p_id][&quot;taxon&quot;];
		      }else{
		      	phylum = &#039;phylum_NA&#039;;
		      }
		      if(k_id in dict){
		      	klass = dict[k_id][&quot;taxon&quot;];
		      }else{
		      	klass = &#039;class_NA&#039;;
		      }
		      if(o_id in dict){
		      	order = dict[o_id][&quot;taxon&quot;];
		      }else{
		      	order = &#039;order_NA&#039;;
		      }
		      //console.log(domain+&#039;;&#039;+phylum+&#039;;&#039;+klass+&#039;;&#039;+order);
		      tax = domain+&#039;;&#039;+phylum+&#039;;&#039;+klass+&#039;;&#039;+order;
		    }else if(depth === &#039;family&#039;) {
		    	var p_id = row.phylum_id+&quot;_phylum&quot;;	
		    	var k_id = row.klass_id+&quot;_klass&quot;;	
		    	var o_id = row.order_id+&quot;_order&quot;;	
		    	var f_id = row.family_id+&quot;_family&quot;;
		    	
		      if(p_id in dict){
		      	phylum = dict[p_id][&quot;taxon&quot;];
		      }else{
		      	phylum = &#039;phylum_NA&#039;;
		      }
		      if(k_id in dict){
		      	klass = dict[k_id][&quot;taxon&quot;];
		      }else{
		      	klass = &#039;class_NA&#039;;
		      }
		      if(o_id in dict){
		      	order = dict[o_id][&quot;taxon&quot;];
		      }else{
		      	order = &#039;order_NA&#039;;
		      }
		      if(f_id in dict){
		      	family = dict[f_id][&quot;taxon&quot;];
		      }else{
		      	family = &#039;family_NA&#039;;
		      }
		      //console.log(domain+&#039;;&#039;+phylum+&#039;;&#039;+klass+&#039;;&#039;+order+&#039;;&#039;+family);
		      tax = domain+&#039;;&#039;+phylum+&#039;;&#039;+klass+&#039;;&#039;+order+&#039;;&#039;+family;
		    }else if(depth === &#039;genus&#039;) {
		    	var p_id = row.phylum_id+&quot;_phylum&quot;;	
		    	var k_id = row.klass_id+&quot;_klass&quot;;	
		    	var o_id = row.order_id+&quot;_order&quot;;	
		    	var f_id = row.family_id+&quot;_family&quot;;
		    	var g_id = row.genus_id+&quot;_genus&quot;;
		    	
		      if(p_id in dict){
		      	phylum = dict[p_id][&quot;taxon&quot;];
		      }else{
		      	phylum = &#039;phylum_NA&#039;;
		      }
		      if(k_id in dict){
		      	klass = dict[k_id][&quot;taxon&quot;];
		      }else{
		      	klass = &#039;class_NA&#039;;
		      }
		      if(o_id in dict){
		      	order = dict[o_id][&quot;taxon&quot;];
		      }else{
		      	order = &#039;order_NA&#039;;
		      }
		      if(f_id in dict){
		      	family = dict[f_id][&quot;taxon&quot;];
		      }else{
		      	family = &#039;family_NA&#039;;
		      }
		      if(g_id in dict){
		      	genus = dict[g_id][&quot;taxon&quot;];
		      }else{
		      	genus = &#039;genus_NA&#039;;
		      }
		      //console.log(domain+&#039;;&#039;+phylum+&#039;;&#039;+klass+&#039;;&#039;+order+&#039;;&#039;+family+&#039;;&#039;+genus);
		      tax = domain+&#039;;&#039;+phylum+&#039;;&#039;+klass+&#039;;&#039;+order+&#039;;&#039;+family+&#039;;&#039;+genus;
		    }else if(depth === &#039;species&#039;) {
		    	var p_id = row.phylum_id+&quot;_phylum&quot;;	
		    	var k_id = row.klass_id+&quot;_klass&quot;;	
		    	var o_id = row.order_id+&quot;_order&quot;;	
		    	var f_id = row.family_id+&quot;_family&quot;;
		    	var g_id = row.genus_id+&quot;_genus&quot;;
		    	var s_id = row.species_id+&quot;_species&quot;;
		      if(p_id in dict){
		      	phylum = dict[p_id][&quot;taxon&quot;];
		      }else{
		      	phylum = &#039;phylum_NA&#039;;
		      }
		      if(k_id in dict){
		      	klass = dict[k_id][&quot;taxon&quot;];
		      }else{
		      	klass = &#039;class_NA&#039;;
		      }
		      if(o_id in dict){
		      	order = dict[o_id][&quot;taxon&quot;];
		      }else{
		      	order = &#039;order_NA&#039;;
		      }
		      if(f_id in dict){
		      	family = dict[f_id][&quot;taxon&quot;];
		      }else{
		      	family = &#039;family_NA&#039;;
		      }
		      if(g_id in dict){
		      	genus = dict[g_id][&quot;taxon&quot;];
		      }else{
		      	genus = &#039;genus_NA&#039;;
		      }
		      if(s_id in dict){
		      	species = dict[s_id][&quot;taxon&quot;];
		      }else{
		      	species = &#039;species_NA&#039;;
		      }
		      //console.log(domain+&#039;;&#039;+phylum+&#039;;&#039;+klass+&#039;;&#039;+order+&#039;;&#039;+family+&#039;;&#039;+genus+&#039;;&#039;+species);
		      tax = domain+&#039;;&#039;+phylum+&#039;;&#039;+klass+&#039;;&#039;+order+&#039;;&#039;+family+&#039;;&#039;+genus+&#039;;&#039;+species;
		    }else if(depth === &#039;strain&#039;) {
		    	var p_id = row.phylum_id+&quot;_phylum&quot;;	
		    	var k_id = row.klass_id+&quot;_klass&quot;;	
		    	var o_id = row.order_id+&quot;_order&quot;;	
		    	var f_id = row.family_id+&quot;_family&quot;;
		    	var g_id = row.genus_id+&quot;_genus&quot;;
		    	var s_id = row.species_id+&quot;_species&quot;;
		    	var st_id = row.strain_id+&quot;_strain&quot;;
		      if(p_id in dict){
		      	phylum = dict[p_id][&quot;taxon&quot;];
		      }else{
		      	phylum = &#039;phylum_NA&#039;;
		      }
		      if(k_id in dict){
		      	klass = dict[k_id][&quot;taxon&quot;];
		      }else{
		      	klass = &#039;class_NA&#039;;
		      }
		      if(o_id in dict){
		      	order = dict[o_id][&quot;taxon&quot;];
		      }else{
		      	order = &#039;order_NA&#039;;
		      }
		      if(f_id in dict){
		      	family = dict[f_id][&quot;taxon&quot;];
		      }else{
		      	family = &#039;family_NA&#039;;
		      }
		      if(g_id in dict){
		      	genus = dict[g_id][&quot;taxon&quot;];
		      }else{
		      	genus = &#039;genus_NA&#039;;
		      }
		      if(s_id in dict){
		      	species = dict[s_id][&quot;taxon&quot;];
		      }else{
		      	species = &#039;species_NA&#039;;
		      }
		      if(st_id in dict){
		      	strain = dict[st_id][&quot;taxon&quot;];
		      }else{
		      	strain = &#039;strain_NA&#039;;
		      }
		      //console.log(domain+&#039;;&#039;+phylum+&#039;;&#039;+klass+&#039;;&#039;+order+&#039;;&#039;+family+&#039;;&#039;+genus+&#039;;&#039;+species+&#039;;&#039;+strain);
		      tax = domain+&#039;;&#039;+phylum+&#039;;&#039;+klass+&#039;;&#039;+order+&#039;;&#039;+family+&#039;;&#039;+genus+&#039;;&#039;+species+&#039;;&#039;+strain;
		    }

		    return tax;

}
// function create_csv_text_matrix( unit_names, dataset_names, dataset_ids ) {
// 		//
// 	  // CSV2
// 	  //		  
// 	  var csv = &#039;DatasetName&#039;;   // for D3.js stackbars
// 	  for(var uname in unit_names) {
// 			csv += &#039;,&#039;+uname;
// 		}
// 		csv += &quot;\n&quot;;
// 		for (var did in dataset_ids) {  // in correct order
// 			var index = dataset_names.ids.indexOf( dataset_ids[did] );
// 	    csv += dataset_names.names[ index ];
// 	    for(var uname in unit_names){  // 
// 	    	csv += &#039;,&#039;+ unit_names[uname][did]
// 	    }
// 	    csv += &quot;\n&quot;;
// 		}
// 		return csv;
// }</textarea>
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p>.</p>
  </div>
</footer>

<script type="text/html" id="complexity-popover-template">
  <div class="complexity-notice">
    Complexity : {{ complexity.cyclomatic }} <br>
    Length : {{ complexity.halstead.length }} <br>
    Difficulty : {{ complexity.halstead.difficulty.toFixed(2) }} <br>
    Est # bugs : {{ complexity.halstead.bugs.toFixed(2) }}<br>
  </div>
</script>

<script type="text/javascript" src="../../assets/scripts/bundles/core-bundle.js"></script>
<script type="text/javascript" src="../../assets/scripts/bundles/codemirror.js"></script>
<script type="text/javascript" src="../../assets/scripts/codemirror.markpopovertext.js"></script>
<script type="text/javascript" src="report.js"></script>
<script type="text/javascript" src="report.history.js"></script>
<script type="text/javascript" src="../../assets/scripts/plato-file.js"></script>
</body>
</html>
