<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Plato - routes/visuals/routes_pcoa.js</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link href="../../assets/css/vendor/morris.css" rel="stylesheet">
  <link href="../../assets/css/vendor/bootstrap.css" rel="stylesheet">
  <link href="../../assets/css/vendor/font-awesome.css" rel="stylesheet">
  <link href="../../assets/css/vendor/codemirror.css" rel="stylesheet">
  <link href="../../assets/css/plato.css" rel="stylesheet">
  <link href="../../assets/css/plato-file.css" rel="stylesheet">

</head>

<body>

<div class="navbar navbar-fixed-top">
  <div class="container">
    <a class="navbar-brand" href="http://github.com/es-analysis/plato">Plato on Github</a>
    <ul class="nav navbar-nav">
      <li>
        <a href="../../index.html">Report Home</a>
      </li>
    </ul>
  </div>
</div>

<div class="jumbotron">
  <div class="container">
    <h1>routes/visuals/routes_pcoa.js</h1>
  </div>
</div>

<div class="container aggregate-stats">
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Maintainability <a href="http://blogs.msdn.com/b/codeanalysis/archive/2007/11/20/maintainability-index-range-and-meaning.aspx"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="A value between 0 and 100 that represents the relative ease of maintaining the code. A high value means better maintainability." data-original-title="Maintainability Index"  data-container="body"></i></a></h2>
      <p class="stat">53.08</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Lines of code <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h2>
      <p class="stat">278</p>
    </div>
  </div>
  <div class="row historical">
    <div class="col-md-6">
      <p id="chart_historical_maint" class="chart"></p>
    </div>
    <div class="col-md-6">
      <p id="chart_historical_sloc" class="chart"></p>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Difficulty  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="The difficulty measure is related to the difficulty of the program to write or understand." data-original-title="Difficulty" data-container="body"></i></a></h2>
      <p class="stat">36.11</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Estimated Errors  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Halstead's delivered bugs is an estimate for the number of errors in the implementation." data-original-title="Delivered Bugs" data-container="body"></i></a></h2>
      <p class="stat">2.61</p>
    </div>
  </div>
</div>

<div class="container charts">
  <div class="row">
    <h2 class="header">Function weight</h2>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h3 class="chart-header">By Complexity <a href="http://en.wikipedia.org/wiki/Cyclomatic_complexity"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="This metric counts the number of distinct paths through a block of code. Lower values are better." data-original-title="Cyclomatic Complexity" data-container="body"></i></a></h3>
      <div id="fn-by-complexity" class="stat"></div>
    </div>
    <div class="col-md-6">
      <h3 class="chart-header">By SLOC  <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h3>
      <div id="fn-by-sloc" class="stat"></div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <textarea id="file-source" class="col-md-12">var path = require(&#039;path&#039;);
var fs = require(&#039;fs&#039;);
var d3 = require(&quot;d3&quot;);
var xmldom = require(&#039;xmldom&#039;);
var COMMON  = require(&#039;./routes_common&#039;);

// # 	for line in csv.reader(tsv, dialect=&quot;excel-tab&quot;):
// 	# 		print line
// 	# 		if line_count == 0:
// 	# 			names = line[1:]				
// 	# 			for i in names:
// 	# 				metadata[i] = {}
// 	# 		else:
// 	# 			ds = line[0]
// 	# 			for i,item in enumerate(line):					
// 	# 				if i&gt;0:
// 	# 					if item in metadata[names[i-1]]:
// 	# 						metadata[names[i-1]][item].append(ds)
// 	# 					else:
// 	# 						metadata[names[i-1]][item] =[ds]
						
// # {&#039;density&#039;: {&#039;novalue&#039;: [ds1,ds2,ds3], &#039;1026.45&#039;:[ds4,ds5] },
// #  &#039;envo_material&#039;: {&#039;ocean water&#039;:[ds1,ds2,ds3,ds4,ds5,ds12,ds13], &#039;lake water&#039;: [ds6,ds7,ds8,ds9,ds11]}
// #  }

module.exports = {


		create_pcoa_graphs: function(matrix) {
			console.log(&#039;in pcoa&#039;)
			//console.log(matrix)
			
			//console.log(metadata_filename)
			var svgGraph =&#039;&#039;;
			//console.log(metadata)
			//fs.readFile(metadata_filename, &#039;utf8&#039;, function (err, data) {
  		//		 var mdata = d3.tsv.parse(data);
  		//		 console.log(mdata)
  				var mdata_name_value_lookup = {};
  				var mdata_name_ds_lookup = {};
  				for(m in metadata) {
  					var ds = metadata[m][&#039;project_dataset&#039;];
  					for(name in metadata[m]) {
  						if(name !== &#039;project_dataset&#039;) {
  							//console.log(metadata[m][item]);
  							var value = metadata[m][name];
								//console.log(name)  
								// mdata_name_value_lookup							
  							if(name in mdata_name_value_lookup) {
  								if(value in mdata_name_value_lookup[name]){
  									mdata_name_value_lookup[name][value].push(ds);
  								}else {
  									mdata_name_value_lookup[name][value] = [ds];
  								}
  							}else {
  								mdata_name_value_lookup[name] = {};
  								mdata_name_value_lookup[name][value] = [ds];
  							}
  							// mdata_vals is for the tool tip
  							if(name in mdata_name_ds_lookup) {
  								mdata_name_ds_lookup[name][ds] = value;  								
  							}else {  	  								
  								mdata_name_ds_lookup[name] = {};
  								mdata_name_ds_lookup[name][ds] = value;
  							}
  						
  						}
  					}
  				}
  				//console.log(mdata_vals);
  				var p=d3.scale.category20();
					var colors = p.range(); // [&quot;#1f77b4&quot;, &quot;#ff7f0e&quot;, &quot;#2ca02c&quot;, &quot;#d62728&quot;, &quot;#9467bd&quot;,
                      // &quot;#8c564b&quot;, &quot;#e377c2&quot;, &quot;#7f7f7f&quot;, &quot;#bcbd22&quot;, &quot;#17becf&quot;]
  				var mdata_colors = {};
  				mdata_colors_by_val = {};
  				//mdata_colors[name][&#039;HMP_204_Bv4v5--204_10_GG_26Jan12_H&#039;] = &#039;#ababab&#039;;
  				for(mname in mdata_name_value_lookup) {
  					mdata_colors[mname] = {};
  					mdata_colors_by_val[mname] = {};
  					c =0
  					for(val in mdata_name_value_lookup[mname]){
  						
  						for(d in mdata_name_value_lookup[mname][val]){
  							ds = mdata_name_value_lookup[mname][val][d];
  							mdata_colors[mname][ds] = colors[c];
  							mdata_colors_by_val[mname][val] = colors[c];
  						
  						}
  						// if(mname in mdata_colors_by_val) {
  							
  						// 		mdata_colors_by_val[mname][val] = colors[c];
  							
  							
  						// }else {
  						// 	mdata_colors_by_val[mname]={};
  							
  						// }
  						c += 1;
  					}
  				}
  				//console.log(metadata)
  				//console.log(mdata_name_value_lookup)
					//console.log(mdata_colors_by_val);
					var metadata_count = Object.keys(mdata_name_value_lookup).length;
					// size and margins for the chart
					var margin = {top: 20, right: 25, bottom: 50, left: 60};
					var img_width = 1100;
					var img_height = 320 * metadata_count;
					var base_chart_size = 300;
					var chart_width  = base_chart_size - margin.left - margin.right;
					var chart_height = base_chart_size - margin.top  - margin.bottom;
					// add the tooltip area to the webpage
					
					var x = d3.scale.linear()
		          .domain([-1, 1])  					// the range of the values to plot
		          .range([ 0, chart_width ]);        // the pixel range of the x-axis

					var y = d3.scale.linear()
		          .domain([-1, 1])
		          .range([ chart_height, 0 ]);

		      //var vectors = [&#039;v1&#039;,&#039;v2&#039;,&#039;v3&#039;];
		      var vectors = [ [&#039;v1&#039;,&#039;v2&#039;], [&#039;v1&#039;,&#039;v3&#039;], [&#039;v2&#039;,&#039;v3&#039;] ];
		      var svgContainer = d3.select(&quot;body&quot;)
		      				.append(&quot;svg&quot;)
		              .attr(&#039;width&#039;, img_width)
									.attr(&#039;height&#039;, img_height);


					var md_count = 0;			
					for(m in mdata_name_value_lookup)	{	 
						var mdata_name = m;
						//var colors_needed = Object.keys(mdata[m]).length;
						
						//var mdata_colors = default_colors.slice(0,colors_needed);
						//console.log(mdata_colors)

						for(v in vectors) {
			      		
			      		xdata = matrix[vectors[v][0]];
								ydata = matrix[vectors[v][1]];
								//var chart = &#039;chart&#039;+v.toString();
								var chart_tx = base_chart_size;
						    var chart_ty = base_chart_size; 
									// the main object where the chart and axis will be drawn
								var chart = svgContainer.append(&#039;g&#039;)
									.attr(&#039;transform&#039;, &#039;translate(&#039; + (margin.left + (v * chart_tx)) + &#039;,&#039; + (margin.top + (md_count * chart_ty)) + &#039;)&#039;)
									.attr(&#039;width&#039;, chart_width)
									.attr(&#039;height&#039;, chart_height)
									.attr(&#039;class&#039;, &#039;main&#039;)   

									// draw the x axis
								var xAxis = d3.svg.axis()
									.scale(x)
									.orient(&#039;bottom&#039;).ticks(5);

								chart.append(&#039;g&#039;)
									.attr(&#039;transform&#039;, &#039;translate(0,&#039; + chart_height + &#039;)&#039;)
									.attr(&#039;class&#039;, &#039;main axis date&#039;)
									.call(xAxis);

									// draw the y axis
								var yAxis = d3.svg.axis()
									.scale(y)
									.orient(&#039;left&#039;).ticks(5);

								chart.append(&#039;g&#039;)
									.attr(&#039;transform&#039;, &#039;translate(0,0)&#039;)
									.attr(&#039;class&#039;, &#039;main axis date&#039;)
									.call(yAxis);

									// draw the graph object
									var g = chart.append(&quot;g&quot;); 

									g.selectAll(&quot;scatter-dots&quot;)
									  .data(ydata)  // using the values in the ydata array
									  .enter().append(&quot;circle&quot;)  // create a new circle for each value
									      .attr(&quot;cy&quot;, function (d) { return y(d); } ) // translate y value to a pixel
									      .attr(&quot;cx&quot;, function (d,i) { return x(xdata[i]); } ) // translate x value
									      .attr(&quot;r&quot;, 4) // radius of circle
									      //.style(&quot;opacity&quot;, 0.6) // opacity of circle
									      .attr(&quot;id&quot;,function(d,i) {
									      		var ret_str = matrix.names[i]+&#039;-|-&#039;+mdata_name+&#039;-|-&#039;+mdata_name_ds_lookup[mdata_name][matrix.names[i]];
									      		return ret_str;    // ip of each dot should be ds -|- metadataname -|- metadatavalue									       	
												}) 
											  .attr(&quot;class&quot;,&quot;tooltip&quot;)
									      .style(&quot;fill&quot;, function(d,i){
									      	ds = matrix.names[i];
									      	return mdata_colors[mdata_name][ds]
									      });
									      

									

									g.append(&#039;text&#039;)
										.attr(&#039;class&#039;, &#039;x label&#039;)
										.attr(&#039;text-anchor&#039;,&#039;end&#039;)
										.attr(&quot;x&quot;, chart_width / 2)
			    					.attr(&quot;y&quot;, chart_height + 30)
			    					.text(vectors[v][0]);      

			    				g.append(&quot;text&quot;)
			    					.attr(&#039;class&#039;, &#039;y label&#039;)
								    .attr(&quot;transform&quot;, &quot;rotate(-90)&quot;)
								    .attr(&quot;y&quot;, 0 - margin.left)
								    .attr(&quot;x&quot;,0 - (chart_height / 2))
								    .attr(&quot;dy&quot;, &quot;1em&quot;)
								    .style(&quot;text-anchor&quot;, &quot;middle&quot;)
								    .text(vectors[v][1]);
								  
								  if(v == 1){
								  	g.append(&#039;text&#039;)					
											.attr(&#039;text-anchor&#039;,&#039;middle&#039;)
											.attr(&quot;x&quot;, chart_width / 2)
				    					.attr(&quot;y&quot;, 0 )
				    					.style(&quot;font-size&quot;, &quot;12px&quot;) 
	        						.style(&quot;text-decoration&quot;, &quot;underline&quot;)  
				    					.text(&#039;metadata name: &#039;+mdata_name);     
								  }

								  if(v == 2) {
								  	// add legend to right hand graph
										var legend = g.append(&quot;g&quot;)
										  .attr(&quot;class&quot;, &quot;legend&quot;)
										  .attr(&quot;x&quot;, chart_width - 5)
										  .attr(&quot;y&quot;, 15)
										  .attr(&quot;height&quot;, chart_height)
										  .attr(&quot;width&quot;, 100);
										  // mdata_name
										legend.selectAll(&#039;g&#039;).data( Object.keys(mdata_name_value_lookup[mdata_name]) )
									      .enter()
									      .append(&#039;g&#039;)
									      .each(function(d, i) {
									        var g = d3.select(this);
									        g.append(&quot;rect&quot;)
									          .attr(&quot;x&quot;, chart_width)
									          .attr(&quot;y&quot;, i*15)
									          .attr(&quot;width&quot;, 7)
									          .attr(&quot;height&quot;, 7)
									          .style(&quot;fill&quot;, mdata_colors_by_val[mdata_name][d]);
									        
									        g.append(&quot;text&quot;)
									          .attr(&quot;x&quot;, chart_width + 10)
									          .attr(&quot;y&quot;, i * 15 + 8)
									          .attr(&quot;height&quot;,30)
									          .attr(&quot;width&quot;,100)
									          .style(&quot;fill&quot;, mdata_colors_by_val[mdata_name][d])
									          .text(d);

									      });
								  }

								  
									
						}	
					md_count += 1;
					}						


					d3.selectAll(&#039;.axis line, .axis path&#039;)
     				.style({&#039;stroke&#039;: &#039;Black&#039;, &#039;fill&#039;: &#039;none&#039;, &#039;stroke-width&#039;: &#039;1px&#039;});

					
					svgGraph = d3.selectAll(&#039;svg&#039;).attr(&#039;xmlns&#039;, &#039;http://www.w3.org/2000/svg&#039;);
					
						
					//console.log(svgGraph[0][0]);
					
					var svgXML = (new xmldom.XMLSerializer()).serializeToString( svgGraph[0][0] );
					//console.log(svgXML);
					//var html = &quot;&lt;div id=&#039;&#039; class=&#039;chart_div center_table&#039;&gt;&quot;+svgXML+&quot;&lt;/div&gt;&quot;;
					var html = &quot;&lt;div id=&#039;&#039; class=&#039;pcoa_chart_div center_table&#039;&gt;&quot;+svgXML+&quot;&lt;/div&gt;&quot;;
					d3.select(&#039;svg&#039;).remove();
					return html;
			//})
		}

}</textarea>
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p>.</p>
  </div>
</footer>

<script type="text/html" id="complexity-popover-template">
  <div class="complexity-notice">
    Complexity : {{ complexity.cyclomatic }} <br>
    Length : {{ complexity.halstead.length }} <br>
    Difficulty : {{ complexity.halstead.difficulty.toFixed(2) }} <br>
    Est # bugs : {{ complexity.halstead.bugs.toFixed(2) }}<br>
  </div>
</script>

<script type="text/javascript" src="../../assets/scripts/bundles/core-bundle.js"></script>
<script type="text/javascript" src="../../assets/scripts/bundles/codemirror.js"></script>
<script type="text/javascript" src="../../assets/scripts/codemirror.markpopovertext.js"></script>
<script type="text/javascript" src="report.js"></script>
<script type="text/javascript" src="report.history.js"></script>
<script type="text/javascript" src="../../assets/scripts/plato-file.js"></script>
</body>
</html>
