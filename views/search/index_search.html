<% include ../add_ins/begin-no_menu.ejs %>

<% var metaitems = JSON.parse(metadata_items); %>

<% // sort keys %>


<script>  
  var mi_local  = JSON.parse('<%- metadata_items %>');
</script>
<p class='title'>Search</p>
<% if (message) { %>
	<div class="alert_flash_message"><%= message %></div>
<% } %>
 
 
 Search Options:
<ul>
 <li><a href="#metadata">Metadata</a></li>
 <li><a href="#taxonomy">Taxonomy</a></li>
 <li><a href="#names">Names</a> (key word search)</li>
 <li><a href="#project">Project Search</a></li>
 <li><a href="#blast">Blast</a></li>
</ul>

<a name="metadata"></a>
<div id='metadata_search_div' class='well'>
	<form id='metadata_search_form' name='' method='POST' action='/search/metadata_search_result' >	
			<div id='' class='pull-right' >Join searches by: 
					<input type='radio' name='join_type' value='intersection' checked='checked' /> Intersection
					&nbsp;&nbsp;
					<input type='radio' name='join_type' value='addition' /> Addition
			</div>
		<br>
		<strong>Metadata -- Search all datasets</strong> (limited by permissions)
		<br>
		Select Field(s) to Search:<br>
		<ol>	
			
			<li>&nbsp;&nbsp;&nbsp;
				 <table><tr>
					<td>
					<select id='field1_metadata_search'  data-style="btn-primary" name='search1_metadata-item'>
						<option value='NONE'>select</option>						
						<% for (i = 0; i < mkeys.length; i++) { %>	
							<option class='' value='<%= mkeys[i] %>'><%= mkeys[i] %></option>
						<% } %> 
					</select>
				    </td>
					<!--
					<td>
					<input type='text'  onkeyup="showMetadataHint(this.value)">
				    </td><td><span id="txtHint"></span>
					</td>
					-->
			    </tr>
			</table>
				
								
			   <div id='metadata_search_range_div1' class='display_none'></div>
					
			</li>
			<br>	
			<li>		
					<input id='search_metadata_activate_btn2' type='checkbox' value='activate' >
					<select id='field2_metadata_search' class="selectpicker" data-style="btn-primary" name='search2_metadata-item' disabled='disabled' >
						<option value='NONE'>select</option>
						<% for (i = 0; i < mkeys.length; i++) { %>	
							<option class='' value='<%= mkeys[i] %>'><%= mkeys[i] %></option>
						<% } %>
					</select> 
					<div id='metadata_search_range_div2' class='display_none'></div>
					
			</li>	
			<br>
			<li>		
					<input id='search_metadata_activate_btn3' type='checkbox' value='activate' >
					<select id='field3_metadata_search' class="selectpicker" data-style="btn-primary" name='search3_metadata-item' disabled='disabled' >
						<option value='NONE'>select</option>
						<% for (i = 0; i < mkeys.length; i++) { %>	
							<option class='' value='<%= mkeys[i] %>'><%= mkeys[i] %></option>
						<% } %>
					</select>	
					<div id='metadata_search_range_div3' class='display_none'></div>
					
			</li>	
		</ol>
					<br>
				<!--	<input id='search_metadata_btn' class='display_none' type='submit' value='Search Datasets' > -->
					<button id='search_metadata_btn' class='btn btn-default' disabled='disabled' type='button'>Search Datasets</button>
					<input name='search_function'  type='hidden' value='search_metadata_all_datasets' >
				
				<ul>
					<li>DONE: Save the datasets to be able to use them in the visualizations.
					<li>Search all datasets or select subset of datasets then search in subset?
				</ul>
			
	</form>
	<% if (meta_message) { %>
		<div class="alert_flash_message"><%= meta_message %></div>
	<% } %>	
</div>
<a name="taxonomy"></a>
<div id='taxonomy_search_div' class='well'>



		    <strong>Taxonomy</strong>
		    <ul>
		       <li>Enter a full or partial taxonomic name; Options: Select Datasets or Get Sequences
		    </ul>
	
		<div class="row">	
			<div class="dropdown col-md-1"></div>

			<div class="dropdown col-md-2">
			  Type: <input id="tax_search_id" class="" autocomplete="off" data-toggle="dropdown" type="text"  onkeyup="showResult(this.value)"/>
			  <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
			    <div id="livesearch" class=""></div>
			  </ul>		
			</div>
				
			<div class='col-md-7'>or Enter Taxon String: 
				<input type='text' id='livesearch_result_div' value='' name='tax_string' maxlength='150' size='100' onkeyup="showResult(this.value)" />
			</div>


			<div id='' class="col-md-2">
				<table class='button_row'>
				<tr>
		    <td>    	
		    	<form id='taxonomy_search_form_id' name='taxonomy_search_form_name' method='POST' action='/search/taxonomy_search_for_datasets' >	
				  		<button id='find_datasets_btn' class="btn btn-xs btn-primary" type="submit" disabled='disabled' >Find Datasets</button>
				  		<input type='hidden' id='find_datasets_hidden_id' name='tax_string' value=''>
				  		<input type='hidden' name='selection' value='custom_taxonomy'>
				  	</form>
		    </td>
		    <td>
		    	<form id='taxonomy_search_form_id' name='taxonomy_search_form_name' method='POST' action='/user_data/download_selected_seqs' >	
				  		<button id='create_fasta_btn'  class="btn btn-xs btn-primary" type="submit" disabled='disabled' >Create Fasta File</button>
				  		<input type='hidden' id='create_fasta_hidden_id' name='tax_string' value=''>
				  		<input type='hidden' name='download_type' value='custom_taxonomy'>
				  	</form>
		    </td>    
				</tr>
				<tr><td colspan='3'>
					<% if (tax_message) { %>
						<div class="alert_flash_message"><%- tax_message %></div>
					<% } %>
				</td></tr>
				</table>	  	
		  </div>
		</div>	
				
	
</div>

<a name="sequence"></a>
<div id='sequence_search_div' class='well'><strong>Sequences (This search needs to be run on cluster)</strong>
  <ul>
  	<li>This shouldn't be needed if the blast function works.
  </ul>
</div>
<a name="names"></a>
<div id='names_search_div' class='well'><strong>Names (key words)</strong>
	<ul>
	<li>project name, title, description
	<li>dataset name, dataset_description
	</ul>			
</div>
<a name="project"></a>
<div id='project_search_div' class='well'><strong>Project Search</strong>
	<ul>
	<li>search by owner, location(lat/lon), title(keyword)
	<li>
	</ul>			
</div>
<a name="blast"></a>
<div id='blast_search_div' class='well'><strong>Blast (This search needs to be run on cluster)</strong>
	<ul>
			<li>Must create and maintain VAMPS Blast Database.
	</ul>
</div>
<% include ../add_ins/end.ejs %>
<script type="text/javascript" src="/javascripts/global.js"></script>
<script type="text/javascript" src="/javascripts/search.js"></script>
</body>
</html>


