<% include ../add_ins/begin.ejs %>
<% var info = JSON.parse(proj_info) %>
<% var env_sources = JSON.parse(constants).ENV_SOURCE %>
<% var targets = JSON.parse(constants).TARGETS %>

<div class='title'>Export Data</div>

<div class='subtitle'>Dataset Selection Page</div>
<% if (message) { %>
	<div class="alert_flash_message"><%= message %></div>
<% } %>

    <!-- autocomplete="off" clears the checkboxes on page refresh -->
    <form id='dataset_select_form' class='' name='dataset_select_form' method='POST' action='export_selection' autocomplete="off">

      <table class='table table-bordered'>
        <tr>
          <td></td>
          <td>
              <button type="button" class="btn btn-xs btn-primary"  id="view_saved_datasets_btn">View Saved Datasets</button>
			  <h4>Select Datasets Below:</h4>
			  
			  
          </td>
          <td>            
      			<button type="button" class="btn btn-sm btn-warning pull-right" name='Next' id="unit_selection"> 
      			  next: File Format Selection <span class="glyphicon glyphicon-circle-arrow-right" aria-hidden="true"></span> 
      			</button>
            <h4>                
              <span class="label label-default">To save your list of selected datasets go to the next page.</span>  
            </h4>
          </td>
          </tr>
          <tr>
            <td style='width:100px;'>Filter Projects
              <!-- FILTER -->
              <div id='' class=''>
                <table id='filters_table' border='1' width=''>
                  <tr>
                    <td>by substring:<br>
                      <input id="tax_search_id" class="" autocomplete="off"  type="text"  onkeyup="showLiveProjectNames(this.value)"/>
                    </td>
                  </tr>
                  <tr>
                    <td>
                      by env source<br>
                      <select id='env_source_select' >
                        <option>.....</option>
                        <% for(n in env_sources) { %>
                          <option value='<%= n %>'>(<%= n %>) <%= env_sources[n] %></option>
                        <% } %>
                      </select>
                    </td>
                  </tr>
                  <tr>
                    <td>
                      by domain/target<br>
                      <select  id='target_select'>
                        <option>.....</option>
                        <% for(n in targets) { %>
                          <option value='<%= targets[n] %>'><%= targets[n] %></option>
                        <% } %>
                      </select>
                    </td>
                  </tr>
                  
                </table>
                <button id='clear_filters_btn_id' type='button' value='' class='btn btn-xs'>Clear Filters</button>
              </div>
            </td>



          
          <td>
            <div id='projects_select_div'>
				
			      </div>
          </td>
		      <td class='td_top'>			  
			  
              See the next page for a list of choices:
              <ul>
                <li>-- Download sequences (fasta)
                <li>-- TaxByTax, TaxByRef and TaxBySeq files (csv)
                <li>-- Metadata (csv)
              </ul>
		      </td>
        </tr>
      </table>
	  
       <input type='hidden' name='Next' value='Next: Export Selection' id="export_selection" >
    </form>
   

<% include ../add_ins/end.ejs %>
<script type="text/javascript" src="/javascripts/user_data.js"></script>
<script type="text/javascript" src="/javascripts/global.js"></script>
<script type="text/javascript" src="/javascripts/check_form_pg1.js"></script>
<script type="text/javascript" src="/javascripts/project_dataset_tree.js"></script>
<script>
    $(document).ready(function(){
      // this loads the project tree on first open
      clear_filters();       
    });
    // code for tooltips

    var $liveTip_pjds = $('<div id="livetip_pjds"></div>').hide().appendTo('body'),
        $win = $(window),
        showTip;
    
    var tip = {
      title: '',
      offset: 12,
      //delay: 300,
      position: function(event) {
        var positions = {x: event.pageX, y: event.pageY};
        var dimensions = {
          x: [
            $win.width(),
            $liveTip_pjds.outerWidth()
            
          ],
          y: [
            $win.scrollTop() + $win.height(),
            $liveTip_pjds.outerHeight()
            
          ]
        };
     
        for ( var axis in dimensions ) {
     
          if (dimensions[axis][0] <dimensions[axis][1] + positions[axis] + this.offset) {
            positions[axis] -= dimensions[axis][1] + this.offset;
          } else {
            positions[axis] += this.offset;
          }
     
        }
     
        $liveTip_pjds.css({
          top: positions.y,
          left: positions.x
        });
        
      }
    };


    $("body").delegate(".tooltip_pjds_list", "mouseover mouseout mousemove", function (event) {
          var link = this,
          html = '';
          $link = $(this);
         
          if (event.type == 'mouseover') {
            tip.id = link.id;
            link.id = '';
            id_items = tip.id.split('-|-');
            html = "<table><tr>";
            if(id_items[0] == 'project') {
              html += "<td>Name: "+id_items[1]+"</td>";
              html += "</tr><tr>";
              html += "<td>Title: "+id_items[2]+"</td>";  
              html += "</tr><tr>";
              html += "<td>Status: "+id_items[3]+"</td>";             
            }else if(id_items[0] == 'dataset'){
              html += "<td>Project: "+id_items[1]+"</td>";
              html += "</tr><tr>";
              html += "<td>Dataset: "+id_items[2]+"</td>";
              html += "</tr><tr>";
              html += "<td>Description: "+id_items[3]+"</td>";
            }
            html += "</tr><table>";

            showTip = setTimeout(function() {
         
              $link.data('tipActive', true);
              
              tip.position(event);
         //alert(event.pageX)
              $liveTip_pjds
              .html('<div>' + html  + '</div>')
              .fadeOut(0)
              .fadeIn(0);

         
            }, tip.delay);
          }
         
          if (event.type == 'mouseout') {
            link.id = tip.id || link.id;
            if ($link.data('tipActive')) {
              $link.removeData('tipActive');
              $liveTip_pjds.hide();
              
            } else {
              clearTimeout(showTip);
            }
          }
         
          if (event.type == 'mousemove' && $link.data('tipActive')) {
            tip.position(event);
          }
                  
     });              
</script>
 </body>
 </html>
