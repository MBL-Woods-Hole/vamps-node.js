<% include ../add_ins/begin-no_menu.ejs %>

<% var creation_times = modify_times %>
<% var project_info = JSON.parse(pinfo) %>
<% var env = JSON.parse(env_sources) %>

 <div class='title'>Projects (user: <%= user.username %>)</div>
 <div class='subtitle'></div>
<% if (failmessage) { %>
	<div class="alert_flash_message"><%= failmessage %></div>
<% } %>
<% if (successmessage) { %>
	<div class="alert_flash_message"><%= successmessage %></div>
<% } %>
<div class='left_justify'>
<br><strong>Your Projects:</strong> (most recent at the top)
<br>
<ol>
<% if(creation_times.length === 0) { %>
	<p>No Projects</p>
<% } else { %>

	<% for(t in creation_times){ %>
		<% var project = project_info[times[t]].config.GENERAL.project %>
		<% var number_of_datasets = project_info[times[t]].config.GENERAL.number_of_datasets %>
		<% var total_number_of_sequences = project_info[times[t]].config.GENERAL.project_sequence_count %>
		<% var public = project_info[times[t]].config.GENERAL.public %>
		<% var env_source_id = project_info[times[t]].config.GENERAL.env_source_id %>
		<% var env_source = env[env_source_id] %>
		
		<% var datasets = project_info[times[t]].config.DATASETS %>
		<% var status = project_info[times[t]].status %>
		<% var tax = project_info[times[t]].tax %>
	
		<div class='well'>			

    		<table class='table table-condensed'>
    			<tr>	
    				<td>Project name: <%= project %>  <small>( <%= number_of_datasets %> datasets )</small> </td>
    				<td></td>
    				
					<td>Status:
						<%if(project_info[times[t]].pid == 0){ %>
							<span class="label label-info"><%= status %></span>
						<% }else{ %>
							<span class="label label-primary"><%= status %></span>
						<% } %>
					</td>				
    				
					<td>
						<% if(project_info[times[t]].pid == 0) { %>
							<a href="edit_project/<%= project %>" class="pull-right">edit</a>
						<% }else{ %>
							
							(edit disabled)
						<% } %>
					</td>
    			</tr><tr>
    				<td>Total Number of Sequences: <%= total_number_of_sequences %></td>
    				<td>Public: <%= public %></td>
    				<td>Environmental Source: <%= env_source %></td>
    				<td>Taxonomy: <%= tax %></td>				
    			</tr>
    		</table>			
						
    		<div class="dropdown">
    		  <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-expanded="true">
    		    Selection
    		    <span class="caret"></span>
    		  </button>
    		  <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1">
    		    <li role="presentation"><a role="menuitem" tabindex="-1" href="user_project_info/<%= project %>">View Datasets and Counts</a></li>
	    	
    			<% if(tax == '0'){ %>
    				<li role="presentation"><a role="menuitem" tabindex="-1" href="start_assignment/<%= project %>/gast">Assign Taxonomy -GAST</a></li>
    				<li role="presentation"><a role="menuitem" tabindex="-1" href="start_assignment/<%= project %>/rdp">Assign Taxonomy -RDP</a></li>
    			<% }else{ %>
    				<li role="presentation"><a role="menuitem" tabindex="-1" href="#">Cluster</a></li>
        			<li role="presentation"><a role="menuitem" tabindex="-1" href="delete_project/<%= project %>/tax">Delete Taxonomy Only</a></li>
        			<li role="presentation"><a role="menuitem" tabindex="-1" href="delete_project/<%= project %>/meta">Delete Metadata Only</a></li>	
    			<% } %>
				<li role="presentation"><a role="menuitem" tabindex="-1" href="duplicate_project/<%= project %>	">Duplicate this Project</a></li>	
    	    	<li role="presentation" class="divider"></li>
    			<li role="presentation"><a role="menuitem" tabindex="-1" href="delete_project/<%= project %>/all">Delete this Project from Server</a></li>
			
    	  	  </ul>
    		</div>

		</div>  <!-- end well -->
	
	<% } %>  <!-- end for(t in creation_times) -->
<% } %>
</ol>
</div>


<script type="text/javascript" src="/javascripts/global.js"></script>

<% include ../add_ins/end.ejs %>
   
 </body>
 </html>