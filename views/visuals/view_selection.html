<% include ../add_ins/begin.ejs %>

<%   var thumbs = JSON.parse(constants).VISUAL_THUMBNAILS.visuals; %>
<%   var mtx = JSON.parse(matrix); %>
<%   var ts = timestamp; %>
<%   var disable_thumbs = false; %>

<div class='title'>Community Visualization</div>
<div class='subtitle'>Display Choices</div>
<% if(messages.info){ %>
  <span><%= messages.info %></span>
<% } %>
<div id='show_selected_datasets_div' class='div_border table'>
                <% include partials/show_selected_datasets.html %>
</div>
<table class='small_font'>
<tr>
  <td><a href='reorder_datasets'>Reorder Datasets</a></td>
<td>|</td> 
<td>
<a href="#" class="back">Select Other Units (Taxonomy) or Metadata</a></td>
<td>|</td> 
 <td>
<% if(mtx.data == '') { %>
  <% disable_thumbs = true %>
  <div id='' class='no_data'>
        <h3>No Sequences Found</h3>
  </div>
<% }else { %>
  <input id='download_fasta' type='button' value='Download Fasta File'>
<% } %>
  </td>
</tr>
</table>

<br>
      <table border='1'>
        <tr>
          <% for(n in thumbs) { %>
            <% var file = thumbs[n].file %>
            <% var name = thumbs[n].name %>
            <% var link = thumbs[n].link %>
            <% var img_w = 170 %>
            <% var cols = 3 %>
            <% if(mtx.shape[1] === 1  && (name === 'Distance Heatmap' || name === 'Dendrograms' )) { %>
              <td class='td_top'><%= name %><br><br>Not Available</td>
            <% } else { %>
              <% if(disable_thumbs) { %>
                  <td class='td_top'><%= name %><br>
                    <img src='<%= file %>' border='0' alt='<%= name %>' width='<%= img_w %>'>
                  </td>
              <% }else{ %>
                  <td class='td_top'><%= name %><br>
                    <a href='<%= link %>?ts=<%= ts %>' target='<%= ts %>_<%= name %>' >
                      <img src='<%= file %>' border='0' alt='<%= name %>' width='<%= img_w %>'>
                    </a> 
                  </td>
              <% } %>
              
            <% } %>
            
            <% if( n % cols === (cols - 1) ) { %>
              </tr><tr>
            <% } %>
          <% } %>
        </tr>
      </table>
      <a href="#" class="back">Go back</a> to the previous page.      
  <div id='DEBUG_div'></div>
  <script type="text/javascript" src="/javascripts/jquery-2.1.1.min.js"></script>
  <script type="text/javascript" src="/javascripts/global.js"></script>
<% include ../add_ins/end.ejs %>
