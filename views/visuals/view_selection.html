<% menu_section='VISUALS' %>
<% include ../add_ins/begin.ejs %>

<%  var cnsts  = JSON.parse(constants) %>
<%  var mtx    = JSON.parse(matrix); %>
<%  var pi     = JSON.parse(post_items); %>
<%  var md     = JSON.parse(metadata); %>
<%  var items  = JSON.parse(chosen_id_name_hash); %>
<%  var referer = 'view_selection'; %>
<%  console.log('items') %>
<%  console.log(items) %>
<%  //console.log(cnsts.VISUAL_THUMBNAILS.visuals)%>
<%  var activate_thumbs = true; %>
<script>
  var pi_local  = JSON.parse('<%- post_items %>');
  var mtx_local = JSON.parse('<%- matrix %>');
  var md_local  = JSON.parse('<%- metadata %>');
  var ds_local  = JSON.parse('<%- chosen_id_name_hash %>');
  var cts_local  = JSON.parse('<%- constants %>');
  var user_local  = '<%= user.username %>';
</script>


<div id='info_bar' class='navbar-fixed-top ' >
  <small>
    <div id='view_selection_links'>
      <ul>
        <li><form id='back_form_id' name='' method='POST' action='unit_selection'>
                  <a class='link_black' href='#' onclick="document.getElementById('back_form_id').submit();return false;">&lt;&lt;--back</a>
                  <input type='hidden' name='retain_data' value='1' >
                  <input type='hidden' name='dataset_ids' value='<%= JSON.stringify(items.ids) %>' >
            </form>
        </li>
        <li>
          <form class='' id='reload_form_id' name='reload_form' method='POST' action='view_selection'>
            <!-- <button class='btn btn-link' type='submit'>Reload Page</button> -->
            <a href='#' class='link_black' onclick="reload_view_form()">Reload Page</a>
            <input type='hidden' name='domains' value='<%= pi.domains %>'>
            <input type='hidden' name='tax_depth' value='<%= pi.tax_depth %>'>
            <input type='hidden' name='unit_choice' value='<%= pi.unit_choice %>'>
            <input type='hidden' name='selected_metadata' value='<%= pi.metadata %>'>
            <input type='hidden' name='include_nas' value='<%= pi.include_nas %>'>
            <input type='hidden' name='normalization' value='<%= pi.normalization %>'>
            <input type='hidden' name='selected_distance' value='<%= pi.selected_distance %>'>
            <input type='hidden' name='min_range' value='<%= pi.min_range %>'>
            <input type='hidden' name='max_range' value='<%= pi.max_range %>'>
            <input type='hidden' name='retain_data' value='1' >
            <input type='hidden' name='dataset_ids' value='<%= JSON.stringify(items.ids) %>' >
          </form>
        </li>
        
        <li><a href='#' id='save_config_id' style='' class='link_black'>Save Configuration</a></li>
        <li><span id='save_config_confirmation' ></span></li>
      </ul>
    </div>

    <div id='viz_info'>
    <% if(pi.custom_taxa.length == 1 && pi.custom_taxa[0] == 'NA'){ %>
        Taxonomic Depth: <%= pi.tax_depth %> --- 
        Included Domains: <%= pi.domains %>
    <% }else{ %>
        Taxonomic Depth: Custom
    <% } %>
    </div>
  </small>
</div>


<div class='title title_color'>Community Visualization</div>
<div class='subtitle'>Display Choices</div>
<!-- Need a form here for the back button to retain state -->
<!-- TODO add state for tax selection and metadata selection -->
<!-- 
<table class='button_row'>
<tr><td>  

<form id='back_form_id' name='' method='POST' action='unit_selection'>
			<a href='' onclick="document.getElementById('back_form_id').submit();return false;">&lt;&lt;--back</a>
			<input type='hidden' name='retain_data' value='1' >
			<input type='hidden' name='dataset_ids' value='<%= JSON.stringify(items.ids) %>' >
</form>
</td><td>
<form class='' id='reload_form_id' name='' method='POST' action='view_selection'>
  <button class='btn btn-xs btn-primary' type='submit'>Reload Page</button>
  <input type='hidden' name='domains' value='<%= pi.domains %>'>
  <input type='hidden' name='tax_depth' value='<%= pi.tax_depth %>'>
  <input type='hidden' name='unit_choice' value='<%= pi.unit_choice %>'>
  <input type='hidden' name='selected_metadata' value='<%= pi.metadata %>'>
  <input type='hidden' name='include_nas' value='<%= pi.include_nas %>'>
  <input type='hidden' name='normalization' value='<%= pi.normalization %>'>
  <input type='hidden' name='selected_distance' value='<%= pi.selected_distance %>'>
  <input type='hidden' name='min_range' value='<%= pi.min_range %>'>
  <input type='hidden' name='max_range' value='<%= pi.max_range %>'>
  <input type='hidden' name='retain_data' value='1' >
  <input type='hidden' name='dataset_ids' value='<%= JSON.stringify(items.ids) %>' >
</form>
</t></tr>
</table>
 -->
<% if(message){ %>
  <div class="alert_flash_message" ><%= message %></div>
<% } %>


<div class="container">
  <div class="row">
      <div  id='show_selected_datasets_div'  class="col-md-4">
        <div class='well'>
              <% include partials/show_selected_datasets.html %>
        </div> <!-- End  show_selected_datasets_div -->
      </div>
    
      <div id='show_selected_metadata_div'  class="col-md-4">
        <div class='well'>
              <% include partials/show_selected_metadata.html %>
        </div> <!-- End  show_selected_metadata_div -->
      </div>
    
      <div  id='show_select_items_div' class="col-md-4">
        <div class='well'>
              <% include partials/show_visual_output_choices.html %>
        </div> <!-- End  show_select_items_div -->  
      </div>
  </div>
</div>

<% if(mtx.data == '') { %>
<%    activate_thumbs = false %>
      <div id='' class='no_data'>
            <h3>No Sequences Found</h3>
      </div>
<% }else{ %>
    <div style='float:left;'>
      <table class='button_row'><tr>
      	
      	  <td>
                
            </td>
      	
      	    <!-- This form should run in the background and place the files 
      	          in a 'downloads' directory where it can be retrieved.
      	          The user should get an email when its ready.
      	     -->
            <td>
        			<form id='download_fasta_form_id' method='POST' action=''>
        		    <button type='button' id='download_fasta_btn' class="btn btn-xs btn-success">Create Fasta File</button>
        		    <input type='hidden' name='download_type' value='partial_project' />
        			  <input type='hidden' name='referer' value='/visuals/view_selection' />
      		  	</form>
              
      		</td><td>
      		    <form id='download_metadata_form_id' method='POST' action=''>
                <button type='button' id='download_metadata_btn' class="btn btn-xs btn-success">Create Metadata File</button>
      		      <input type='hidden' name='download_type' value='partial_project' />
      			    <input type='hidden' name='referer' value='/visuals/view_selection' />
      		    </form>	
              
      		</td><td>
              
              <form id='download_matrix_form_id'  method='POST' action=''>
                <button type='button' id='download_matrix_btn' class="btn btn-xs btn-success">Create Counts Matrix File</button>
                <input type='hidden' name='download_type' value='partial_project' />
                <input type='hidden' name='ts' value='<%= pi.ts %>' />
                <input type='hidden' name='referer' value='/visuals/view_selection' />
              </form> 
            
          </td>
          <td><div id='download_confirm_id'></div></td>
     	
      </tr></table>  <!-- button.row -->

    </div>

<a name='top_o_viz'></a>
<div style='float:right'>

    <table class=''>

    <tr><td><a href='https://joey711.github.io/phyloseq/' target='_blank'>Phyloseq</a> Input File Downloads:&nbsp;</td>
      <td>       
              <form id='download_biom_form_id'  method='POST' action='download_file'>
                <button type='submit' id='download_matrix_btn' class="btn btn-xs btn-primary">Biom Matrix File</button>
                <input type='hidden' name='file_type' value='biom' />           
                <input type='hidden' name='ts' value='<%= pi.ts %>' />
                <input type='hidden' name='referer' value='/visuals/view_selection' />
              </form>     
          </td><td>
              <form id='download_tax_form_id'  method='POST' action='download_file'>
                <button type='submit' id='download_matrix_btn' class="btn btn-xs btn-primary">Tax File</button>
                <input type='hidden' name='file_type' value='tax' />           
                <input type='hidden' name='ts' value='<%= pi.ts %>' />
                <input type='hidden' name='referer' value='/visuals/view_selection' />
              </form> 
          </td><td>
              <form id='download_meta_form_id'  method='POST' action='download_file'>
                <button type='submit' id='download_matrix_btn' class="btn btn-xs btn-primary">Metadata File</button>
                <input type='hidden' name='file_type' value='meta' />          
                <input type='hidden' name='ts' value='<%= pi.ts %>' />
                <input type='hidden' name='referer' value='/visuals/view_selection' />
              </form>       
    </td></tr>
    </table>

</div>
<% } %>
<% ds_count = mtx.shape[1]; %>
<% tx_count = mtx.shape[0]; %>
<% matrix_size = mtx.shape[0] * mtx.shape[1]; %>
<table border='1' class='table'>
        <tr>
          <% for(n in cnsts.VISUAL_THUMBNAILS.visuals) {                                              %>
          <%    var thumb = cnsts.VISUAL_THUMBNAILS.visuals[n].thumb;                                  %>
          <%    var name = cnsts.VISUAL_THUMBNAILS.visuals[n].name;                                    %>
          <%    var link = cnsts.VISUAL_THUMBNAILS.visuals[n].link;                                    %>
          <%    var link_id = cnsts.VISUAL_THUMBNAILS.visuals[n].id;                                  %>
          <%    var link = '#';                                                                       %>
          <%    var target='';                                                                        %>
          <%    var ttip = cnsts.VISUAL_THUMBNAILS.visuals[n].tip;                                    %>
          <%    var cols = 5                                                                          %>
          <%    if(ds_count === 1  && (name.substring(0,16) === 'Distance Heatmap' 
                                        || name.substring(0,10) === 'Dendrogram' 
                                        || name.substring(0,17) === 'Frequency Heatmap'
                                        || name.substring(0,4)  === 'PCoA' ))           { %>
                    <td class='td_top'><%= name %><br><br>Not Available<br>(single dataset)</td>
          <%    } else if(ds_count > 500  && (name.substring(0,13) === 'Phyloseq Bars' 
                                        || name.substring(0,16) === 'Phyloseq Heatmap' 
                                        || name.substring(0,16) === 'Phyloseq Network'
                                        || name.substring(0,17) === 'Phyloseq Tree'
                                        || name.substring(0,19)  === 'Phyloseq Ordination' ))            { %>

                    <td class='td_top' id='<%= ttip %>'>                       
                            <center>    
                                Too Many Datasets Selected<br>              
                                 <img src='<%= thumb %>'  border='0' alt='<%= name %>' class='thumb_img' >
                            </center>                     
                    </td>
          <%    } else if(matrix_size === 0  && (name.substring(0,13) === 'Phyloseq Bars' 
                                        || name.substring(0,16) === 'Phyloseq Heatmap' 
                                        || name.substring(0,16) === 'Phyloseq Network'
                                        || name.substring(0,17) === 'Phyloseq Tree'
                                        || name.substring(0,19)  === 'Phyloseq Ordination' ))            { %>

                    <td class='td_top' id='<%= ttip %>'>                       
                            <center>    
                                Not Available<br>              
                                 <img src='<%= thumb %>'  border='0' alt='<%= name %>' class='thumb_img' >
                            </center>                     
                    </td>
          <%    } else {                                                                              %>
          <%        if(activate_thumbs == false) {                                                              %>
                      <td class='td_top'><%= name %><br>
                        <center> 
                        <img src='<%= thumb %>' border='0' alt='<%= name %>' class='thumb_img' >
                        </center> 
                      </td>
          <%        }else{                                                                            %>
          <%            if(link_id == 'dbrowser_link_id'){ %> 
          <%              link = 'dbrowser' %>
          <%              target = '_blank' %>
          <%            }else if(link_id == 'pcoa_3d_link_id'){ %>
          <%              //link = 'pcoa_3d' %>
          <%              link = '#' %>
          <%              target= '' %>
          <%            } %>  

          <%            var phy_lookup = {} %>
          <%                for(var i in mtx.rows){ %>
          <%                  tax_items = mtx.rows[i].id.split(';') %>
          <%                  phy = tax_items[0]+';'+tax_items[1] %>
          <%                  if(tax_items[1] !== 'phylum_NA'){ %>
          <%                    phy_lookup[phy] = tax_items[1] %>
          <%                  } %>
          <%            } %>
          <%            if(link_id == 'pcoa_link_id'){                                                %> 
         
          <%               var id1 = 'pcoa_md1'                                               %>
          <%               var id2 = 'pcoa_md2'                                               %>
                            <td class='td_top tooltip_viz_help' id='<%= ttip %>'>                       
                              <center>                        
                                <a href='<%= link %>'  target='<%= target %>' id='<%= link_id %>'  >
                                  <%= name %><br>              
                                   <img src='<%= thumb %>'  border='0' alt='<%= name %>' class='thumb_img' >
                                </a>
                                    <table><tr><td>Metadata1:&nbsp;</td>
                                      <td>
                                      <select id='<%= id1 %>' name='<%= id1 %>' style='width:120px'>
                                        <option value='Project' selected >Project</option>
                                        <% for(var i in pi.metadata){ %>
                                          <option value='<%= pi.metadata[i] %>'><%= pi.metadata[i] %></option>
                                        <% } %>
                                        <option value='X.SampleID'>Dataset</option>
                                        <option value='Project' >Project</option>
                                      </select>
                                      </td>
                                      </tr><tr>
                                      <td>Metadata2:&nbsp;</td>
                                      <td>
                                      <select id='<%= id2 %>' name='<%= id2 %>' style='width:120px'>
                                        <option value='X.SampleID' selected >Dataset</option>
                                        <% for(var i in pi.metadata){ %>
                                          <option value='<%= pi.metadata[i] %>'><%= pi.metadata[i] %></option>
                                        <% } %>
                                        <option value='X.SampleID'>Dataset</option>
                                        <option value='Project'>Project</option>
                                      </select>
                                    </td></tr>
                                  </table>
                              </center>              
                            </td>                      
          
          <%            }else if(link_id == 'phyloseq01_link_id'){ %>   
          <%                var phy_id = 'phyloseq_bar_phylum' %> 
          
                            <td class='td_top tooltip_viz_help' id='<%= ttip %>'>                       
                              <center>                        
                                <a href='<%= link %>'  target='<%= target %>' id='<%= link_id %>'  >
                                  <%= name %><br>              
                                   <img src='<%= thumb %>'  border='0' alt='<%= name %>' class='thumb_img' >
                                </a>
                              
                              <table><tr><td>Choose Phylum:&nbsp;</td>
                                <td>
                                <select id='<%= phy_id %>' name='<%= phy_id %>' style='width:100px'>
                                  
                                  <% for(var phy in phy_lookup){ %>
                                    <option value='<%= phy_lookup[phy] %>'><%= phy %></option>
                                  <% } %>
                                  
                                </select>
                              </td>
                              </tr></table>
                              </center>              
                            </td>             
          <%            }else if(link_id == 'phyloseq02_link_id'){                                    %>   
          <%                var phy_id  = 'phyloseq_heatmap_phylum'                                   %> 
          <%                var rank_id = 'phyloseq_heatmap_rank'                                     %> 
          <%                var id1     = 'phyloseq_heatmap_md1'                                      %> 
          <%                var ordtype = 'phyloseq_heatmap_type'                                     %>
                            <td class='td_top tooltip_viz_help' id='<%= ttip %>'>                       
                              <center>                        
                                <% if(pi.tax_depth=='domain' || pi.tax_depth=='phylum'){ %>
                                    <%= name %><br><br><span>Required: Taxonomic depth<br>of 'Class' or deeper</span>
                                <% }else{ %>
                                  <a href='<%= link %>'  target='<%= target %>' id='<%= link_id %>'  >
                                    <%= name %><br>              
                                     <img src='<%= thumb %>'  border='0' alt='<%= name %>' class='thumb_img' >
                                  </a>
                              
                                  <table>
                                    <tr>
                                      <td>Choose Phylum:</td>
                                      <td>
                                        <select id='<%= phy_id %>' name='<%= phy_id %>' style='width:120px'>
                                          
                                          <% for(var phy in phy_lookup){ %>
                                            <option value='<%= phy_lookup[phy] %>'><%= phy %></option>
                                          <% } %>
                                          
                                        </select>
                                      </td>
                                    </tr>
                                    <tr>
                                      <td>Subset Rank:</td>
                                      <td><strong><%= pi.tax_depth %></strong></td>
                                    </tr>
                                    <tr>
                                      <td>(metadata) Variable:&nbsp;</td>
                                      <td>
                                        <select id='<%= id1 %>' name='<%= id1 %>' style='width:120px'>
                                          <option value='Project' selected >Project</option>
                                          <% for(var i in pi.metadata){ %>
                                            <option value='<%= pi.metadata[i] %>'><%= pi.metadata[i] %></option>
                                          <% } %>
                                          <option value='X.SampleID'>Dataset</option>
                                          <option value='Project' >Project</option>
                                        </select>
                                      </td>
                                    </tr>
                                    <tr><td>Ordination Type:</td>
                                      <td> 
                                      <input type='radio' name='<%= ordtype %>' id='' value='NMDS' > NMDS&nbsp;&nbsp;
                                      <input type='radio' checked name='<%= ordtype %>' id='' value='PCoA' > PCoA
                                      </td>
                                    </tr>
                                  </table>
                                <% } %>
                              </center>              
                            </td>  
          <%            }else if(link_id == 'phyloseq03_link_id'){                                    %> 
                      
          <%                var id1 = 'phyloseq_network_md1'                                          %>
          <%                var id2 = 'phyloseq_network_md2'                                          %>
          
                            <td class='td_top tooltip_viz_help' id='<%= ttip %>'>                       
                              <center>                        
                                <a href='<%= link %>'  target='<%= target %>' id='<%= link_id %>'  >
                                  <%= name %><br>              
                                   <img src='<%= thumb %>'  border='0' alt='<%= name %>' class='thumb_img' >
                                </a>
                              
                              <table><tr>
                                <td>Metadata1 (shape):&nbsp;</td>
                                <td>
                                <select id='<%= id1 %>' name='<%= id1 %>' style='width:120px'>
                                  <option value='Project' selected >Project</option>
                                  <% for(var i in pi.metadata){ %>
                                    <option value='<%= pi.metadata[i] %>'><%= pi.metadata[i] %></option>
                                  <% } %>
                                  <option value='X.SampleID'>Dataset</option>
                                  <option value='Project' >Project</option>
                                </select>
                              </td>
                            </tr><tr>
                              <td>Metadata2 (color):</td>
                              <td>
                                <select id='<%= id2 %>' name='<%= id2 %>' style='width:120px'>
                                  <option value='X.SampleID' selected >Dataset</option>
                                  <% for(var i in pi.metadata){ %>
                                    <option value='<%= pi.metadata[i] %>'><%= pi.metadata[i] %></option>
                                  <% } %>
                                  <option value='X.SampleID'>Dataset</option>
                                  <option value='Project'>Project</option>
                                </select>
                              </td></tr>
                              <tr>
                                <td>Max Distance:</td>
                                <td> 
                                  <input type='radio' name='phyloseq_nwk_dist' id='' value='0.1' > 0.1&nbsp;&nbsp;
                                  <input type='radio' name='phyloseq_nwk_dist' id='' value='0.2' > 0.2<br>
                                  <input type='radio' checked name='phyloseq_nwk_dist' id='' value='0.3' > 0.3&nbsp;&nbsp;
                                  <input type='radio' name='phyloseq_nwk_dist' id='' value='0.4' > 0.4
                              </td></tr>
                            </table>
                              </center>              
                            </td>                      
          <%            }else if(link_id == 'phyloseq04_link_id'){                                    %> 
         
          <%               var id1 = 'phyloseq_ord_md1'                                               %>
          <%               var id2 = 'phyloseq_ord_md2'                                               %>
          <%               var ordtype = 'phyloseq_ord_type'                                          %>
         
                            <td class='td_top tooltip_viz_help' id='<%= ttip %>'>                       
                              <center>                        
                                <a href='<%= link %>'  target='<%= target %>' id='<%= link_id %>'  >
                                  <%= name %><br>              
                                   <img src='<%= thumb %>'  border='0' alt='<%= name %>' class='thumb_img' >
                                </a>
                              
                                    <table><tr>
                                      <td>Metadata1 (shape):&nbsp;</td>
                                      <td>
                                        <select id='<%= id1 %>' name='<%= id1 %>' style='width:120px'>
                                          <option value='Project' selected >Project</option>
                                          <% for(var i in pi.metadata){ %>
                                            <option value='<%= pi.metadata[i] %>'><%= pi.metadata[i] %></option>
                                          <% } %>
                                          <option value='X.SampleID'>Dataset</option>
                                          <option value='Project' >Project</option>
                                        </select>
                                      </td>
                                      </tr><tr>
                                      <td>Metadata2 (color):</td>
                                      <td>
                                        <select id='<%= id2 %>' name='<%= id2 %>' style='width:120px'>
                                          <option value='X.SampleID' selected >Dataset</option>
                                          <% for(var i in pi.metadata){ %>
                                            <option value='<%= pi.metadata[i] %>'><%= pi.metadata[i] %></option>
                                          <% } %>
                                          <option value='X.SampleID'>Dataset</option>
                                          <option value='Project'>Project</option>
                                        </select>
                                      </td>
                                    </tr>
                                    <tr>
                                      <td>Ordination Type:</td>
                                      <td> 
                                    <input type='radio' name='<%= ordtype %>' id='<%= ordtype %>' value='NMDS' > NMDS&nbsp;&nbsp;
                                    <input type='radio' checked name='<%= ordtype %>' id='<%= ordtype %>' value='PCoA' > PCoA
                                    </td></tr>
                                  </table>
                              </center>              
                            </td>                      
          
          <%            }else if(link_id == 'phyloseq05_link_id'){                                    %> 
         
          <%               var id1 = 'phyloseq_tree_md1'                                              %>
         
                            <td class='td_top tooltip_viz_help' id='<%= ttip %>'>                       
                              <center>                        
                                <a href='<%= link %>'  target='<%= target %>' id='<%= link_id %>'  >
                                  <%= name %><br>              
                                   <img src='<%= thumb %>'  border='0' alt='<%= name %>' class='thumb_img' >
                                </a>
                              
                                  <table><tr>
                                  <td>Metadata (color):&nbsp;</td>
                                  <td>
                                    <select id='<%= id1 %>' name='<%= id1 %>' style='width:120px'>
                                      <option value='X.SampleID' selected >Dataset</option>
                                      <% for(var i in pi.metadata){ %>
                                        <option value='<%= pi.metadata[i] %>'><%= pi.metadata[i] %></option>
                                      <% } %>
                                      <option value='X.SampleID'>Dataset</option>
                                      <option value='Project'>Project</option>
                                    </select>
                                  </td></tr>
                                  </table>
                              </center>              
                            </td>                                

          <%            }else{ %>                                         
                            <td class='td_top tooltip_viz_help' id='<%= ttip %>'>                       
                            <center>                        
                              <a href='<%= link %>'  target='<%= target %>' id='<%= link_id %>'  >
                                <%= name %><br>              
                                 <img src='<%= thumb %>'  border='0' alt='<%= name %>' class='thumb_img' >
                              </a>
                            </center>                     
                            </td>
          <%            }                                                                             %>

          <%        }                                                                                 %>              
          <%    }                                                                                     %>
            
          <%    if( n % cols === (cols - 1) ) {                                                       %>
                  </tr><tr>
          <%    }                                                                                     %>
          <% }                                                                                        %>
        </tr>
      </table>
       

	 
	
  <!-- Counts -->
  <nav id='pre_counts_table_div' class="navbar navbar-inverse viz_hidden_div display_none">
	<div class="navbar-header" >	    
	  <span id='counts_table_title' class="navbar-brand table_title" >Frequency Table</span>  
	</div>
	<div class='button_div pull-right'>
	  <button type='button' id='counts_table_hide_btn' class='close_open_btn btn btn-sm btn-default' value='hide'>Hide</button>
	  <button type='button' disabled='disabled' id='counts_table_download_btn' class='visualization_download_btn btn btn-sm btn-default'>Download(disabled)</button>
    <button type="button" class="btn btn-sm btn-default" onclick='javascript:window.scrollTo(0,0)'><span class="glyphicon glyphicon-arrow-up"></span>Top</button>
  </div>
  </nav>
  <center><div id='tax_table_div'   class='display_none well overflow_500'></div></center>
  
  <!-- Metadata -->
  <br>
  <nav id='pre_metadata_table_div' class="navbar navbar-inverse viz_hidden_div display_none">
	<div class="navbar-header">	      
	  <span id='metadata_title' class="navbar-brand table_title" >Metadata Table</span> 
	</div>
  <div class='button_div pull-right'>
    <button type='button' id='metadata_table_hide_btn' class='close_open_btn btn btn-sm btn-default' value='hide'>Hide</button>
    <button type='button' disabled='disabled' id='metadata_download_btn' class='visualization_download_btn btn btn-sm btn-default'>Download(disabled)</button>
    <button type="button" class="btn btn-sm btn-default" onclick='javascript:window.scrollTo(0,0)'><span class="glyphicon glyphicon-arrow-up"></span>Top</button>
  </div>
  </nav>
  <center><div id='metadata_local_table_div' class='display_none well overflow_500'></div></center>
  
  
  <!-- Distance Heatmap -->
  <br>
  <nav id='pre_dheatmap_div' class="navbar navbar-inverse viz_hidden_div display_none">
    <div class="navbar-header">	      
      <span id='dheatmap_title' class="navbar-brand table_title" >Distance Heatmap</span> 
    </div>
  <div class='button_div pull-right'>
    <button type='button' id='dheatmap_hide_btn' class='close_open_btn btn btn-sm btn-default' value='hide'>Hide</button>
    <button type='button' disabled='disabled' id='dheatmap_download_btn' class='visualization_download_btn btn btn-sm btn-default'>Download(disabled)</button>
    <button type="button" class="btn btn-sm btn-default" onclick='javascript:window.scrollTo(0,0)'><span class="glyphicon glyphicon-arrow-up"></span>Top</button>
  </div>
  </nav>
  <center><div id='dheatmap_div' class='display_none well'></div></center>
  

<!-- Frequency Heatmap -->
  <br>
  <nav id='pre_fheatmap_div' class="navbar navbar-inverse viz_hidden_div display_none">
    <div class="navbar-header">	      
      <span id='fheatmap_title' class="navbar-brand table_title" >Frequency Heatmap</span> 
    </div> 
  <div class='button_div pull-right'>
    <button type='button' id='fheatmap_hide_btn' class='close_open_btn btn btn-sm btn-default' value='hide'>Hide</button>
    <button type='button' disabled='disabled' id='fheatmap_download_btn' class='visualization_download_btn btn btn-sm btn-default'>Download(disabled)</button>
    <button type="button" class="btn btn-sm btn-default" onclick='javascript:window.scrollTo(0,0)'><span class="glyphicon glyphicon-arrow-up"></span>Top</button>
  </div>
  </nav>
  <center><div id='fheatmap_div' class='display_none well'></div></center>


  <!-- BarCharts -->
  <br>
  <nav id='pre_barcharts_table_div' class="navbar navbar-inverse viz_hidden_div display_none">
	<div class="navbar-header">	      
	    <span id='barcharts_title' class="navbar-brand table_title" >Bar Charts</span> 
	</div>
  <div class='button_div pull-right'>
    <button type='button' id='barcharts_hide_btn' class='close_open_btn btn btn-sm btn-default' value='hide'>Hide</button>
    <button type='button' disabled='disabled' id='barcharts_download_btn' class='visualization_download_btn btn btn-sm btn-default'>Download(disabled)</button>
    <button type="button" class="btn btn-sm btn-default" onclick='javascript:window.scrollTo(0,0)'><span class="glyphicon glyphicon-arrow-up"></span>Top</button>
  </div>
  </nav>
  <center><div id='barcharts_div' class='well display_none'></div></center>

  
  <!-- PieCharts -->
  <br>
  <nav id='pre_piecharts_table_div' class="navbar navbar-inverse viz_hidden_div display_none">
	<div class="navbar-header">	      
	  <span id='piecharts_title' class="navbar-brand table_title" >Pie Charts</span> 
	</div> 
  <div class='button_div pull-right'>
    <button type='button' id='piecharts_hide_btn' class='close_open_btn btn btn-sm btn-default' value='hide'>Hide</button>
    <button type='button' disabled='disabled' id='piecharts_download_btn' class='visualization_download_btn btn btn-sm btn-default'>Download(disabled)</button>
    <button type="button" class="btn btn-sm btn-default" onclick='javascript:window.scrollTo(0,0)'><span class="glyphicon glyphicon-arrow-up"></span>Top</button>
  </div>
  </nav>
  <center><div id='piecharts_div' class='well display_none'></div></center>
  
  <!-- Dendrogram 1 phylogram -->
  <br>
  <nav id='pre_dendrogram1_div' class="navbar navbar-inverse viz_hidden_div display_none">
	<div class="navbar-header">	      
	  <span id='dendrogram1_title' class="navbar-brand table_title" >Dendrogram</span> 
	</div> 
  <div class='button_div pull-right'>
    <button type='button' id='dendrogram1_hide_btn' class='close_open_btn btn btn-sm btn-default' value='hide'>Hide</button>
    <button type='button' disabled='disabled' id='dendrogram1_download_btn' class='visualization_download_btn btn btn-sm btn-default'>Download(disabled)</button>
    <button type="button" class="btn btn-sm btn-default" onclick='javascript:window.scrollTo(0,0)'><span class="glyphicon glyphicon-arrow-up"></span>Top</button>
  </div>
  </nav>
  <center><div id='dendrogram1_div'        class='display_none well '></div></center>
  
  <!-- Dendrogram 2 phylonator -->
  <br>
  <nav id='pre_dendrogram2_div' class="navbar navbar-inverse viz_hidden_div display_none">
	<div class="navbar-header">	      
	  <span id='dendrogram2_title' class="navbar-brand table_title" >Dendrogram</span> 
	</div>
  <div class='button_div pull-right'>
    <button type='button' id='dendrogram2_hide_btn' class='close_open_btn btn btn-sm btn-default' value='hide'>Hide</button>
    <button type='button' disabled='disabled' id='dendrogram2_download_btn' class='visualization_download_btn btn btn-sm btn-default'>Download(disabled)</button>
    <button type="button" class="btn btn-sm btn-default" onclick='javascript:window.scrollTo(0,0)'><span class="glyphicon glyphicon-arrow-up"></span>Top</button>
  </div>
  </nav>
  <center><div id='dendrogram2_div'        class='display_none well '></div></center>
  
  <!-- Dendrogram 3 radial -->
  <br>
  <nav id='pre_dendrogram3_div' class="navbar navbar-inverse viz_hidden_div display_none">
  <div class="navbar-header">       
    <span id='dendrogram3_title' class="navbar-brand table_title" >Dendrogram</span> 
  </div>
  <div class='button_div pull-right'>
    <button type='button' id='dendrogram3_hide_btn' class='close_open_btn btn btn-sm btn-default' value='hide'>Hide</button>
    <button type='button' disabled='disabled' id='dendrogram3_download_btn' class='visualization_download_btn btn btn-sm btn-default'>Download(disabled)</button>
    <button type="button" class="btn btn-sm btn-default" onclick='javascript:window.scrollTo(0,0)'><span class="glyphicon glyphicon-arrow-up"></span>Top</button>
  </div>
  </nav>
  <center><div id='dendrogram3_div'        class='display_none well '></div></center>

  <!-- Dendrogram pdf-->
  <br>
  <nav id='pre_dendrogram_pdf_div' class="navbar navbar-inverse viz_hidden_div display_none">
	<div class="navbar-header">	      
	  <span id='dendrogram_pdf_title' class="navbar-brand table_title" >Dendrogram</span> 
	</div>
  <div class='button_div pull-right'>
    <button type='button' id='dendrogram_pdf_hide_btn' class='close_open_btn btn btn-sm btn-default' value='hide'>Hide</button>
    <button type='button' disabled='disabled' id='dendrogram_pdf_download_btn' class='visualization_download_btn btn btn-sm btn-default'>Download(disabled)</button>
    <button type="button" class="btn btn-sm btn-default" onclick='javascript:window.scrollTo(0,0)'><span class="glyphicon glyphicon-arrow-up"></span>Top</button>
  </div>
  </nav>
  <center><div id='dendrogram_pdf_div'        class='display_none well'></div></center>

  <!-- PCoA 2D Python -->
  <br>
  <nav id='pre_pcoa_div' class="navbar navbar-inverse viz_hidden_div display_none">
	<div class="navbar-header">	      
		  <span id='pcoa_title' class="navbar-brand table_title" >PCoA 2D</span> 
	</div>
  <div class='button_div pull-right'>
    <button type='button' id='pcoa_hide_btn' class='close_open_btn btn btn-sm btn-default' value='hide'>Hide</button>
    <button type='button' disabled='disabled' id='pcoa_download_btn' class='visualization_download_btn btn btn-sm btn-default'>Download(disabled)</button>
    <button type="button" class="btn btn-sm btn-default" onclick='javascript:window.scrollTo(0,0)'><span class="glyphicon glyphicon-arrow-up"></span>Top</button>
  </div>
  </nav>
  <center><div id='pcoa_div'                    class='display_none well'></div> </center>

  <!-- PCoA 3D Emperor -->
   <br>
  <nav id='pre_pcoa_3d_div' class="navbar navbar-inverse viz_hidden_div display_none">
	<div class="navbar-header">	      
		  <span id='pcoa_3d_title' class="navbar-brand table_title" >PCoA 3D</span> 
	</div>
  <div class='button_div pull-right'>
    <button type='button' id='pcoa_3d_hide_btn' class='close_open_btn btn btn-sm btn-default' value='hide'>Hide</button>
    <button type='button' disabled='disabled' id='pcoa_3d_download_btn' class='visualization_download_btn btn btn-sm btn-default'>Download(disabled)</button>
    <button type="button" class="btn btn-sm btn-default" onclick='javascript:window.scrollTo(0,0)'><span class="glyphicon glyphicon-arrow-up"></span>Top</button>
  </div>
  </nav>
  <center><div id='pcoa_3d_div'                 class='display_none well'></div> </center>
  
  <!-- GEOSPATIAL -->
  <br>
  <nav id='pre_geospatial_div' class="navbar navbar-inverse viz_hidden_div display_none">
	<div class="navbar-header">	      
		  <span id='geospatial_title' class="navbar-brand table_title" >GeoSpatial</span> 
	</div>
  <div class='button_div pull-right'>
    <button type='button' id='geospatial_hide_btn' class='close_open_btn btn btn-sm btn-default' value='hide'>Hide</button>
    <button type='button' disabled='disabled' id='geospatial_download_btn' class='visualization_download_btn btn btn-sm btn-default'>Download(disabled)</button>
    <button type="button" class="btn btn-sm btn-default" onclick='javascript:window.scrollTo(0,0)'><span class="glyphicon glyphicon-arrow-up"></span>Top</button>
  </div>
  </nav>
  <center><div id='map-canvas'      class='display_none well'></div> </center>
  
  <!-- KRONA (Data Browser) -->
<!--   
 <br>
 <nav id='pre_dbrowser_div' class="navbar navbar-inverse viz_hidden_div display_none">
	<div class="navbar-header">	      
		  <span id='dbrowser_title' class="navbar-brand table_title" >Data Browser</span> 
	</div>
	<a class='btn pull-right' href="javascript:scroll(0,0)"><img border="0" alt="Top" src="/images/up_arrow.png" width="30" height="30"></a>
	<button type='button' id='dbrowser_hide_btn' class='close_open_btn btn pull-right btn-default' value='hide'>hide</button>
	<button type='button' disabled='disabled' id='dbrowser_download_btn' class='visualization_download_btn btn pull-right btn-default'>download</button>
 </nav>
 <div id='dbrowser_div'      class='display_none well'></div>
-->
  <!-- ALPHA DIVERSITY -->
 <br>
 <nav id='pre_adiversity_div' class="navbar navbar-inverse viz_hidden_div display_none">
  <div class="navbar-header">       
      <span id='adiversity_title' class="navbar-brand table_title" >Alpha Diversity</span> 
  </div>
 <div class='button_div pull-right'>
    <button type='button' id='adiversity_hide_btn' class='close_open_btn btn btn-sm btn-default' value='hide'>Hide</button>
    <button type='button' disabled='disabled' id='adiversity_download_btn' class='visualization_download_btn btn btn-sm btn-default'>Download(disabled)</button>
    <button type="button" class="btn btn-sm btn-default" onclick='javascript:window.scrollTo(0,0)'><span class="glyphicon glyphicon-arrow-up"></span>Top</button>
  </div>
 </nav>
 <center><div id='adiversity_div'      class='display_none well'></div></center>

  <!-- PHYLOSEQ BARS -->
 <br>
 <nav id='pre_phyloseq01_div' class="navbar navbar-inverse viz_hidden_div display_none">
  <div class="navbar-header">       
      <span id='phyloseq01_title' class="navbar-brand table_title" >Phyloseq-01</span>
  </div>
 <div class='button_div pull-right'>
    <button type='button' id='phyloseq01_hide_btn' class='close_open_btn btn btn-sm btn-default' value='hide'>Hide</button>
    <button type='button' disabled='disabled' id='phyloseq01_download_btn' class='visualization_download_btn btn btn-sm btn-default'>Download(disabled)</button>
    <button type="button" class="btn btn-sm btn-default" onclick='javascript:window.scrollTo(0,0)'><span class="glyphicon glyphicon-arrow-up"></span>Top</button>
  </div>
 </nav>
 <center><div id='phyloseq01_div'      class='display_none well'></div></center>
 
 <!-- PHYLOSEQ HEATMAP -->
 <br>
 <nav id='pre_phyloseq02_div' class="navbar navbar-inverse viz_hidden_div display_none">
  <div class="navbar-header">       
      <span id='phyloseq02_title' class="navbar-brand table_title" >Phyloseq-02</span> 
  </div>
 <div class='button_div pull-right'>
    <button type='button' id='phyloseq02_hide_btn' class='close_open_btn btn btn-sm btn-default' value='hide'>Hide</button>
    <button type='button' disabled='disabled' id='phyloseq02_download_btn' class='visualization_download_btn btn btn-sm btn-default'>Download(disabled)</button>
    <button type="button" class="btn btn-sm btn-default" onclick='javascript:window.scrollTo(0,0)'><span class="glyphicon glyphicon-arrow-up"></span>Top</button>
  </div>
 </nav>
 <center><div id='phyloseq02_div'      class='display_none well'></div></center>
 
  <!-- PHYLOSEQ 03 -->
 <br>
 <nav id='pre_phyloseq03_div' class="navbar navbar-inverse viz_hidden_div display_none">
  <div class="navbar-header">       
      <span id='phyloseq03_title' class="navbar-brand table_title" >Phyloseq-03</span> 
  </div>
 <div class='button_div pull-right'>
    <button type='button' id='phyloseq03_hide_btn' class='close_open_btn btn btn-sm btn-default' value='hide'>Hide</button>
    <button type='button' disabled='disabled' id='phyloseq03_download_btn' class='visualization_download_btn btn btn-sm btn-default'>Download(disabled)</button>
    <button type="button" class="btn btn-sm btn-default" onclick='javascript:window.scrollTo(0,0)'><span class="glyphicon glyphicon-arrow-up"></span>Top</button>
  </div>
 </nav>
 <center><div id='phyloseq03_div'      class='display_none well'></div></center>
 
  <!-- PHYLOSEQ 04 -->
 <br>
 <nav id='pre_phyloseq04_div' class="navbar navbar-inverse viz_hidden_div display_none">
  <div class="navbar-header">       
      <span id='phyloseq04_title' class="navbar-brand table_title" >Phyloseq-04</span> 
  </div>
  <div class='button_div pull-right'>
    <button type='button' id='phyloseq04_hide_btn' class='close_open_btn btn btn-sm btn-default' value='hide'>Hide</button>
    <button type='button' disabled='disabled' id='phyloseq04_download_btn' class='visualization_download_btn btn btn-sm btn-default'>Download(disabled)</button>
    <button type="button" class="btn btn-sm btn-default" onclick='javascript:window.scrollTo(0,0)'><span class="glyphicon glyphicon-arrow-up"></span>Top</button>
  </div>
 </nav>
 <center><div id='phyloseq04_div'      class='display_none well'></div></center>
 
  <!-- PHYLOSEQ 05 -->
 <br>
 <nav id='pre_phyloseq05_div' class="navbar navbar-inverse viz_hidden_div display_none">
  <div class="navbar-header">       
      <span id='phyloseq05_title' class="navbar-brand table_title" >Phyloseq-05</span> 
  </div>
  <div class='button_div pull-right'>
    <button type='button' id='phyloseq05_hide_btn' class='close_open_btn btn btn-sm btn-default' value='hide'>Hide</button>
    <button type='button' disabled='disabled' id='phyloseq05_download_btn' class='visualization_download_btn btn btn-sm btn-default'>Download(disabled)</button>
    <button type="button" class="btn btn-sm btn-default" onclick='javascript:window.scrollTo(0,0)'><span class="glyphicon glyphicon-arrow-up"></span>Top</button>
  </div>
 </nav>
 <center><div id='phyloseq05_div'      class='display_none well'></div></center>

<!-- -------------------------------------------------- -->

  <div id='counts_tooltip_div' class=''></div>
  <div id='piebarcharts_tooltip_div' class=''></div>
  <div id='q' class=''></div> 

 
 
  <% include ../add_ins/end.ejs %>
 <!-- <script src ="https://maps.googleapis.com/maps/api/js"></script> -->
 <script async defer src="https://maps.googleapis.com/maps/api/js?v=3&key=<%= gekey %>"></script>
 <script type="text/javascript" src="/javascripts/tablesort.min.js"></script>
 <script type="text/javascript" src="/javascripts/jquery.scrollTo.min.js"></script>
 <script type="text/javascript" src="/javascripts/jquery.tablednd.js"></script>
 <script type="text/javascript" src="/javascripts/d3.min.js" charset="utf-8"></script>
 <script type="text/javascript" src="/javascripts/d3pie.min.js" charset="utf-8"></script>
 
 <script type="text/javascript" src="/javascripts/d3.phylogram.js" charset="utf-8"></script>
 <script type="text/javascript" src="/javascripts/d3.phylonator.js" charset="utf-8"></script>

 <script type="text/javascript" src="/javascripts/newick.js" charset="utf-8"></script>
 <script type="text/javascript" src="/javascripts/drag_rows.js"></script>
 <script type="text/javascript" src="/javascripts/global.js"></script>
 <script type="text/javascript" src="/javascripts/common_selection.js"></script>
 <script type="text/javascript" src="/javascripts/view_selection.js"></script>
 <script type="text/javascript" src="/javascripts/bootstrap-select.js"></script>
 <script type="text/javascript" src="/javascripts/jquery.flot.min.js"></script>
 
</body>
</html>


